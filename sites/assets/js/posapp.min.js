!function(){"use strict";var e=new Vue,t={data:function(){return{drawer:!1,mini:!0,item:0,items:[{text:"POS",icon:"mdi-point-of-sale"}],page:"",fav:!0,menu:!1,message:!1,hints:!0,menu_item:0,snack:!1,snackColor:"",snackText:"",company:"POS Awesome",company_img:"/assets/erpnext/images/erpnext-logo.svg",pos_profile:"",freeze:!1,freezeTitle:"",freezeMsg:"",last_invoice:""}},methods:{changePage:function(e){this.$emit("changePage",e)},go_desk:function(){frappe.set_route("/"),location.reload()},go_about:function(){window.open("https://github.com/yrestom/POS-Awesome","_blank").focus()},close_shift_dialog:function(){e.$emit("open_closing_dialog")},show_mesage:function(e){this.snack=!0,this.snackColor=e.color,this.snackText=e.text},logOut:function(){return this.logged_out=!0,frappe.call({method:"logout",callback:function(e){e.exc||(frappe.set_route("/login"),location.reload())}})},print_last_invoice:function(){if(this.last_invoice){var e=this.pos_profile.print_format_for_online||this.pos_profile.print_format,t=this.pos_profile.letter_head||0,n=frappe.urllib.get_base_url()+"/printview?doctype=Sales%20Invoice&name="+this.last_invoice+"&trigger_print=1&format="+e+"&no_letterhead="+t,i=window.open(n,"Print");i.addEventListener("load",function(){i.print()},!0)}}},created:function(){this.$nextTick(function(){var t=this;e.$on("show_mesage",function(e){t.show_mesage(e)}),e.$on("set_company",function(e){t.company=e.name,t.company_img=e.company_logo?e.company_logo:t.company_img}),e.$on("register_pos_profile",function(e){t.pos_profile=e.pos_profile}),e.$on("set_last_invoice",function(e){t.last_invoice=e}),e.$on("freeze",function(e){t.freeze=!0,t.freezeTitle=e.title,t.freezeMsg=e.msg}),e.$on("unfreeze",function(){t.freeze=!1,t.freezTitle="",t.freezeMsg=""})})}},n=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nav",[n("v-app-bar",{staticClass:"elevation-2",attrs:{app:"",height:"40"}},[n("v-app-bar-nav-icon",{staticClass:"grey--text",on:{click:function(t){t.stopPropagation(),e.drawer=!e.drawer}}}),e._v(" "),n("v-toolbar-title",{staticClass:"text-uppercase indigo--text",staticStyle:{cursor:"pointer"},on:{click:e.go_desk}},[n("span",{staticClass:"font-weight-light"},[e._v("pos")]),e._v(" "),n("span",[e._v("awesome")])]),e._v(" "),n("v-spacer"),e._v(" "),n("v-btn",{staticStyle:{cursor:"unset"},attrs:{text:"",color:"grey"}},[n("span",{attrs:{right:""}},[e._v(e._s(e.pos_profile.name))])]),e._v(" "),n("div",{staticClass:"text-center"},[n("v-menu",{attrs:{"offset-y":""},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,o=t.attrs;return[n("v-btn",e._g(e._b({attrs:{color:"grey",dark:"",text:""}},"v-btn",o,!1),i),[e._v("Menu")])]}}])},[e._v(" "),n("v-card",{staticClass:"mx-auto",attrs:{"max-width":"300",tile:""}},[n("v-list",{attrs:{dense:""}},[n("v-list-item-group",{attrs:{color:"primary"},model:{value:e.menu_item,callback:function(t){e.menu_item=t},expression:"menu_item"}},[e.pos_profile.posa_hide_closing_shift?e._e():n("v-list-item",{on:{click:e.close_shift_dialog}},[n("v-list-item-icon",[n("v-icon",[e._v("mdi-content-save-move-outline")])],1),e._v(" "),n("v-list-item-content",[n("v-list-item-title",[e._v(e._s(e.__("Close Shift")))])],1)],1),e._v(" "),e.pos_profile.posa_allow_print_last_invoice&&this.last_invoice?n("v-list-item",{on:{click:e.print_last_invoice}},[n("v-list-item-icon",[n("v-icon",[e._v("mdi-printer")])],1),e._v(" "),n("v-list-item-content",[n("v-list-item-title",[e._v(e._s(e.__("Print Last Invoice")))])],1)],1):e._e(),e._v(" "),n("v-divider",{staticClass:"my-0"}),e._v(" "),n("v-list-item",{on:{click:e.logOut}},[n("v-list-item-icon",[n("v-icon",[e._v("mdi-logout")])],1),e._v(" "),n("v-list-item-content",[n("v-list-item-title",[e._v(e._s(e.__("Logout")))])],1)],1),e._v(" "),n("v-list-item",{on:{click:e.go_about}},[n("v-list-item-icon",[n("v-icon",[e._v("mdi-information-outline")])],1),e._v(" "),n("v-list-item-content",[n("v-list-item-title",[e._v(e._s(e.__("About")))])],1)],1)],1)],1)],1)],1)],1)],1),e._v(" "),n("v-navigation-drawer",{staticClass:"indigo margen-top",attrs:{"mini-variant":e.mini,app:""},on:{"update:miniVariant":function(t){e.mini=t},"update:mini-variant":function(t){e.mini=t}},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[n("v-list",{attrs:{dark:""}},[n("v-list-item",{staticClass:"px-2"},[n("v-list-item-avatar",[n("v-img",{attrs:{src:e.company_img}})],1),e._v(" "),n("v-list-item-title",[e._v(e._s(e.company))]),e._v(" "),n("v-btn",{attrs:{icon:""},on:{click:function(t){t.stopPropagation(),e.mini=!e.mini}}},[n("v-icon",[e._v("mdi-chevron-left")])],1)],1),e._v(" "),n("v-list-item-group",{attrs:{color:"white"},model:{value:e.item,callback:function(t){e.item=t},expression:"item"}},e._l(e.items,function(t){return n("v-list-item",{key:t.text,on:{click:function(n){return e.changePage(t.text)}}},[n("v-list-item-icon",[n("v-icon",{domProps:{textContent:e._s(t.icon)}})],1),e._v(" "),n("v-list-item-content",[n("v-list-item-title",{domProps:{textContent:e._s(t.text)}})],1)],1)}),1)],1)],1),e._v(" "),n("v-snackbar",{attrs:{timeout:5e3,color:e.snackColor,top:"",right:""},model:{value:e.snack,callback:function(t){e.snack=t},expression:"snack"}},[e._v("\n    "+e._s(e.snackText)+"\n  ")]),e._v(" "),n("v-dialog",{attrs:{persistent:"","max-width":"290"},model:{value:e.freeze,callback:function(t){e.freeze=t},expression:"freeze"}},[n("v-card",[n("v-card-title",{staticClass:"text-h5"},[e._v("\n        "+e._s(e.freezeTitle)+"\n      ")]),e._v(" "),n("v-card-text",[e._v(e._s(e.freezeMsg))])],1)],1)],1)};n._withStripped=!0;var i=function(e,t,n,i,o,r,s,a){var c,l=("function"==typeof n?n.options:n)||{};if(l.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/Navbar.vue",l.render||(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,o&&(l.functional=!0)),l._scopeId=i,t&&(c=function(e){t.call(this,s(e))}),void 0!==c)if(l.functional){var _=l.render;l.render=function(e,t){return c.call(t),_(e,t)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return l}({render:n,staticRenderFns:[]},function(e){e&&e("data-v-76817fa5_0",{source:"\n.margen-top[data-v-76817fa5] {\n  margin-top: 0px;\n}\n",map:{version:3,sources:["/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/Navbar.vue"],names:[],mappings:";AA6PA;EACA,eAAA;AACA",file:"Navbar.vue",sourcesContent:['<template>\n  <nav>\n    <v-app-bar app height="40" class="elevation-2">\n      <v-app-bar-nav-icon\n        @click.stop="drawer = !drawer"\n        class="grey--text"\n      ></v-app-bar-nav-icon>\n      <v-toolbar-title\n        @click="go_desk"\n        style="cursor: pointer"\n        class="text-uppercase indigo--text"\n      >\n        <span class="font-weight-light">pos</span>\n        <span>awesome</span>\n      </v-toolbar-title>\n\n      <v-spacer></v-spacer>\n      <v-btn style="cursor: unset" text color="grey">\n        <span right>{{ pos_profile.name }}</span>\n      </v-btn>\n      <div class="text-center">\n        <v-menu offset-y>\n          <template v-slot:activator="{ on, attrs }">\n            <v-btn color="grey" dark text v-bind="attrs" v-on="on">Menu</v-btn>\n          </template>\n          <v-card class="mx-auto" max-width="300" tile>\n            <v-list dense>\n              <v-list-item-group v-model="menu_item" color="primary">\n                <v-list-item\n                  @click="close_shift_dialog"\n                  v-if="!pos_profile.posa_hide_closing_shift"\n                >\n                  <v-list-item-icon>\n                    <v-icon>mdi-content-save-move-outline</v-icon>\n                  </v-list-item-icon>\n                  <v-list-item-content>\n                    <v-list-item-title>{{\n                      __(\'Close Shift\')\n                    }}</v-list-item-title>\n                  </v-list-item-content>\n                </v-list-item>\n                <v-list-item\n                  @click="print_last_invoice"\n                  v-if="\n                    pos_profile.posa_allow_print_last_invoice &&\n                    this.last_invoice\n                  "\n                >\n                  <v-list-item-icon>\n                    <v-icon>mdi-printer</v-icon>\n                  </v-list-item-icon>\n                  <v-list-item-content>\n                    <v-list-item-title>{{\n                      __(\'Print Last Invoice\')\n                    }}</v-list-item-title>\n                  </v-list-item-content>\n                </v-list-item>\n                <v-divider class="my-0"></v-divider>\n                <v-list-item @click="logOut">\n                  <v-list-item-icon>\n                    <v-icon>mdi-logout</v-icon>\n                  </v-list-item-icon>\n                  <v-list-item-content>\n                    <v-list-item-title>{{ __(\'Logout\') }}</v-list-item-title>\n                  </v-list-item-content>\n                </v-list-item>\n                <v-list-item @click="go_about">\n                  <v-list-item-icon>\n                    <v-icon>mdi-information-outline</v-icon>\n                  </v-list-item-icon>\n                  <v-list-item-content>\n                    <v-list-item-title>{{ __(\'About\') }}</v-list-item-title>\n                  </v-list-item-content>\n                </v-list-item>\n              </v-list-item-group>\n            </v-list>\n          </v-card>\n        </v-menu>\n      </div>\n    </v-app-bar>\n    <v-navigation-drawer\n      v-model="drawer"\n      :mini-variant.sync="mini"\n      app\n      class="indigo margen-top"\n    >\n      <v-list dark>\n        <v-list-item class="px-2">\n          <v-list-item-avatar>\n            <v-img :src="company_img"></v-img>\n          </v-list-item-avatar>\n\n          <v-list-item-title>{{ company }}</v-list-item-title>\n\n          <v-btn icon @click.stop="mini = !mini">\n            <v-icon>mdi-chevron-left</v-icon>\n          </v-btn>\n        </v-list-item>\n        \x3c!-- <MyPopup/> --\x3e\n        <v-list-item-group v-model="item" color="white">\n          <v-list-item\n            v-for="item in items"\n            :key="item.text"\n            @click="changePage(item.text)"\n          >\n            <v-list-item-icon>\n              <v-icon v-text="item.icon"></v-icon>\n            </v-list-item-icon>\n            <v-list-item-content>\n              <v-list-item-title v-text="item.text"></v-list-item-title>\n            </v-list-item-content>\n          </v-list-item>\n        </v-list-item-group>\n      </v-list>\n    </v-navigation-drawer>\n    <v-snackbar v-model="snack" :timeout="5000" :color="snackColor" top right>\n      {{ snackText }}\n    </v-snackbar>\n    <v-dialog v-model="freeze" persistent max-width="290">\n      <v-card>\n        <v-card-title class="text-h5">\n          {{ freezeTitle }}\n        </v-card-title>\n        <v-card-text>{{ freezeMsg }}</v-card-text>\n      </v-card>\n    </v-dialog>\n  </nav>\n</template>\n\n<script>\nimport { evntBus } from \'../bus\';\n\nexport default {\n  // components: {MyPopup},\n  data() {\n    return {\n      drawer: false,\n      mini: true,\n      item: 0,\n      items: [{ text: \'POS\', icon: \'mdi-point-of-sale\' }],\n      page: \'\',\n      fav: true,\n      menu: false,\n      message: false,\n      hints: true,\n      menu_item: 0,\n      snack: false,\n      snackColor: \'\',\n      snackText: \'\',\n      company: \'POS Awesome\',\n      company_img: \'/assets/erpnext/images/erpnext-logo.svg\',\n      pos_profile: \'\',\n      freeze: false,\n      freezeTitle: \'\',\n      freezeMsg: \'\',\n      last_invoice: \'\',\n    };\n  },\n  methods: {\n    changePage(key) {\n      this.$emit(\'changePage\', key);\n    },\n    go_desk() {\n      frappe.set_route(\'/\');\n      location.reload();\n    },\n    go_about() {\n      const win = window.open(\n        \'https://github.com/yrestom/POS-Awesome\',\n        \'_blank\'\n      );\n      win.focus();\n    },\n    close_shift_dialog() {\n      evntBus.$emit(\'open_closing_dialog\');\n    },\n    show_mesage(data) {\n      this.snack = true;\n      this.snackColor = data.color;\n      this.snackText = data.text;\n    },\n    logOut() {\n      var me = this;\n      me.logged_out = true;\n      return frappe.call({\n        method: \'logout\',\n        callback: function (r) {\n          if (r.exc) {\n            return;\n          }\n          frappe.set_route(\'/login\');\n          location.reload();\n        },\n      });\n    },\n    print_last_invoice() {\n      if (!this.last_invoice) return;\n      const print_format =\n        this.pos_profile.print_format_for_online ||\n        this.pos_profile.print_format;\n      const letter_head = this.pos_profile.letter_head || 0;\n      const url =\n        frappe.urllib.get_base_url() +\n        \'/printview?doctype=Sales%20Invoice&name=\' +\n        this.last_invoice +\n        \'&trigger_print=1\' +\n        \'&format=\' +\n        print_format +\n        \'&no_letterhead=\' +\n        letter_head;\n      const printWindow = window.open(url, \'Print\');\n      printWindow.addEventListener(\n        \'load\',\n        function () {\n          printWindow.print();\n        },\n        true\n      );\n    },\n  },\n  created: function () {\n    this.$nextTick(function () {\n      evntBus.$on(\'show_mesage\', (data) => {\n        this.show_mesage(data);\n      });\n      evntBus.$on(\'set_company\', (data) => {\n        this.company = data.name;\n        this.company_img = data.company_logo\n          ? data.company_logo\n          : this.company_img;\n      });\n      evntBus.$on(\'register_pos_profile\', (data) => {\n        this.pos_profile = data.pos_profile;\n      });\n      evntBus.$on(\'set_last_invoice\', (data) => {\n        this.last_invoice = data;\n      });\n      evntBus.$on(\'freeze\', (data) => {\n        this.freeze = true;\n        this.freezeTitle = data.title;\n        this.freezeMsg = data.msg;\n      });\n      evntBus.$on(\'unfreeze\', () => {\n        this.freeze = false;\n        this.freezTitle = \'\';\n        this.freezeMsg = \'\';\n      });\n    });\n  },\n};\n<\/script>\n\n<style scoped>\n.margen-top {\n  margin-top: 0px;\n}\n</style>']},media:void 0})},t,"data-v-76817fa5",!1,0,function e(){var t=document.head||document.getElementsByTagName("head")[0],n=e.styles||(e.styles={}),i="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(e,o){if(!document.querySelector('style[data-vue-ssr-id~="'+e+'"]')){var r=i?o.media||"default":e,s=n[r]||(n[r]={ids:[],parts:[],element:void 0});if(!s.ids.includes(e)){var a=o.source,c=s.ids.length;if(s.ids.push(e),i&&(s.element=s.element||document.querySelector("style[data-group="+r+"]")),!s.element){var l=s.element=document.createElement("style");l.type="text/css",o.media&&l.setAttribute("media",o.media),i&&(l.setAttribute("data-group",r),l.setAttribute("data-next-index","0")),t.appendChild(l)}if(i&&(c=parseInt(s.element.getAttribute("data-next-index")),s.element.setAttribute("data-next-index",c+1)),s.element.styleSheet)s.parts.push(a),s.element.styleSheet.cssText=s.parts.filter(Boolean).join("\n");else{var _=document.createTextNode(a),u=s.element.childNodes;u[c]&&s.element.removeChild(u[c]),u.length?s.element.insertBefore(_,u[c]):s.element.appendChild(_)}}}}}),o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var r,s={data:function(){return{pos_profile:"",flags:{},items_view:"list",item_group:"ALL",loading:!1,items_group:["ALL"],items:[],search:"",first_search:"",itemsPerPage:1e3,items_headers:[{text:__("Name"),align:"start",sortable:!0,value:"item_name"},{text:__("Rate"),value:"rate",align:"start"},{text:__("Available QTY"),value:"actual_qty",align:"start"},{text:__("UOM"),value:"stock_uom",align:"start"}],offersCount:0,appliedOffersCount:0,couponsCount:0,appliedCouponsCount:0,customer_price_list:null}},watch:{filtred_items:function(e){this.update_items_details(e)},customer_price_list:function(){this.get_items()}},methods:{show_offers:function(){e.$emit("show_offers","true")},show_coupons:function(){e.$emit("show_coupons","true")},get_items:function(){if(this.pos_profile){var t=this;this.loading=!0,t.pos_profile.posa_local_storage&&localStorage.items_storage&&(t.items=JSON.parse(localStorage.getItem("items_storage")),e.$emit("set_all_items",t.items),t.loading=!1),frappe.call({method:"posawesome.posawesome.api.posapp.get_items",args:{pos_profile:t.pos_profile,price_list:t.customer_price_list},callback:function(n){n.message&&(t.items=n.message,e.$emit("set_all_items",t.items),t.loading=!1,console.info("loadItmes"),t.pos_profile.posa_local_storage&&(localStorage.setItem("items_storage",""),localStorage.setItem("items_storage",JSON.stringify(n.message))))}})}else console.log("No POS Profile")},get_items_groups:function(){var e=this;if(this.pos_profile)if(this.pos_profile.item_groups.length>0)this.pos_profile.item_groups.forEach(function(t){"All Item Groups"!==t.item_group&&e.items_group.push(t.item_group)});else{var t=this;frappe.call({method:"posawesome.posawesome.api.posapp.get_items_groups",args:{},callback:function(e){e.message&&e.message.forEach(function(e){t.items_group.push(e.name)})}})}else console.log("No POS Profile")},add_item:function(t){t.has_variants?e.$emit("open_variants_model",t,this.items):e.$emit("add_item",t)},enter_event:function(){var e=this;if(this.filtred_items.length&&this.first_search){var t=this.get_item_qty(this.first_search),n=Object.assign({},this.filtred_items[0]);n.qty=flt(t),n.item_barcode.forEach(function(t){e.search==t.barcode&&(n.uom=t.posa_uom)}),this.flags.serial_no&&(n.to_set_serial_no=this.flags.serial_no),this.add_item(n),this.search=null,this.first_search=null,this.debounce_search=null,this.flags.serial_no=null}},get_item_qty:function(e){var t=1;if(e.startsWith(this.pos_profile.posa_scale_barcode_start)){var n,i=e.substr(7,5);i.startsWith("0000")?n="0.00"+i.substr(4):i.startsWith("000")?n="0.0"+i.substr(3):i.startsWith("00")?n="0."+i.substr(2):i.startsWith("0")?n=i.substr(1,1)+"."+i.substr(2,i.length):i.startsWith("0")||(n=i.substr(0,2)+"."+i.substr(2,i.length)),t=n}return t},get_search:function(e){return e&&e.startsWith(this.pos_profile.posa_scale_barcode_start)?e.substr(0,7):e},esc_event:function(){this.search=null,this.first_search=null},update_items_details:function(e){frappe.call({method:"posawesome.posawesome.api.posapp.get_items_details",args:{pos_profile:this.pos_profile,items_data:e},callback:function(t){t.message&&e.forEach(function(e){var n=t.message.find(function(t){return t.item_code==e.item_code});e.actual_qty=n.actual_qty,e.serial_no_data=n.serial_no_data,e.batch_no_data=n.batch_no_data,e.item_uoms=n.item_uoms})}})},update_cur_items_details:function(){this.update_items_details(this.filtred_items)},scan_barcoud:function(){var e=this;onScan.attachTo(document,{suffixKeyCodes:[],keyCodeMapper:function(e){return e.stopImmediatePropagation(),onScan.decodeKeyEvent(e)},onScan:function(t){setTimeout(function(){e.trigger_onscan(t)},300)}})},trigger_onscan:function(t){0==this.filtred_items.length?(e.$emit("show_mesage",{text:'No Item has this barcode "'+t+'"',color:"error"}),frappe.utils.play_sound("error")):(this.enter_event(),this.debounce_search=null,this.search=null)},formtCurrency:function(e){return(e=parseFloat(e)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}},computed:{filtred_items:function(){var e=this;this.search=this.get_search(this.first_search);var t=[],n=[];return n="ALL"!=this.item_group?this.items.filter(function(t){return t.item_group.toLowerCase().includes(e.item_group.toLowerCase())}):this.items,!this.search||this.search.length<3?this.pos_profile.posa_show_template_items&&this.pos_profile.posa_hide_variants_items?n.filter(function(e){return!e.variant_of}).slice(0,50):n.slice(0,50):(this.search&&0==(t=n.filter(function(t){for(var n=!1,i=0,o=t.item_barcode;i<o.length;i+=1){if(o[i].barcode==e.search){n=!0;break}}return n})).length&&(0==(t=n.filter(function(t){return t.item_code.toLowerCase().includes(e.search.toLowerCase())})).length&&(t=n.filter(function(t){return t.item_name.toLowerCase().includes(e.search.toLowerCase())})),0==t.length&&this.pos_profile.posa_search_serial_no&&(t=n.filter(function(t){for(var n=!1,i=0,o=t.serial_no_data;i<o.length;i+=1){if(o[i].serial_no==e.search){n=!0,e.flags.serial_no=null,e.flags.serial_no=e.search;break}}return n}))),this.pos_profile.posa_show_template_items&&this.pos_profile.posa_hide_variants_items?t.filter(function(e){return!e.variant_of}).slice(0,50):t.slice(0,50))},debounce_search:{get:function(){return this.first_search},set:(function(e,t){(function(){var n,i=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",s="Expected a function",a="Invalid `variable` option passed into `_.template`",c="__lodash_hash_undefined__",l=500,_="__lodash_placeholder__",u=1,f=2,p=4,d=1,m=2,v=1,h=2,g=4,y=8,b=16,w=32,x=64,k=128,C=256,O=512,I=30,$="...",q=800,A=16,S=1,P=2,T=1/0,E=9007199254740991,D=1.7976931348623157e308,R=NaN,F=4294967295,N=F-1,j=F>>>1,L=[["ary",k],["bind",v],["bindKey",h],["curry",y],["curryRight",b],["flip",O],["partial",w],["partialRight",x],["rearg",C]],B="[object Arguments]",z="[object Array]",M="[object AsyncFunction]",G="[object Boolean]",U="[object Date]",W="[object DOMException]",Q="[object Error]",J="[object Function]",K="[object GeneratorFunction]",Y="[object Map]",H="[object Number]",V="[object Null]",Z="[object Object]",X="[object Proxy]",ee="[object RegExp]",te="[object Set]",ne="[object String]",ie="[object Symbol]",oe="[object Undefined]",re="[object WeakMap]",se="[object WeakSet]",ae="[object ArrayBuffer]",ce="[object DataView]",le="[object Float32Array]",_e="[object Float64Array]",ue="[object Int8Array]",fe="[object Int16Array]",pe="[object Int32Array]",de="[object Uint8Array]",me="[object Uint8ClampedArray]",ve="[object Uint16Array]",he="[object Uint32Array]",ge=/\b__p \+= '';/g,ye=/\b(__p \+=) '' \+/g,be=/(__e\(.*?\)|\b__t\)) \+\n'';/g,we=/&(?:amp|lt|gt|quot|#39);/g,xe=/[&<>"']/g,ke=RegExp(we.source),Ce=RegExp(xe.source),Oe=/<%-([\s\S]+?)%>/g,Ie=/<%([\s\S]+?)%>/g,$e=/<%=([\s\S]+?)%>/g,qe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ae=/^\w*$/,Se=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Pe=/[\\^$.*+?()[\]{}|]/g,Te=RegExp(Pe.source),Ee=/^\s+/,De=/\s/,Re=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Fe=/\{\n\/\* \[wrapped with (.+)\] \*/,Ne=/,? & /,je=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Le=/[()=,{}\[\]\/\s]/,Be=/\\(\\)?/g,ze=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Me=/\w*$/,Ge=/^[-+]0x[0-9a-f]+$/i,Ue=/^0b[01]+$/i,We=/^\[object .+?Constructor\]$/,Qe=/^0o[0-7]+$/i,Je=/^(?:0|[1-9]\d*)$/,Ke=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ye=/($^)/,He=/['\n\r\u2028\u2029\\]/g,Ve="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ze="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xe="[\\ud800-\\udfff]",et="["+Ze+"]",tt="["+Ve+"]",nt="\\d+",it="[\\u2700-\\u27bf]",ot="[a-z\\xdf-\\xf6\\xf8-\\xff]",rt="[^\\ud800-\\udfff"+Ze+nt+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",st="\\ud83c[\\udffb-\\udfff]",at="[^\\ud800-\\udfff]",ct="(?:\\ud83c[\\udde6-\\uddff]){2}",lt="[\\ud800-\\udbff][\\udc00-\\udfff]",_t="[A-Z\\xc0-\\xd6\\xd8-\\xde]",ut="(?:"+ot+"|"+rt+")",ft="(?:"+_t+"|"+rt+")",pt="(?:"+tt+"|"+st+")"+"?",dt="[\\ufe0e\\ufe0f]?"+pt+("(?:\\u200d(?:"+[at,ct,lt].join("|")+")[\\ufe0e\\ufe0f]?"+pt+")*"),mt="(?:"+[it,ct,lt].join("|")+")"+dt,vt="(?:"+[at+tt+"?",tt,ct,lt,Xe].join("|")+")",ht=RegExp("['’]","g"),gt=RegExp(tt,"g"),yt=RegExp(st+"(?="+st+")|"+vt+dt,"g"),bt=RegExp([_t+"?"+ot+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[et,_t,"$"].join("|")+")",ft+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[et,_t+ut,"$"].join("|")+")",_t+"?"+ut+"+(?:['’](?:d|ll|m|re|s|t|ve))?",_t+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",nt,mt].join("|"),"g"),wt=RegExp("[\\u200d\\ud800-\\udfff"+Ve+"\\ufe0e\\ufe0f]"),xt=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,kt=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ct=-1,Ot={};Ot[le]=Ot[_e]=Ot[ue]=Ot[fe]=Ot[pe]=Ot[de]=Ot[me]=Ot[ve]=Ot[he]=!0,Ot[B]=Ot[z]=Ot[ae]=Ot[G]=Ot[ce]=Ot[U]=Ot[Q]=Ot[J]=Ot[Y]=Ot[H]=Ot[Z]=Ot[ee]=Ot[te]=Ot[ne]=Ot[re]=!1;var It={};It[B]=It[z]=It[ae]=It[ce]=It[G]=It[U]=It[le]=It[_e]=It[ue]=It[fe]=It[pe]=It[Y]=It[H]=It[Z]=It[ee]=It[te]=It[ne]=It[ie]=It[de]=It[me]=It[ve]=It[he]=!0,It[Q]=It[J]=It[re]=!1;var $t={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},qt=parseFloat,At=parseInt,St="object"==typeof o&&o&&o.Object===Object&&o,Pt="object"==typeof self&&self&&self.Object===Object&&self,Tt=St||Pt||Function("return this")(),Et=t&&!t.nodeType&&t,Dt=Et&&e&&!e.nodeType&&e,Rt=Dt&&Dt.exports===Et,Ft=Rt&&St.process,Nt=function(){try{var e=Dt&&Dt.require&&Dt.require("util").types;return e||Ft&&Ft.binding&&Ft.binding("util")}catch(e){}}(),jt=Nt&&Nt.isArrayBuffer,Lt=Nt&&Nt.isDate,Bt=Nt&&Nt.isMap,zt=Nt&&Nt.isRegExp,Mt=Nt&&Nt.isSet,Gt=Nt&&Nt.isTypedArray;function Ut(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function Wt(e,t,n,i){for(var o=-1,r=null==e?0:e.length;++o<r;){var s=e[o];t(i,s,n(s),e)}return i}function Qt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}function Jt(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function Kt(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(!t(e[n],n,e))return!1;return!0}function Yt(e,t){for(var n=-1,i=null==e?0:e.length,o=0,r=[];++n<i;){var s=e[n];t(s,n,e)&&(r[o++]=s)}return r}function Ht(e,t){return!!(null==e?0:e.length)&&an(e,t,0)>-1}function Vt(e,t,n){for(var i=-1,o=null==e?0:e.length;++i<o;)if(n(t,e[i]))return!0;return!1}function Zt(e,t){for(var n=-1,i=null==e?0:e.length,o=Array(i);++n<i;)o[n]=t(e[n],n,e);return o}function Xt(e,t){for(var n=-1,i=t.length,o=e.length;++n<i;)e[o+n]=t[n];return e}function en(e,t,n,i){var o=-1,r=null==e?0:e.length;for(i&&r&&(n=e[++o]);++o<r;)n=t(n,e[o],o,e);return n}function tn(e,t,n,i){var o=null==e?0:e.length;for(i&&o&&(n=e[--o]);o--;)n=t(n,e[o],o,e);return n}function nn(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}var on=un("length");function rn(e,t,n){var i;return n(e,function(e,n,o){if(t(e,n,o))return i=n,!1}),i}function sn(e,t,n,i){for(var o=e.length,r=n+(i?1:-1);i?r--:++r<o;)if(t(e[r],r,e))return r;return-1}function an(e,t,n){return t==t?function(e,t,n){var i=n-1,o=e.length;for(;++i<o;)if(e[i]===t)return i;return-1}(e,t,n):sn(e,ln,n)}function cn(e,t,n,i){for(var o=n-1,r=e.length;++o<r;)if(i(e[o],t))return o;return-1}function ln(e){return e!=e}function _n(e,t){var n=null==e?0:e.length;return n?dn(e,t)/n:R}function un(e){return function(t){return null==t?n:t[e]}}function fn(e){return function(t){return null==e?n:e[t]}}function pn(e,t,n,i,o){return o(e,function(e,o,r){n=i?(i=!1,e):t(n,e,o,r)}),n}function dn(e,t){for(var i,o=-1,r=e.length;++o<r;){var s=t(e[o]);s!==n&&(i=i===n?s:i+s)}return i}function mn(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}function vn(e){return e?e.slice(0,En(e)+1).replace(Ee,""):e}function hn(e){return function(t){return e(t)}}function gn(e,t){return Zt(t,function(t){return e[t]})}function yn(e,t){return e.has(t)}function bn(e,t){for(var n=-1,i=e.length;++n<i&&an(t,e[n],0)>-1;);return n}function wn(e,t){for(var n=e.length;n--&&an(t,e[n],0)>-1;);return n}var xn=fn({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),kn=fn({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function Cn(e){return"\\"+$t[e]}function On(e){return wt.test(e)}function In(e){var t=-1,n=Array(e.size);return e.forEach(function(e,i){n[++t]=[i,e]}),n}function $n(e,t){return function(n){return e(t(n))}}function qn(e,t){for(var n=-1,i=e.length,o=0,r=[];++n<i;){var s=e[n];s!==t&&s!==_||(e[n]=_,r[o++]=n)}return r}function An(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function Sn(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}function Pn(e){return On(e)?function(e){var t=yt.lastIndex=0;for(;yt.test(e);)++t;return t}(e):on(e)}function Tn(e){return On(e)?function(e){return e.match(yt)||[]}(e):function(e){return e.split("")}(e)}function En(e){for(var t=e.length;t--&&De.test(e.charAt(t)););return t}var Dn=fn({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var Rn=function e(t){var o,De=(t=null==t?Tt:Rn.defaults(Tt.Object(),t,Rn.pick(Tt,kt))).Array,Ve=t.Date,Ze=t.Error,Xe=t.Function,et=t.Math,tt=t.Object,nt=t.RegExp,it=t.String,ot=t.TypeError,rt=De.prototype,st=Xe.prototype,at=tt.prototype,ct=t["__core-js_shared__"],lt=st.toString,_t=at.hasOwnProperty,ut=0,ft=(o=/[^.]+$/.exec(ct&&ct.keys&&ct.keys.IE_PROTO||""))?"Symbol(src)_1."+o:"",pt=at.toString,dt=lt.call(tt),mt=Tt._,vt=nt("^"+lt.call(_t).replace(Pe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),yt=Rt?t.Buffer:n,wt=t.Symbol,$t=t.Uint8Array,St=yt?yt.allocUnsafe:n,Pt=$n(tt.getPrototypeOf,tt),Et=tt.create,Dt=at.propertyIsEnumerable,Ft=rt.splice,Nt=wt?wt.isConcatSpreadable:n,on=wt?wt.iterator:n,fn=wt?wt.toStringTag:n,Fn=function(){try{var e=zr(tt,"defineProperty");return e({},"",{}),e}catch(e){}}(),Nn=t.clearTimeout!==Tt.clearTimeout&&t.clearTimeout,jn=Ve&&Ve.now!==Tt.Date.now&&Ve.now,Ln=t.setTimeout!==Tt.setTimeout&&t.setTimeout,Bn=et.ceil,zn=et.floor,Mn=tt.getOwnPropertySymbols,Gn=yt?yt.isBuffer:n,Un=t.isFinite,Wn=rt.join,Qn=$n(tt.keys,tt),Jn=et.max,Kn=et.min,Yn=Ve.now,Hn=t.parseInt,Vn=et.random,Zn=rt.reverse,Xn=zr(t,"DataView"),ei=zr(t,"Map"),ti=zr(t,"Promise"),ni=zr(t,"Set"),ii=zr(t,"WeakMap"),oi=zr(tt,"create"),ri=ii&&new ii,si={},ai=ps(Xn),ci=ps(ei),li=ps(ti),_i=ps(ni),ui=ps(ii),fi=wt?wt.prototype:n,pi=fi?fi.valueOf:n,di=fi?fi.toString:n;function mi(e){if(Sa(e)&&!ya(e)&&!(e instanceof yi)){if(e instanceof gi)return e;if(_t.call(e,"__wrapped__"))return ds(e)}return new gi(e)}var vi=function(){function e(){}return function(t){if(!Aa(t))return{};if(Et)return Et(t);e.prototype=t;var i=new e;return e.prototype=n,i}}();function hi(){}function gi(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=n}function yi(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=F,this.__views__=[]}function bi(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function wi(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function xi(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function ki(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new xi;++t<n;)this.add(e[t])}function Ci(e){var t=this.__data__=new wi(e);this.size=t.size}function Oi(e,t){var n=ya(e),i=!n&&ga(e),o=!n&&!i&&ka(e),r=!n&&!i&&!o&&ja(e),s=n||i||o||r,a=s?mn(e.length,it):[],c=a.length;for(var l in e)!t&&!_t.call(e,l)||s&&("length"==l||o&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Kr(l,c))||a.push(l);return a}function Ii(e){var t=e.length;return t?e[Co(0,t-1)]:n}function $i(e,t){return _s(rr(e),Fi(t,0,e.length))}function qi(e){return _s(rr(e))}function Ai(e,t,i){(i===n||ma(e[t],i))&&(i!==n||t in e)||Di(e,t,i)}function Si(e,t,i){var o=e[t];_t.call(e,t)&&ma(o,i)&&(i!==n||t in e)||Di(e,t,i)}function Pi(e,t){for(var n=e.length;n--;)if(ma(e[n][0],t))return n;return-1}function Ti(e,t,n,i){return zi(e,function(e,o,r){t(i,e,n(e),r)}),i}function Ei(e,t){return e&&sr(t,sc(t),e)}function Di(e,t,n){"__proto__"==t&&Fn?Fn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Ri(e,t){for(var i=-1,o=t.length,r=De(o),s=null==e;++i<o;)r[i]=s?n:tc(e,t[i]);return r}function Fi(e,t,i){return e==e&&(i!==n&&(e=e<=i?e:i),t!==n&&(e=e>=t?e:t)),e}function Ni(e,t,i,o,r,s){var a,c=t&u,l=t&f,_=t&p;if(i&&(a=r?i(e,o,r,s):i(e)),a!==n)return a;if(!Aa(e))return e;var d=ya(e);if(d){if(a=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&_t.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!c)return rr(e,a)}else{var m=Ur(e),v=m==J||m==K;if(ka(e))return Xo(e,c);if(m==Z||m==B||v&&!r){if(a=l||v?{}:Qr(e),!c)return l?function(e,t){return sr(e,Gr(e),t)}(e,function(e,t){return e&&sr(t,ac(t),e)}(a,e)):function(e,t){return sr(e,Mr(e),t)}(e,Ei(a,e))}else{if(!It[m])return r?e:{};a=function(e,t,n){var i,o,r,s=e.constructor;switch(t){case ae:return er(e);case G:case U:return new s(+e);case ce:return function(e,t){var n=t?er(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case le:case _e:case ue:case fe:case pe:case de:case me:case ve:case he:return tr(e,n);case Y:return new s;case H:case ne:return new s(e);case ee:return(r=new(o=e).constructor(o.source,Me.exec(o))).lastIndex=o.lastIndex,r;case te:return new s;case ie:return i=e,pi?tt(pi.call(i)):{}}}(e,m,c)}}s||(s=new Ci);var h=s.get(e);if(h)return h;s.set(e,a),Ra(e)?e.forEach(function(n){a.add(Ni(n,t,i,n,e,s))}):Pa(e)&&e.forEach(function(n,o){a.set(o,Ni(n,t,i,o,e,s))});var g=d?n:(_?l?Dr:Er:l?ac:sc)(e);return Qt(g||e,function(n,o){g&&(n=e[o=n]),Si(a,o,Ni(n,t,i,o,e,s))}),a}function ji(e,t,i){var o=i.length;if(null==e)return!o;for(e=tt(e);o--;){var r=i[o],s=t[r],a=e[r];if(a===n&&!(r in e)||!s(a))return!1}return!0}function Li(e,t,i){if("function"!=typeof e)throw new ot(s);return ss(function(){e.apply(n,i)},t)}function Bi(e,t,n,o){var r=-1,s=Ht,a=!0,c=e.length,l=[],_=t.length;if(!c)return l;n&&(t=Zt(t,hn(n))),o?(s=Vt,a=!1):t.length>=i&&(s=yn,a=!1,t=new ki(t));e:for(;++r<c;){var u=e[r],f=null==n?u:n(u);if(u=o||0!==u?u:0,a&&f==f){for(var p=_;p--;)if(t[p]===f)continue e;l.push(u)}else s(t,f,o)||l.push(u)}return l}mi.templateSettings={escape:Oe,evaluate:Ie,interpolate:$e,variable:"",imports:{_:mi}},mi.prototype=hi.prototype,mi.prototype.constructor=mi,gi.prototype=vi(hi.prototype),gi.prototype.constructor=gi,yi.prototype=vi(hi.prototype),yi.prototype.constructor=yi,bi.prototype.clear=function(){this.__data__=oi?oi(null):{},this.size=0},bi.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},bi.prototype.get=function(e){var t=this.__data__;if(oi){var i=t[e];return i===c?n:i}return _t.call(t,e)?t[e]:n},bi.prototype.has=function(e){var t=this.__data__;return oi?t[e]!==n:_t.call(t,e)},bi.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=oi&&t===n?c:t,this},wi.prototype.clear=function(){this.__data__=[],this.size=0},wi.prototype.delete=function(e){var t=this.__data__,n=Pi(t,e);return!(n<0||(n==t.length-1?t.pop():Ft.call(t,n,1),--this.size,0))},wi.prototype.get=function(e){var t=this.__data__,i=Pi(t,e);return i<0?n:t[i][1]},wi.prototype.has=function(e){return Pi(this.__data__,e)>-1},wi.prototype.set=function(e,t){var n=this.__data__,i=Pi(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this},xi.prototype.clear=function(){this.size=0,this.__data__={hash:new bi,map:new(ei||wi),string:new bi}},xi.prototype.delete=function(e){var t=Lr(this,e).delete(e);return this.size-=t?1:0,t},xi.prototype.get=function(e){return Lr(this,e).get(e)},xi.prototype.has=function(e){return Lr(this,e).has(e)},xi.prototype.set=function(e,t){var n=Lr(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this},ki.prototype.add=ki.prototype.push=function(e){return this.__data__.set(e,c),this},ki.prototype.has=function(e){return this.__data__.has(e)},Ci.prototype.clear=function(){this.__data__=new wi,this.size=0},Ci.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Ci.prototype.get=function(e){return this.__data__.get(e)},Ci.prototype.has=function(e){return this.__data__.has(e)},Ci.prototype.set=function(e,t){var n=this.__data__;if(n instanceof wi){var o=n.__data__;if(!ei||o.length<i-1)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new xi(o)}return n.set(e,t),this.size=n.size,this};var zi=lr(Yi),Mi=lr(Hi,!0);function Gi(e,t){var n=!0;return zi(e,function(e,i,o){return n=!!t(e,i,o)}),n}function Ui(e,t,i){for(var o=-1,r=e.length;++o<r;){var s=e[o],a=t(s);if(null!=a&&(c===n?a==a&&!Na(a):i(a,c)))var c=a,l=s}return l}function Wi(e,t){var n=[];return zi(e,function(e,i,o){t(e,i,o)&&n.push(e)}),n}function Qi(e,t,n,i,o){var r=-1,s=e.length;for(n||(n=Jr),o||(o=[]);++r<s;){var a=e[r];t>0&&n(a)?t>1?Qi(a,t-1,n,i,o):Xt(o,a):i||(o[o.length]=a)}return o}var Ji=_r(),Ki=_r(!0);function Yi(e,t){return e&&Ji(e,t,sc)}function Hi(e,t){return e&&Ki(e,t,sc)}function Vi(e,t){return Yt(t,function(t){return Ia(e[t])})}function Zi(e,t){for(var i=0,o=(t=Yo(t,e)).length;null!=e&&i<o;)e=e[fs(t[i++])];return i&&i==o?e:n}function Xi(e,t,n){var i=t(e);return ya(e)?i:Xt(i,n(e))}function eo(e){return null==e?e===n?oe:V:fn&&fn in tt(e)?function(e){var t=_t.call(e,fn),i=e[fn];try{e[fn]=n;var o=!0}catch(e){}var r=pt.call(e);return o&&(t?e[fn]=i:delete e[fn]),r}(e):function(e){return pt.call(e)}(e)}function to(e,t){return e>t}function no(e,t){return null!=e&&_t.call(e,t)}function io(e,t){return null!=e&&t in tt(e)}function oo(e,t,i){for(var o=i?Vt:Ht,r=e[0].length,s=e.length,a=s,c=De(s),l=1/0,_=[];a--;){var u=e[a];a&&t&&(u=Zt(u,hn(t))),l=Kn(u.length,l),c[a]=!i&&(t||r>=120&&u.length>=120)?new ki(a&&u):n}u=e[0];var f=-1,p=c[0];e:for(;++f<r&&_.length<l;){var d=u[f],m=t?t(d):d;if(d=i||0!==d?d:0,!(p?yn(p,m):o(_,m,i))){for(a=s;--a;){var v=c[a];if(!(v?yn(v,m):o(e[a],m,i)))continue e}p&&p.push(m),_.push(d)}}return _}function ro(e,t,i){var o=null==(e=is(e,t=Yo(t,e)))?e:e[fs(Os(t))];return null==o?n:Ut(o,e,i)}function so(e){return Sa(e)&&eo(e)==B}function ao(e,t,i,o,r){return e===t||(null==e||null==t||!Sa(e)&&!Sa(t)?e!=e&&t!=t:function(e,t,i,o,r,s){var a=ya(e),c=ya(t),l=a?z:Ur(e),_=c?z:Ur(t),u=(l=l==B?Z:l)==Z,f=(_=_==B?Z:_)==Z,p=l==_;if(p&&ka(e)){if(!ka(t))return!1;a=!0,u=!1}if(p&&!u)return s||(s=new Ci),a||ja(e)?Pr(e,t,i,o,r,s):function(e,t,n,i,o,r,s){switch(n){case ce:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ae:return!(e.byteLength!=t.byteLength||!r(new $t(e),new $t(t)));case G:case U:case H:return ma(+e,+t);case Q:return e.name==t.name&&e.message==t.message;case ee:case ne:return e==t+"";case Y:var a=In;case te:var c=i&d;if(a||(a=An),e.size!=t.size&&!c)return!1;var l=s.get(e);if(l)return l==t;i|=m,s.set(e,t);var _=Pr(a(e),a(t),i,o,r,s);return s.delete(e),_;case ie:if(pi)return pi.call(e)==pi.call(t)}return!1}(e,t,l,i,o,r,s);if(!(i&d)){var v=u&&_t.call(e,"__wrapped__"),h=f&&_t.call(t,"__wrapped__");if(v||h){var g=v?e.value():e,y=h?t.value():t;return s||(s=new Ci),r(g,y,i,o,s)}}return!!p&&(s||(s=new Ci),function(e,t,i,o,r,s){var a=i&d,c=Er(e),l=c.length,_=Er(t).length;if(l!=_&&!a)return!1;for(var u=l;u--;){var f=c[u];if(!(a?f in t:_t.call(t,f)))return!1}var p=s.get(e),m=s.get(t);if(p&&m)return p==t&&m==e;var v=!0;s.set(e,t),s.set(t,e);for(var h=a;++u<l;){f=c[u];var g=e[f],y=t[f];if(o)var b=a?o(y,g,f,t,e,s):o(g,y,f,e,t,s);if(!(b===n?g===y||r(g,y,i,o,s):b)){v=!1;break}h||(h="constructor"==f)}if(v&&!h){var w=e.constructor,x=t.constructor;w!=x&&"constructor"in e&&"constructor"in t&&!("function"==typeof w&&w instanceof w&&"function"==typeof x&&x instanceof x)&&(v=!1)}return s.delete(e),s.delete(t),v}(e,t,i,o,r,s))}(e,t,i,o,ao,r))}function co(e,t,i,o){var r=i.length,s=r,a=!o;if(null==e)return!s;for(e=tt(e);r--;){var c=i[r];if(a&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++r<s;){var l=(c=i[r])[0],_=e[l],u=c[1];if(a&&c[2]){if(_===n&&!(l in e))return!1}else{var f=new Ci;if(o)var p=o(_,u,l,e,t,f);if(!(p===n?ao(u,_,d|m,o,f):p))return!1}}return!0}function lo(e){return!(!Aa(e)||(t=e,ft&&ft in t))&&(Ia(e)?vt:We).test(ps(e));var t}function _o(e){return"function"==typeof e?e:null==e?Tc:"object"==typeof e?ya(e)?ho(e[0],e[1]):vo(e):zc(e)}function uo(e){if(!Xr(e))return Qn(e);var t=[];for(var n in tt(e))_t.call(e,n)&&"constructor"!=n&&t.push(n);return t}function fo(e){if(!Aa(e))return function(e){var t=[];if(null!=e)for(var n in tt(e))t.push(n);return t}(e);var t=Xr(e),n=[];for(var i in e)("constructor"!=i||!t&&_t.call(e,i))&&n.push(i);return n}function po(e,t){return e<t}function mo(e,t){var n=-1,i=wa(e)?De(e.length):[];return zi(e,function(e,o,r){i[++n]=t(e,o,r)}),i}function vo(e){var t=Br(e);return 1==t.length&&t[0][2]?ts(t[0][0],t[0][1]):function(n){return n===e||co(n,e,t)}}function ho(e,t){return Hr(e)&&es(t)?ts(fs(e),t):function(i){var o=tc(i,e);return o===n&&o===t?nc(i,e):ao(t,o,d|m)}}function go(e,t,i,o,r){e!==t&&Ji(t,function(s,a){if(r||(r=new Ci),Aa(s))!function(e,t,i,o,r,s,a){var c=os(e,i),l=os(t,i),_=a.get(l);if(_)Ai(e,i,_);else{var u=s?s(c,l,i+"",e,t,a):n,f=u===n;if(f){var p=ya(l),d=!p&&ka(l),m=!p&&!d&&ja(l);u=l,p||d||m?ya(c)?u=c:xa(c)?u=rr(c):d?(f=!1,u=Xo(l,!0)):m?(f=!1,u=tr(l,!0)):u=[]:Ea(l)||ga(l)?(u=c,ga(c)?u=Qa(c):Aa(c)&&!Ia(c)||(u=Qr(l))):f=!1}f&&(a.set(l,u),r(u,l,o,s,a),a.delete(l)),Ai(e,i,u)}}(e,t,a,i,go,o,r);else{var c=o?o(os(e,a),s,a+"",e,t,r):n;c===n&&(c=s),Ai(e,a,c)}},ac)}function yo(e,t){var i=e.length;if(i)return Kr(t+=t<0?i:0,i)?e[t]:n}function bo(e,t,n){t=t.length?Zt(t,function(e){return ya(e)?function(t){return Zi(t,1===e.length?e[0]:e)}:e}):[Tc];var i=-1;return t=Zt(t,hn(jr())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(mo(e,function(e,n,o){return{criteria:Zt(t,function(t){return t(e)}),index:++i,value:e}}),function(e,t){return function(e,t,n){for(var i=-1,o=e.criteria,r=t.criteria,s=o.length,a=n.length;++i<s;){var c=nr(o[i],r[i]);if(c){if(i>=a)return c;var l=n[i];return c*("desc"==l?-1:1)}}return e.index-t.index}(e,t,n)})}function wo(e,t,n){for(var i=-1,o=t.length,r={};++i<o;){var s=t[i],a=Zi(e,s);n(a,s)&&Ao(r,Yo(s,e),a)}return r}function xo(e,t,n,i){var o=i?cn:an,r=-1,s=t.length,a=e;for(e===t&&(t=rr(t)),n&&(a=Zt(e,hn(n)));++r<s;)for(var c=0,l=t[r],_=n?n(l):l;(c=o(a,_,c,i))>-1;)a!==e&&Ft.call(a,c,1),Ft.call(e,c,1);return e}function ko(e,t){for(var n=e?t.length:0,i=n-1;n--;){var o=t[n];if(n==i||o!==r){var r=o;Kr(o)?Ft.call(e,o,1):zo(e,o)}}return e}function Co(e,t){return e+zn(Vn()*(t-e+1))}function Oo(e,t){var n="";if(!e||t<1||t>E)return n;do{t%2&&(n+=e),(t=zn(t/2))&&(e+=e)}while(t);return n}function Io(e,t){return as(ns(e,t,Tc),e+"")}function $o(e){return Ii(mc(e))}function qo(e,t){var n=mc(e);return _s(n,Fi(t,0,n.length))}function Ao(e,t,i,o){if(!Aa(e))return e;for(var r=-1,s=(t=Yo(t,e)).length,a=s-1,c=e;null!=c&&++r<s;){var l=fs(t[r]),_=i;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(r!=a){var u=c[l];(_=o?o(u,l,c):n)===n&&(_=Aa(u)?u:Kr(t[r+1])?[]:{})}Si(c,l,_),c=c[l]}return e}var So=ri?function(e,t){return ri.set(e,t),e}:Tc,Po=Fn?function(e,t){return Fn(e,"toString",{configurable:!0,enumerable:!1,value:Ac(t),writable:!0})}:Tc;function To(e){return _s(mc(e))}function Eo(e,t,n){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var r=De(o);++i<o;)r[i]=e[i+t];return r}function Do(e,t){var n;return zi(e,function(e,i,o){return!(n=t(e,i,o))}),!!n}function Ro(e,t,n){var i=0,o=null==e?i:e.length;if("number"==typeof t&&t==t&&o<=j){for(;i<o;){var r=i+o>>>1,s=e[r];null!==s&&!Na(s)&&(n?s<=t:s<t)?i=r+1:o=r}return o}return Fo(e,t,Tc,n)}function Fo(e,t,i,o){var r=0,s=null==e?0:e.length;if(0===s)return 0;for(var a=(t=i(t))!=t,c=null===t,l=Na(t),_=t===n;r<s;){var u=zn((r+s)/2),f=i(e[u]),p=f!==n,d=null===f,m=f==f,v=Na(f);if(a)var h=o||m;else h=_?m&&(o||p):c?m&&p&&(o||!d):l?m&&p&&!d&&(o||!v):!d&&!v&&(o?f<=t:f<t);h?r=u+1:s=u}return Kn(s,N)}function No(e,t){for(var n=-1,i=e.length,o=0,r=[];++n<i;){var s=e[n],a=t?t(s):s;if(!n||!ma(a,c)){var c=a;r[o++]=0===s?0:s}}return r}function jo(e){return"number"==typeof e?e:Na(e)?R:+e}function Lo(e){if("string"==typeof e)return e;if(ya(e))return Zt(e,Lo)+"";if(Na(e))return di?di.call(e):"";var t=e+"";return"0"==t&&1/e==-T?"-0":t}function Bo(e,t,n){var o=-1,r=Ht,s=e.length,a=!0,c=[],l=c;if(n)a=!1,r=Vt;else if(s>=i){var _=t?null:Or(e);if(_)return An(_);a=!1,r=yn,l=new ki}else l=t?[]:c;e:for(;++o<s;){var u=e[o],f=t?t(u):u;if(u=n||0!==u?u:0,a&&f==f){for(var p=l.length;p--;)if(l[p]===f)continue e;t&&l.push(f),c.push(u)}else r(l,f,n)||(l!==c&&l.push(f),c.push(u))}return c}function zo(e,t){return null==(e=is(e,t=Yo(t,e)))||delete e[fs(Os(t))]}function Mo(e,t,n,i){return Ao(e,t,n(Zi(e,t)),i)}function Go(e,t,n,i){for(var o=e.length,r=i?o:-1;(i?r--:++r<o)&&t(e[r],r,e););return n?Eo(e,i?0:r,i?r+1:o):Eo(e,i?r+1:0,i?o:r)}function Uo(e,t){var n=e;return n instanceof yi&&(n=n.value()),en(t,function(e,t){return t.func.apply(t.thisArg,Xt([e],t.args))},n)}function Wo(e,t,n){var i=e.length;if(i<2)return i?Bo(e[0]):[];for(var o=-1,r=De(i);++o<i;)for(var s=e[o],a=-1;++a<i;)a!=o&&(r[o]=Bi(r[o]||s,e[a],t,n));return Bo(Qi(r,1),t,n)}function Qo(e,t,i){for(var o=-1,r=e.length,s=t.length,a={};++o<r;){var c=o<s?t[o]:n;i(a,e[o],c)}return a}function Jo(e){return xa(e)?e:[]}function Ko(e){return"function"==typeof e?e:Tc}function Yo(e,t){return ya(e)?e:Hr(e,t)?[e]:us(Ja(e))}var Ho=Io;function Vo(e,t,i){var o=e.length;return i=i===n?o:i,!t&&i>=o?e:Eo(e,t,i)}var Zo=Nn||function(e){return Tt.clearTimeout(e)};function Xo(e,t){if(t)return e.slice();var n=e.length,i=St?St(n):new e.constructor(n);return e.copy(i),i}function er(e){var t=new e.constructor(e.byteLength);return new $t(t).set(new $t(e)),t}function tr(e,t){var n=t?er(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function nr(e,t){if(e!==t){var i=e!==n,o=null===e,r=e==e,s=Na(e),a=t!==n,c=null===t,l=t==t,_=Na(t);if(!c&&!_&&!s&&e>t||s&&a&&l&&!c&&!_||o&&a&&l||!i&&l||!r)return 1;if(!o&&!s&&!_&&e<t||_&&i&&r&&!o&&!s||c&&i&&r||!a&&r||!l)return-1}return 0}function ir(e,t,n,i){for(var o=-1,r=e.length,s=n.length,a=-1,c=t.length,l=Jn(r-s,0),_=De(c+l),u=!i;++a<c;)_[a]=t[a];for(;++o<s;)(u||o<r)&&(_[n[o]]=e[o]);for(;l--;)_[a++]=e[o++];return _}function or(e,t,n,i){for(var o=-1,r=e.length,s=-1,a=n.length,c=-1,l=t.length,_=Jn(r-a,0),u=De(_+l),f=!i;++o<_;)u[o]=e[o];for(var p=o;++c<l;)u[p+c]=t[c];for(;++s<a;)(f||o<r)&&(u[p+n[s]]=e[o++]);return u}function rr(e,t){var n=-1,i=e.length;for(t||(t=De(i));++n<i;)t[n]=e[n];return t}function sr(e,t,i,o){var r=!i;i||(i={});for(var s=-1,a=t.length;++s<a;){var c=t[s],l=o?o(i[c],e[c],c,i,e):n;l===n&&(l=e[c]),r?Di(i,c,l):Si(i,c,l)}return i}function ar(e,t){return function(n,i){var o=ya(n)?Wt:Ti,r=t?t():{};return o(n,e,jr(i,2),r)}}function cr(e){return Io(function(t,i){var o=-1,r=i.length,s=r>1?i[r-1]:n,a=r>2?i[2]:n;for(s=e.length>3&&"function"==typeof s?(r--,s):n,a&&Yr(i[0],i[1],a)&&(s=r<3?n:s,r=1),t=tt(t);++o<r;){var c=i[o];c&&e(t,c,o,s)}return t})}function lr(e,t){return function(n,i){if(null==n)return n;if(!wa(n))return e(n,i);for(var o=n.length,r=t?o:-1,s=tt(n);(t?r--:++r<o)&&!1!==i(s[r],r,s););return n}}function _r(e){return function(t,n,i){for(var o=-1,r=tt(t),s=i(t),a=s.length;a--;){var c=s[e?a:++o];if(!1===n(r[c],c,r))break}return t}}function ur(e){return function(t){var i=On(t=Ja(t))?Tn(t):n,o=i?i[0]:t.charAt(0),r=i?Vo(i,1).join(""):t.slice(1);return o[e]()+r}}function fr(e){return function(t){return en(Ic(gc(t).replace(ht,"")),e,"")}}function pr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=vi(e.prototype),i=e.apply(n,t);return Aa(i)?i:n}}function dr(e){return function(t,i,o){var r=tt(t);if(!wa(t)){var s=jr(i,3);t=sc(t),i=function(e){return s(r[e],e,r)}}var a=e(t,i,o);return a>-1?r[s?t[a]:a]:n}}function mr(e){return Tr(function(t){var i=t.length,o=i,r=gi.prototype.thru;for(e&&t.reverse();o--;){var a=t[o];if("function"!=typeof a)throw new ot(s);if(r&&!c&&"wrapper"==Fr(a))var c=new gi([],!0)}for(o=c?o:i;++o<i;){var l=Fr(a=t[o]),_="wrapper"==l?Rr(a):n;c=_&&Vr(_[0])&&_[1]==(k|y|w|C)&&!_[4].length&&1==_[9]?c[Fr(_[0])].apply(c,_[3]):1==a.length&&Vr(a)?c[l]():c.thru(a)}return function(){var e=arguments,n=e[0];if(c&&1==e.length&&ya(n))return c.plant(n).value();for(var o=0,r=i?t[o].apply(this,e):n;++o<i;)r=t[o].call(this,r);return r}})}function vr(e,t,i,o,r,s,a,c,l,_){var u=t&k,f=t&v,p=t&h,d=t&(y|b),m=t&O,g=p?n:pr(e);return function v(){for(var h=arguments,y=arguments.length,b=De(y),w=y;w--;)b[w]=h[w];if(d)var x=Nr(v),k=function(e,t){for(var n=e.length,i=0;n--;)e[n]===t&&++i;return i}(b,x);if(o&&(b=ir(b,o,r,d)),s&&(b=or(b,s,a,d)),y-=k,d&&y<_){var C=qn(b,x);return kr(e,t,vr,v.placeholder,i,b,C,c,l,_-y)}var O=f?i:this,I=p?O[e]:e;return y=b.length,c?b=function(e,t){for(var i=e.length,o=Kn(t.length,i),r=rr(e);o--;){var s=t[o];e[o]=Kr(s,i)?r[s]:n}return e}(b,c):m&&y>1&&b.reverse(),u&&l<y&&(b.length=l),this&&this!==Tt&&this instanceof v&&(I=g||pr(I)),I.apply(O,b)}}function hr(e,t){return function(n,i){return function(e,t,n,i){return Yi(e,function(e,o,r){t(i,n(e),o,r)}),i}(n,e,t(i),{})}}function gr(e,t){return function(i,o){var r;if(i===n&&o===n)return t;if(i!==n&&(r=i),o!==n){if(r===n)return o;"string"==typeof i||"string"==typeof o?(i=Lo(i),o=Lo(o)):(i=jo(i),o=jo(o)),r=e(i,o)}return r}}function yr(e){return Tr(function(t){return t=Zt(t,hn(jr())),Io(function(n){var i=this;return e(t,function(e){return Ut(e,i,n)})})})}function br(e,t){var i=(t=t===n?" ":Lo(t)).length;if(i<2)return i?Oo(t,e):t;var o=Oo(t,Bn(e/Pn(t)));return On(t)?Vo(Tn(o),0,e).join(""):o.slice(0,e)}function wr(e){return function(t,i,o){return o&&"number"!=typeof o&&Yr(t,i,o)&&(i=o=n),t=Ma(t),i===n?(i=t,t=0):i=Ma(i),function(e,t,n,i){for(var o=-1,r=Jn(Bn((t-e)/(n||1)),0),s=De(r);r--;)s[i?r:++o]=e,e+=n;return s}(t,i,o=o===n?t<i?1:-1:Ma(o),e)}}function xr(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=Wa(t),n=Wa(n)),e(t,n)}}function kr(e,t,i,o,r,s,a,c,l,_){var u=t&y;t|=u?w:x,(t&=~(u?x:w))&g||(t&=~(v|h));var f=[e,t,r,u?s:n,u?a:n,u?n:s,u?n:a,c,l,_],p=i.apply(n,f);return Vr(e)&&rs(p,f),p.placeholder=o,cs(p,e,t)}function Cr(e){var t=et[e];return function(e,n){if(e=Wa(e),(n=null==n?0:Kn(Ga(n),292))&&Un(e)){var i=(Ja(e)+"e").split("e");return+((i=(Ja(t(i[0]+"e"+(+i[1]+n)))+"e").split("e"))[0]+"e"+(+i[1]-n))}return t(e)}}var Or=ni&&1/An(new ni([,-0]))[1]==T?function(e){return new ni(e)}:Nc;function Ir(e){return function(t){var n=Ur(t);return n==Y?In(t):n==te?Sn(t):function(e,t){return Zt(t,function(t){return[t,e[t]]})}(t,e(t))}}function $r(e,t,i,o,r,a,c,l){var u=t&h;if(!u&&"function"!=typeof e)throw new ot(s);var f=o?o.length:0;if(f||(t&=~(w|x),o=r=n),c=c===n?c:Jn(Ga(c),0),l=l===n?l:Ga(l),f-=r?r.length:0,t&x){var p=o,d=r;o=r=n}var m=u?n:Rr(e),O=[e,t,i,o,r,p,d,a,c,l];if(m&&function(e,t){var n=e[1],i=t[1],o=n|i,r=o<(v|h|k),s=i==k&&n==y||i==k&&n==C&&e[7].length<=t[8]||i==(k|C)&&t[7].length<=t[8]&&n==y;if(!r&&!s)return e;i&v&&(e[2]=t[2],o|=n&v?0:g);var a=t[3];if(a){var c=e[3];e[3]=c?ir(c,a,t[4]):a,e[4]=c?qn(e[3],_):t[4]}(a=t[5])&&(c=e[5],e[5]=c?or(c,a,t[6]):a,e[6]=c?qn(e[5],_):t[6]),(a=t[7])&&(e[7]=a),i&k&&(e[8]=null==e[8]?t[8]:Kn(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=o}(O,m),e=O[0],t=O[1],i=O[2],o=O[3],r=O[4],!(l=O[9]=O[9]===n?u?0:e.length:Jn(O[9]-f,0))&&t&(y|b)&&(t&=~(y|b)),t&&t!=v)I=t==y||t==b?function(e,t,i){var o=pr(e);return function r(){for(var s=arguments,a=arguments.length,c=De(a),l=a,_=Nr(r);l--;)c[l]=s[l];var u=a<3&&c[0]!==_&&c[a-1]!==_?[]:qn(c,_);return(a-=u.length)<i?kr(e,t,vr,r.placeholder,n,c,u,n,n,i-a):Ut(this&&this!==Tt&&this instanceof r?o:e,this,c)}}(e,t,l):t!=w&&t!=(v|w)||r.length?vr.apply(n,O):function(e,t,n,i){var o=t&v,r=pr(e);return function t(){for(var s=arguments,a=-1,c=arguments.length,l=-1,_=i.length,u=De(_+c),f=this&&this!==Tt&&this instanceof t?r:e;++l<_;)u[l]=i[l];for(;c--;)u[l++]=s[++a];return Ut(f,o?n:this,u)}}(e,t,i,o);else var I=function(e,t,n){var i=t&v,o=pr(e);return function t(){return(this&&this!==Tt&&this instanceof t?o:e).apply(i?n:this,arguments)}}(e,t,i);return cs((m?So:rs)(I,O),e,t)}function qr(e,t,i,o){return e===n||ma(e,at[i])&&!_t.call(o,i)?t:e}function Ar(e,t,i,o,r,s){return Aa(e)&&Aa(t)&&(s.set(t,e),go(e,t,n,Ar,s),s.delete(t)),e}function Sr(e){return Ea(e)?n:e}function Pr(e,t,i,o,r,s){var a=i&d,c=e.length,l=t.length;if(c!=l&&!(a&&l>c))return!1;var _=s.get(e),u=s.get(t);if(_&&u)return _==t&&u==e;var f=-1,p=!0,v=i&m?new ki:n;for(s.set(e,t),s.set(t,e);++f<c;){var h=e[f],g=t[f];if(o)var y=a?o(g,h,f,t,e,s):o(h,g,f,e,t,s);if(y!==n){if(y)continue;p=!1;break}if(v){if(!nn(t,function(e,t){if(!yn(v,t)&&(h===e||r(h,e,i,o,s)))return v.push(t)})){p=!1;break}}else if(h!==g&&!r(h,g,i,o,s)){p=!1;break}}return s.delete(e),s.delete(t),p}function Tr(e){return as(ns(e,n,bs),e+"")}function Er(e){return Xi(e,sc,Mr)}function Dr(e){return Xi(e,ac,Gr)}var Rr=ri?function(e){return ri.get(e)}:Nc;function Fr(e){for(var t=e.name+"",n=si[t],i=_t.call(si,t)?n.length:0;i--;){var o=n[i],r=o.func;if(null==r||r==e)return o.name}return t}function Nr(e){return(_t.call(mi,"placeholder")?mi:e).placeholder}function jr(){var e=mi.iteratee||Ec;return e=e===Ec?_o:e,arguments.length?e(arguments[0],arguments[1]):e}function Lr(e,t){var n,i,o=e.__data__;return("string"==(i=typeof(n=t))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function Br(e){for(var t=sc(e),n=t.length;n--;){var i=t[n],o=e[i];t[n]=[i,o,es(o)]}return t}function zr(e,t){var i=function(e,t){return null==e?n:e[t]}(e,t);return lo(i)?i:n}var Mr=Mn?function(e){return null==e?[]:(e=tt(e),Yt(Mn(e),function(t){return Dt.call(e,t)}))}:Uc,Gr=Mn?function(e){for(var t=[];e;)Xt(t,Mr(e)),e=Pt(e);return t}:Uc,Ur=eo;function Wr(e,t,n){for(var i=-1,o=(t=Yo(t,e)).length,r=!1;++i<o;){var s=fs(t[i]);if(!(r=null!=e&&n(e,s)))break;e=e[s]}return r||++i!=o?r:!!(o=null==e?0:e.length)&&qa(o)&&Kr(s,o)&&(ya(e)||ga(e))}function Qr(e){return"function"!=typeof e.constructor||Xr(e)?{}:vi(Pt(e))}function Jr(e){return ya(e)||ga(e)||!!(Nt&&e&&e[Nt])}function Kr(e,t){var n=typeof e;return!!(t=null==t?E:t)&&("number"==n||"symbol"!=n&&Je.test(e))&&e>-1&&e%1==0&&e<t}function Yr(e,t,n){if(!Aa(n))return!1;var i=typeof t;return!!("number"==i?wa(n)&&Kr(t,n.length):"string"==i&&t in n)&&ma(n[t],e)}function Hr(e,t){if(ya(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Na(e))||Ae.test(e)||!qe.test(e)||null!=t&&e in tt(t)}function Vr(e){var t=Fr(e),n=mi[t];if("function"!=typeof n||!(t in yi.prototype))return!1;if(e===n)return!0;var i=Rr(n);return!!i&&e===i[0]}(Xn&&Ur(new Xn(new ArrayBuffer(1)))!=ce||ei&&Ur(new ei)!=Y||ti&&"[object Promise]"!=Ur(ti.resolve())||ni&&Ur(new ni)!=te||ii&&Ur(new ii)!=re)&&(Ur=function(e){var t=eo(e),i=t==Z?e.constructor:n,o=i?ps(i):"";if(o)switch(o){case ai:return ce;case ci:return Y;case li:return"[object Promise]";case _i:return te;case ui:return re}return t});var Zr=ct?Ia:Wc;function Xr(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||at)}function es(e){return e==e&&!Aa(e)}function ts(e,t){return function(i){return null!=i&&i[e]===t&&(t!==n||e in tt(i))}}function ns(e,t,i){return t=Jn(t===n?e.length-1:t,0),function(){for(var n=arguments,o=-1,r=Jn(n.length-t,0),s=De(r);++o<r;)s[o]=n[t+o];o=-1;for(var a=De(t+1);++o<t;)a[o]=n[o];return a[t]=i(s),Ut(e,this,a)}}function is(e,t){return t.length<2?e:Zi(e,Eo(t,0,-1))}function os(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var rs=ls(So),ss=Ln||function(e,t){return Tt.setTimeout(e,t)},as=ls(Po);function cs(e,t,n){var i=t+"";return as(e,function(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(Re,"{\n/* [wrapped with "+t+"] */\n")}(i,function(e,t){return Qt(L,function(n){var i="_."+n[0];t&n[1]&&!Ht(e,i)&&e.push(i)}),e.sort()}(function(e){var t=e.match(Fe);return t?t[1].split(Ne):[]}(i),n)))}function ls(e){var t=0,i=0;return function(){var o=Yn(),r=A-(o-i);if(i=o,r>0){if(++t>=q)return arguments[0]}else t=0;return e.apply(n,arguments)}}function _s(e,t){var i=-1,o=e.length,r=o-1;for(t=t===n?o:t;++i<t;){var s=Co(i,r),a=e[s];e[s]=e[i],e[i]=a}return e.length=t,e}var us=function(e){var t=la(e,function(e){return n.size===l&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Se,function(e,n,i,o){t.push(i?o.replace(Be,"$1"):n||e)}),t});function fs(e){if("string"==typeof e||Na(e))return e;var t=e+"";return"0"==t&&1/e==-T?"-0":t}function ps(e){if(null!=e){try{return lt.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ds(e){if(e instanceof yi)return e.clone();var t=new gi(e.__wrapped__,e.__chain__);return t.__actions__=rr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var ms=Io(function(e,t){return xa(e)?Bi(e,Qi(t,1,xa,!0)):[]}),vs=Io(function(e,t){var i=Os(t);return xa(i)&&(i=n),xa(e)?Bi(e,Qi(t,1,xa,!0),jr(i,2)):[]}),hs=Io(function(e,t){var i=Os(t);return xa(i)&&(i=n),xa(e)?Bi(e,Qi(t,1,xa,!0),n,i):[]});function gs(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var o=null==n?0:Ga(n);return o<0&&(o=Jn(i+o,0)),sn(e,jr(t,3),o)}function ys(e,t,i){var o=null==e?0:e.length;if(!o)return-1;var r=o-1;return i!==n&&(r=Ga(i),r=i<0?Jn(o+r,0):Kn(r,o-1)),sn(e,jr(t,3),r,!0)}function bs(e){return null!=e&&e.length?Qi(e,1):[]}function ws(e){return e&&e.length?e[0]:n}var xs=Io(function(e){var t=Zt(e,Jo);return t.length&&t[0]===e[0]?oo(t):[]}),ks=Io(function(e){var t=Os(e),i=Zt(e,Jo);return t===Os(i)?t=n:i.pop(),i.length&&i[0]===e[0]?oo(i,jr(t,2)):[]}),Cs=Io(function(e){var t=Os(e),i=Zt(e,Jo);return(t="function"==typeof t?t:n)&&i.pop(),i.length&&i[0]===e[0]?oo(i,n,t):[]});function Os(e){var t=null==e?0:e.length;return t?e[t-1]:n}var Is=Io($s);function $s(e,t){return e&&e.length&&t&&t.length?xo(e,t):e}var qs=Tr(function(e,t){var n=null==e?0:e.length,i=Ri(e,t);return ko(e,Zt(t,function(e){return Kr(e,n)?+e:e}).sort(nr)),i});function As(e){return null==e?e:Zn.call(e)}var Ss=Io(function(e){return Bo(Qi(e,1,xa,!0))}),Ps=Io(function(e){var t=Os(e);return xa(t)&&(t=n),Bo(Qi(e,1,xa,!0),jr(t,2))}),Ts=Io(function(e){var t=Os(e);return t="function"==typeof t?t:n,Bo(Qi(e,1,xa,!0),n,t)});function Es(e){if(!e||!e.length)return[];var t=0;return e=Yt(e,function(e){if(xa(e))return t=Jn(e.length,t),!0}),mn(t,function(t){return Zt(e,un(t))})}function Ds(e,t){if(!e||!e.length)return[];var i=Es(e);return null==t?i:Zt(i,function(e){return Ut(t,n,e)})}var Rs=Io(function(e,t){return xa(e)?Bi(e,t):[]}),Fs=Io(function(e){return Wo(Yt(e,xa))}),Ns=Io(function(e){var t=Os(e);return xa(t)&&(t=n),Wo(Yt(e,xa),jr(t,2))}),js=Io(function(e){var t=Os(e);return t="function"==typeof t?t:n,Wo(Yt(e,xa),n,t)}),Ls=Io(Es);var Bs=Io(function(e){var t=e.length,i=t>1?e[t-1]:n;return i="function"==typeof i?(e.pop(),i):n,Ds(e,i)});function zs(e){var t=mi(e);return t.__chain__=!0,t}function Ms(e,t){return t(e)}var Gs=Tr(function(e){var t=e.length,i=t?e[0]:0,o=this.__wrapped__,r=function(t){return Ri(t,e)};return!(t>1||this.__actions__.length)&&o instanceof yi&&Kr(i)?((o=o.slice(i,+i+(t?1:0))).__actions__.push({func:Ms,args:[r],thisArg:n}),new gi(o,this.__chain__).thru(function(e){return t&&!e.length&&e.push(n),e})):this.thru(r)});var Us=ar(function(e,t,n){_t.call(e,n)?++e[n]:Di(e,n,1)});var Ws=dr(gs),Qs=dr(ys);function Js(e,t){return(ya(e)?Qt:zi)(e,jr(t,3))}function Ks(e,t){return(ya(e)?Jt:Mi)(e,jr(t,3))}var Ys=ar(function(e,t,n){_t.call(e,n)?e[n].push(t):Di(e,n,[t])});var Hs=Io(function(e,t,n){var i=-1,o="function"==typeof t,r=wa(e)?De(e.length):[];return zi(e,function(e){r[++i]=o?Ut(t,e,n):ro(e,t,n)}),r}),Vs=ar(function(e,t,n){Di(e,n,t)});function Zs(e,t){return(ya(e)?Zt:mo)(e,jr(t,3))}var Xs=ar(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]});var ea=Io(function(e,t){if(null==e)return[];var n=t.length;return n>1&&Yr(e,t[0],t[1])?t=[]:n>2&&Yr(t[0],t[1],t[2])&&(t=[t[0]]),bo(e,Qi(t,1),[])}),ta=jn||function(){return Tt.Date.now()};function na(e,t,i){return t=i?n:t,t=e&&null==t?e.length:t,$r(e,k,n,n,n,n,t)}function ia(e,t){var i;if("function"!=typeof t)throw new ot(s);return e=Ga(e),function(){return--e>0&&(i=t.apply(this,arguments)),e<=1&&(t=n),i}}var oa=Io(function(e,t,n){var i=v;if(n.length){var o=qn(n,Nr(oa));i|=w}return $r(e,i,t,n,o)}),ra=Io(function(e,t,n){var i=v|h;if(n.length){var o=qn(n,Nr(ra));i|=w}return $r(t,i,e,n,o)});function sa(e,t,i){var o,r,a,c,l,_,u=0,f=!1,p=!1,d=!0;if("function"!=typeof e)throw new ot(s);function m(t){var i=o,s=r;return o=r=n,u=t,c=e.apply(s,i)}function v(e){var i=e-_;return _===n||i>=t||i<0||p&&e-u>=a}function h(){var e=ta();if(v(e))return g(e);l=ss(h,function(e){var n=t-(e-_);return p?Kn(n,a-(e-u)):n}(e))}function g(e){return l=n,d&&o?m(e):(o=r=n,c)}function y(){var e=ta(),i=v(e);if(o=arguments,r=this,_=e,i){if(l===n)return function(e){return u=e,l=ss(h,t),f?m(e):c}(_);if(p)return Zo(l),l=ss(h,t),m(_)}return l===n&&(l=ss(h,t)),c}return t=Wa(t)||0,Aa(i)&&(f=!!i.leading,a=(p="maxWait"in i)?Jn(Wa(i.maxWait)||0,t):a,d="trailing"in i?!!i.trailing:d),y.cancel=function(){l!==n&&Zo(l),u=0,o=_=r=l=n},y.flush=function(){return l===n?c:g(ta())},y}var aa=Io(function(e,t){return Li(e,1,t)}),ca=Io(function(e,t,n){return Li(e,Wa(t)||0,n)});function la(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new ot(s);var n=function(){var i=arguments,o=t?t.apply(this,i):i[0],r=n.cache;if(r.has(o))return r.get(o);var s=e.apply(this,i);return n.cache=r.set(o,s)||r,s};return n.cache=new(la.Cache||xi),n}function _a(e){if("function"!=typeof e)throw new ot(s);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}la.Cache=xi;var ua=Ho(function(e,t){var n=(t=1==t.length&&ya(t[0])?Zt(t[0],hn(jr())):Zt(Qi(t,1),hn(jr()))).length;return Io(function(i){for(var o=-1,r=Kn(i.length,n);++o<r;)i[o]=t[o].call(this,i[o]);return Ut(e,this,i)})}),fa=Io(function(e,t){var i=qn(t,Nr(fa));return $r(e,w,n,t,i)}),pa=Io(function(e,t){var i=qn(t,Nr(pa));return $r(e,x,n,t,i)}),da=Tr(function(e,t){return $r(e,C,n,n,n,t)});function ma(e,t){return e===t||e!=e&&t!=t}var va=xr(to),ha=xr(function(e,t){return e>=t}),ga=so(function(){return arguments}())?so:function(e){return Sa(e)&&_t.call(e,"callee")&&!Dt.call(e,"callee")},ya=De.isArray,ba=jt?hn(jt):function(e){return Sa(e)&&eo(e)==ae};function wa(e){return null!=e&&qa(e.length)&&!Ia(e)}function xa(e){return Sa(e)&&wa(e)}var ka=Gn||Wc,Ca=Lt?hn(Lt):function(e){return Sa(e)&&eo(e)==U};function Oa(e){if(!Sa(e))return!1;var t=eo(e);return t==Q||t==W||"string"==typeof e.message&&"string"==typeof e.name&&!Ea(e)}function Ia(e){if(!Aa(e))return!1;var t=eo(e);return t==J||t==K||t==M||t==X}function $a(e){return"number"==typeof e&&e==Ga(e)}function qa(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=E}function Aa(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Sa(e){return null!=e&&"object"==typeof e}var Pa=Bt?hn(Bt):function(e){return Sa(e)&&Ur(e)==Y};function Ta(e){return"number"==typeof e||Sa(e)&&eo(e)==H}function Ea(e){if(!Sa(e)||eo(e)!=Z)return!1;var t=Pt(e);if(null===t)return!0;var n=_t.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&lt.call(n)==dt}var Da=zt?hn(zt):function(e){return Sa(e)&&eo(e)==ee};var Ra=Mt?hn(Mt):function(e){return Sa(e)&&Ur(e)==te};function Fa(e){return"string"==typeof e||!ya(e)&&Sa(e)&&eo(e)==ne}function Na(e){return"symbol"==typeof e||Sa(e)&&eo(e)==ie}var ja=Gt?hn(Gt):function(e){return Sa(e)&&qa(e.length)&&!!Ot[eo(e)]};var La=xr(po),Ba=xr(function(e,t){return e<=t});function za(e){if(!e)return[];if(wa(e))return Fa(e)?Tn(e):rr(e);if(on&&e[on])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[on]());var t=Ur(e);return(t==Y?In:t==te?An:mc)(e)}function Ma(e){return e?(e=Wa(e))===T||e===-T?(e<0?-1:1)*D:e==e?e:0:0===e?e:0}function Ga(e){var t=Ma(e),n=t%1;return t==t?n?t-n:t:0}function Ua(e){return e?Fi(Ga(e),0,F):0}function Wa(e){if("number"==typeof e)return e;if(Na(e))return R;if(Aa(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Aa(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=vn(e);var n=Ue.test(e);return n||Qe.test(e)?At(e.slice(2),n?2:8):Ge.test(e)?R:+e}function Qa(e){return sr(e,ac(e))}function Ja(e){return null==e?"":Lo(e)}var Ka=cr(function(e,t){if(Xr(t)||wa(t))sr(t,sc(t),e);else for(var n in t)_t.call(t,n)&&Si(e,n,t[n])}),Ya=cr(function(e,t){sr(t,ac(t),e)}),Ha=cr(function(e,t,n,i){sr(t,ac(t),e,i)}),Va=cr(function(e,t,n,i){sr(t,sc(t),e,i)}),Za=Tr(Ri);var Xa=Io(function(e,t){e=tt(e);var i=-1,o=t.length,r=o>2?t[2]:n;for(r&&Yr(t[0],t[1],r)&&(o=1);++i<o;)for(var s=t[i],a=ac(s),c=-1,l=a.length;++c<l;){var _=a[c],u=e[_];(u===n||ma(u,at[_])&&!_t.call(e,_))&&(e[_]=s[_])}return e}),ec=Io(function(e){return e.push(n,Ar),Ut(lc,n,e)});function tc(e,t,i){var o=null==e?n:Zi(e,t);return o===n?i:o}function nc(e,t){return null!=e&&Wr(e,t,io)}var ic=hr(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=pt.call(t)),e[t]=n},Ac(Tc)),oc=hr(function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=pt.call(t)),_t.call(e,t)?e[t].push(n):e[t]=[n]},jr),rc=Io(ro);function sc(e){return wa(e)?Oi(e):uo(e)}function ac(e){return wa(e)?Oi(e,!0):fo(e)}var cc=cr(function(e,t,n){go(e,t,n)}),lc=cr(function(e,t,n,i){go(e,t,n,i)}),_c=Tr(function(e,t){var n={};if(null==e)return n;var i=!1;t=Zt(t,function(t){return t=Yo(t,e),i||(i=t.length>1),t}),sr(e,Dr(e),n),i&&(n=Ni(n,u|f|p,Sr));for(var o=t.length;o--;)zo(n,t[o]);return n});var uc=Tr(function(e,t){return null==e?{}:function(e,t){return wo(e,t,function(t,n){return nc(e,n)})}(e,t)});function fc(e,t){if(null==e)return{};var n=Zt(Dr(e),function(e){return[e]});return t=jr(t),wo(e,n,function(e,n){return t(e,n[0])})}var pc=Ir(sc),dc=Ir(ac);function mc(e){return null==e?[]:gn(e,sc(e))}var vc=fr(function(e,t,n){return t=t.toLowerCase(),e+(n?hc(t):t)});function hc(e){return Oc(Ja(e).toLowerCase())}function gc(e){return(e=Ja(e))&&e.replace(Ke,xn).replace(gt,"")}var yc=fr(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),bc=fr(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),wc=ur("toLowerCase");var xc=fr(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()});var kc=fr(function(e,t,n){return e+(n?" ":"")+Oc(t)});var Cc=fr(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Oc=ur("toUpperCase");function Ic(e,t,i){return e=Ja(e),(t=i?n:t)===n?function(e){return xt.test(e)}(e)?function(e){return e.match(bt)||[]}(e):function(e){return e.match(je)||[]}(e):e.match(t)||[]}var $c=Io(function(e,t){try{return Ut(e,n,t)}catch(e){return Oa(e)?e:new Ze(e)}}),qc=Tr(function(e,t){return Qt(t,function(t){t=fs(t),Di(e,t,oa(e[t],e))}),e});function Ac(e){return function(){return e}}var Sc=mr(),Pc=mr(!0);function Tc(e){return e}function Ec(e){return _o("function"==typeof e?e:Ni(e,u))}var Dc=Io(function(e,t){return function(n){return ro(n,e,t)}}),Rc=Io(function(e,t){return function(n){return ro(e,n,t)}});function Fc(e,t,n){var i=sc(t),o=Vi(t,i);null!=n||Aa(t)&&(o.length||!i.length)||(n=t,t=e,e=this,o=Vi(t,sc(t)));var r=!(Aa(n)&&"chain"in n&&!n.chain),s=Ia(e);return Qt(o,function(n){var i=t[n];e[n]=i,s&&(e.prototype[n]=function(){var t=this.__chain__;if(r||t){var n=e(this.__wrapped__);return(n.__actions__=rr(this.__actions__)).push({func:i,args:arguments,thisArg:e}),n.__chain__=t,n}return i.apply(e,Xt([this.value()],arguments))})}),e}function Nc(){}var jc=yr(Zt),Lc=yr(Kt),Bc=yr(nn);function zc(e){return Hr(e)?un(fs(e)):function(e){return function(t){return Zi(t,e)}}(e)}var Mc=wr(),Gc=wr(!0);function Uc(){return[]}function Wc(){return!1}var Qc=gr(function(e,t){return e+t},0),Jc=Cr("ceil"),Kc=gr(function(e,t){return e/t},1),Yc=Cr("floor");var Hc,Vc=gr(function(e,t){return e*t},1),Zc=Cr("round"),Xc=gr(function(e,t){return e-t},0);return mi.after=function(e,t){if("function"!=typeof t)throw new ot(s);return e=Ga(e),function(){if(--e<1)return t.apply(this,arguments)}},mi.ary=na,mi.assign=Ka,mi.assignIn=Ya,mi.assignInWith=Ha,mi.assignWith=Va,mi.at=Za,mi.before=ia,mi.bind=oa,mi.bindAll=qc,mi.bindKey=ra,mi.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return ya(e)?e:[e]},mi.chain=zs,mi.chunk=function(e,t,i){t=(i?Yr(e,t,i):t===n)?1:Jn(Ga(t),0);var o=null==e?0:e.length;if(!o||t<1)return[];for(var r=0,s=0,a=De(Bn(o/t));r<o;)a[s++]=Eo(e,r,r+=t);return a},mi.compact=function(e){for(var t=-1,n=null==e?0:e.length,i=0,o=[];++t<n;){var r=e[t];r&&(o[i++]=r)}return o},mi.concat=function(){var e=arguments,t=arguments.length;if(!t)return[];for(var n=De(t-1),i=arguments[0],o=t;o--;)n[o-1]=e[o];return Xt(ya(i)?rr(i):[i],Qi(n,1))},mi.cond=function(e){var t=null==e?0:e.length,n=jr();return e=t?Zt(e,function(e){if("function"!=typeof e[1])throw new ot(s);return[n(e[0]),e[1]]}):[],Io(function(n){for(var i=-1;++i<t;){var o=e[i];if(Ut(o[0],this,n))return Ut(o[1],this,n)}})},mi.conforms=function(e){return function(e){var t=sc(e);return function(n){return ji(n,e,t)}}(Ni(e,u))},mi.constant=Ac,mi.countBy=Us,mi.create=function(e,t){var n=vi(e);return null==t?n:Ei(n,t)},mi.curry=function e(t,i,o){var r=$r(t,y,n,n,n,n,n,i=o?n:i);return r.placeholder=e.placeholder,r},mi.curryRight=function e(t,i,o){var r=$r(t,b,n,n,n,n,n,i=o?n:i);return r.placeholder=e.placeholder,r},mi.debounce=sa,mi.defaults=Xa,mi.defaultsDeep=ec,mi.defer=aa,mi.delay=ca,mi.difference=ms,mi.differenceBy=vs,mi.differenceWith=hs,mi.drop=function(e,t,i){var o=null==e?0:e.length;return o?Eo(e,(t=i||t===n?1:Ga(t))<0?0:t,o):[]},mi.dropRight=function(e,t,i){var o=null==e?0:e.length;return o?Eo(e,0,(t=o-(t=i||t===n?1:Ga(t)))<0?0:t):[]},mi.dropRightWhile=function(e,t){return e&&e.length?Go(e,jr(t,3),!0,!0):[]},mi.dropWhile=function(e,t){return e&&e.length?Go(e,jr(t,3),!0):[]},mi.fill=function(e,t,i,o){var r=null==e?0:e.length;return r?(i&&"number"!=typeof i&&Yr(e,t,i)&&(i=0,o=r),function(e,t,i,o){var r=e.length;for((i=Ga(i))<0&&(i=-i>r?0:r+i),(o=o===n||o>r?r:Ga(o))<0&&(o+=r),o=i>o?0:Ua(o);i<o;)e[i++]=t;return e}(e,t,i,o)):[]},mi.filter=function(e,t){return(ya(e)?Yt:Wi)(e,jr(t,3))},mi.flatMap=function(e,t){return Qi(Zs(e,t),1)},mi.flatMapDeep=function(e,t){return Qi(Zs(e,t),T)},mi.flatMapDepth=function(e,t,i){return i=i===n?1:Ga(i),Qi(Zs(e,t),i)},mi.flatten=bs,mi.flattenDeep=function(e){return null!=e&&e.length?Qi(e,T):[]},mi.flattenDepth=function(e,t){return null!=e&&e.length?Qi(e,t=t===n?1:Ga(t)):[]},mi.flip=function(e){return $r(e,O)},mi.flow=Sc,mi.flowRight=Pc,mi.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,i={};++t<n;){var o=e[t];i[o[0]]=o[1]}return i},mi.functions=function(e){return null==e?[]:Vi(e,sc(e))},mi.functionsIn=function(e){return null==e?[]:Vi(e,ac(e))},mi.groupBy=Ys,mi.initial=function(e){return null!=e&&e.length?Eo(e,0,-1):[]},mi.intersection=xs,mi.intersectionBy=ks,mi.intersectionWith=Cs,mi.invert=ic,mi.invertBy=oc,mi.invokeMap=Hs,mi.iteratee=Ec,mi.keyBy=Vs,mi.keys=sc,mi.keysIn=ac,mi.map=Zs,mi.mapKeys=function(e,t){var n={};return t=jr(t,3),Yi(e,function(e,i,o){Di(n,t(e,i,o),e)}),n},mi.mapValues=function(e,t){var n={};return t=jr(t,3),Yi(e,function(e,i,o){Di(n,i,t(e,i,o))}),n},mi.matches=function(e){return vo(Ni(e,u))},mi.matchesProperty=function(e,t){return ho(e,Ni(t,u))},mi.memoize=la,mi.merge=cc,mi.mergeWith=lc,mi.method=Dc,mi.methodOf=Rc,mi.mixin=Fc,mi.negate=_a,mi.nthArg=function(e){return e=Ga(e),Io(function(t){return yo(t,e)})},mi.omit=_c,mi.omitBy=function(e,t){return fc(e,_a(jr(t)))},mi.once=function(e){return ia(2,e)},mi.orderBy=function(e,t,i,o){return null==e?[]:(ya(t)||(t=null==t?[]:[t]),ya(i=o?n:i)||(i=null==i?[]:[i]),bo(e,t,i))},mi.over=jc,mi.overArgs=ua,mi.overEvery=Lc,mi.overSome=Bc,mi.partial=fa,mi.partialRight=pa,mi.partition=Xs,mi.pick=uc,mi.pickBy=fc,mi.property=zc,mi.propertyOf=function(e){return function(t){return null==e?n:Zi(e,t)}},mi.pull=Is,mi.pullAll=$s,mi.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?xo(e,t,jr(n,2)):e},mi.pullAllWith=function(e,t,i){return e&&e.length&&t&&t.length?xo(e,t,n,i):e},mi.pullAt=qs,mi.range=Mc,mi.rangeRight=Gc,mi.rearg=da,mi.reject=function(e,t){return(ya(e)?Yt:Wi)(e,_a(jr(t,3)))},mi.remove=function(e,t){var n=[];if(!e||!e.length)return n;var i=-1,o=[],r=e.length;for(t=jr(t,3);++i<r;){var s=e[i];t(s,i,e)&&(n.push(s),o.push(i))}return ko(e,o),n},mi.rest=function(e,t){if("function"!=typeof e)throw new ot(s);return Io(e,t=t===n?t:Ga(t))},mi.reverse=As,mi.sampleSize=function(e,t,i){return t=(i?Yr(e,t,i):t===n)?1:Ga(t),(ya(e)?$i:qo)(e,t)},mi.set=function(e,t,n){return null==e?e:Ao(e,t,n)},mi.setWith=function(e,t,i,o){return o="function"==typeof o?o:n,null==e?e:Ao(e,t,i,o)},mi.shuffle=function(e){return(ya(e)?qi:To)(e)},mi.slice=function(e,t,i){var o=null==e?0:e.length;return o?(i&&"number"!=typeof i&&Yr(e,t,i)?(t=0,i=o):(t=null==t?0:Ga(t),i=i===n?o:Ga(i)),Eo(e,t,i)):[]},mi.sortBy=ea,mi.sortedUniq=function(e){return e&&e.length?No(e):[]},mi.sortedUniqBy=function(e,t){return e&&e.length?No(e,jr(t,2)):[]},mi.split=function(e,t,i){return i&&"number"!=typeof i&&Yr(e,t,i)&&(t=i=n),(i=i===n?F:i>>>0)?(e=Ja(e))&&("string"==typeof t||null!=t&&!Da(t))&&!(t=Lo(t))&&On(e)?Vo(Tn(e),0,i):e.split(t,i):[]},mi.spread=function(e,t){if("function"!=typeof e)throw new ot(s);return t=null==t?0:Jn(Ga(t),0),Io(function(n){var i=n[t],o=Vo(n,0,t);return i&&Xt(o,i),Ut(e,this,o)})},mi.tail=function(e){var t=null==e?0:e.length;return t?Eo(e,1,t):[]},mi.take=function(e,t,i){return e&&e.length?Eo(e,0,(t=i||t===n?1:Ga(t))<0?0:t):[]},mi.takeRight=function(e,t,i){var o=null==e?0:e.length;return o?Eo(e,(t=o-(t=i||t===n?1:Ga(t)))<0?0:t,o):[]},mi.takeRightWhile=function(e,t){return e&&e.length?Go(e,jr(t,3),!1,!0):[]},mi.takeWhile=function(e,t){return e&&e.length?Go(e,jr(t,3)):[]},mi.tap=function(e,t){return t(e),e},mi.throttle=function(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw new ot(s);return Aa(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),sa(e,t,{leading:i,maxWait:t,trailing:o})},mi.thru=Ms,mi.toArray=za,mi.toPairs=pc,mi.toPairsIn=dc,mi.toPath=function(e){return ya(e)?Zt(e,fs):Na(e)?[e]:rr(us(Ja(e)))},mi.toPlainObject=Qa,mi.transform=function(e,t,n){var i=ya(e),o=i||ka(e)||ja(e);if(t=jr(t,4),null==n){var r=e&&e.constructor;n=o?i?new r:[]:Aa(e)&&Ia(r)?vi(Pt(e)):{}}return(o?Qt:Yi)(e,function(e,i,o){return t(n,e,i,o)}),n},mi.unary=function(e){return na(e,1)},mi.union=Ss,mi.unionBy=Ps,mi.unionWith=Ts,mi.uniq=function(e){return e&&e.length?Bo(e):[]},mi.uniqBy=function(e,t){return e&&e.length?Bo(e,jr(t,2)):[]},mi.uniqWith=function(e,t){return t="function"==typeof t?t:n,e&&e.length?Bo(e,n,t):[]},mi.unset=function(e,t){return null==e||zo(e,t)},mi.unzip=Es,mi.unzipWith=Ds,mi.update=function(e,t,n){return null==e?e:Mo(e,t,Ko(n))},mi.updateWith=function(e,t,i,o){return o="function"==typeof o?o:n,null==e?e:Mo(e,t,Ko(i),o)},mi.values=mc,mi.valuesIn=function(e){return null==e?[]:gn(e,ac(e))},mi.without=Rs,mi.words=Ic,mi.wrap=function(e,t){return fa(Ko(t),e)},mi.xor=Fs,mi.xorBy=Ns,mi.xorWith=js,mi.zip=Ls,mi.zipObject=function(e,t){return Qo(e||[],t||[],Si)},mi.zipObjectDeep=function(e,t){return Qo(e||[],t||[],Ao)},mi.zipWith=Bs,mi.entries=pc,mi.entriesIn=dc,mi.extend=Ya,mi.extendWith=Ha,Fc(mi,mi),mi.add=Qc,mi.attempt=$c,mi.camelCase=vc,mi.capitalize=hc,mi.ceil=Jc,mi.clamp=function(e,t,i){return i===n&&(i=t,t=n),i!==n&&(i=(i=Wa(i))==i?i:0),t!==n&&(t=(t=Wa(t))==t?t:0),Fi(Wa(e),t,i)},mi.clone=function(e){return Ni(e,p)},mi.cloneDeep=function(e){return Ni(e,u|p)},mi.cloneDeepWith=function(e,t){return Ni(e,u|p,t="function"==typeof t?t:n)},mi.cloneWith=function(e,t){return Ni(e,p,t="function"==typeof t?t:n)},mi.conformsTo=function(e,t){return null==t||ji(e,t,sc(t))},mi.deburr=gc,mi.defaultTo=function(e,t){return null==e||e!=e?t:e},mi.divide=Kc,mi.endsWith=function(e,t,i){e=Ja(e),t=Lo(t);var o=e.length,r=i=i===n?o:Fi(Ga(i),0,o);return(i-=t.length)>=0&&e.slice(i,r)==t},mi.eq=ma,mi.escape=function(e){return(e=Ja(e))&&Ce.test(e)?e.replace(xe,kn):e},mi.escapeRegExp=function(e){return(e=Ja(e))&&Te.test(e)?e.replace(Pe,"\\$&"):e},mi.every=function(e,t,i){var o=ya(e)?Kt:Gi;return i&&Yr(e,t,i)&&(t=n),o(e,jr(t,3))},mi.find=Ws,mi.findIndex=gs,mi.findKey=function(e,t){return rn(e,jr(t,3),Yi)},mi.findLast=Qs,mi.findLastIndex=ys,mi.findLastKey=function(e,t){return rn(e,jr(t,3),Hi)},mi.floor=Yc,mi.forEach=Js,mi.forEachRight=Ks,mi.forIn=function(e,t){return null==e?e:Ji(e,jr(t,3),ac)},mi.forInRight=function(e,t){return null==e?e:Ki(e,jr(t,3),ac)},mi.forOwn=function(e,t){return e&&Yi(e,jr(t,3))},mi.forOwnRight=function(e,t){return e&&Hi(e,jr(t,3))},mi.get=tc,mi.gt=va,mi.gte=ha,mi.has=function(e,t){return null!=e&&Wr(e,t,no)},mi.hasIn=nc,mi.head=ws,mi.identity=Tc,mi.includes=function(e,t,n,i){e=wa(e)?e:mc(e),n=n&&!i?Ga(n):0;var o=e.length;return n<0&&(n=Jn(o+n,0)),Fa(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&an(e,t,n)>-1},mi.indexOf=function(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var o=null==n?0:Ga(n);return o<0&&(o=Jn(i+o,0)),an(e,t,o)},mi.inRange=function(e,t,i){return t=Ma(t),i===n?(i=t,t=0):i=Ma(i),function(e,t,n){return e>=Kn(t,n)&&e<Jn(t,n)}(e=Wa(e),t,i)},mi.invoke=rc,mi.isArguments=ga,mi.isArray=ya,mi.isArrayBuffer=ba,mi.isArrayLike=wa,mi.isArrayLikeObject=xa,mi.isBoolean=function(e){return!0===e||!1===e||Sa(e)&&eo(e)==G},mi.isBuffer=ka,mi.isDate=Ca,mi.isElement=function(e){return Sa(e)&&1===e.nodeType&&!Ea(e)},mi.isEmpty=function(e){if(null==e)return!0;if(wa(e)&&(ya(e)||"string"==typeof e||"function"==typeof e.splice||ka(e)||ja(e)||ga(e)))return!e.length;var t=Ur(e);if(t==Y||t==te)return!e.size;if(Xr(e))return!uo(e).length;for(var n in e)if(_t.call(e,n))return!1;return!0},mi.isEqual=function(e,t){return ao(e,t)},mi.isEqualWith=function(e,t,i){var o=(i="function"==typeof i?i:n)?i(e,t):n;return o===n?ao(e,t,n,i):!!o},mi.isError=Oa,mi.isFinite=function(e){return"number"==typeof e&&Un(e)},mi.isFunction=Ia,mi.isInteger=$a,mi.isLength=qa,mi.isMap=Pa,mi.isMatch=function(e,t){return e===t||co(e,t,Br(t))},mi.isMatchWith=function(e,t,i){return i="function"==typeof i?i:n,co(e,t,Br(t),i)},mi.isNaN=function(e){return Ta(e)&&e!=+e},mi.isNative=function(e){if(Zr(e))throw new Ze(r);return lo(e)},mi.isNil=function(e){return null==e},mi.isNull=function(e){return null===e},mi.isNumber=Ta,mi.isObject=Aa,mi.isObjectLike=Sa,mi.isPlainObject=Ea,mi.isRegExp=Da,mi.isSafeInteger=function(e){return $a(e)&&e>=-E&&e<=E},mi.isSet=Ra,mi.isString=Fa,mi.isSymbol=Na,mi.isTypedArray=ja,mi.isUndefined=function(e){return e===n},mi.isWeakMap=function(e){return Sa(e)&&Ur(e)==re},mi.isWeakSet=function(e){return Sa(e)&&eo(e)==se},mi.join=function(e,t){return null==e?"":Wn.call(e,t)},mi.kebabCase=yc,mi.last=Os,mi.lastIndexOf=function(e,t,i){var o=null==e?0:e.length;if(!o)return-1;var r=o;return i!==n&&(r=(r=Ga(i))<0?Jn(o+r,0):Kn(r,o-1)),t==t?function(e,t,n){for(var i=n+1;i--;)if(e[i]===t)return i;return i}(e,t,r):sn(e,ln,r,!0)},mi.lowerCase=bc,mi.lowerFirst=wc,mi.lt=La,mi.lte=Ba,mi.max=function(e){return e&&e.length?Ui(e,Tc,to):n},mi.maxBy=function(e,t){return e&&e.length?Ui(e,jr(t,2),to):n},mi.mean=function(e){return _n(e,Tc)},mi.meanBy=function(e,t){return _n(e,jr(t,2))},mi.min=function(e){return e&&e.length?Ui(e,Tc,po):n},mi.minBy=function(e,t){return e&&e.length?Ui(e,jr(t,2),po):n},mi.stubArray=Uc,mi.stubFalse=Wc,mi.stubObject=function(){return{}},mi.stubString=function(){return""},mi.stubTrue=function(){return!0},mi.multiply=Vc,mi.nth=function(e,t){return e&&e.length?yo(e,Ga(t)):n},mi.noConflict=function(){return Tt._===this&&(Tt._=mt),this},mi.noop=Nc,mi.now=ta,mi.pad=function(e,t,n){e=Ja(e);var i=(t=Ga(t))?Pn(e):0;if(!t||i>=t)return e;var o=(t-i)/2;return br(zn(o),n)+e+br(Bn(o),n)},mi.padEnd=function(e,t,n){e=Ja(e);var i=(t=Ga(t))?Pn(e):0;return t&&i<t?e+br(t-i,n):e},mi.padStart=function(e,t,n){e=Ja(e);var i=(t=Ga(t))?Pn(e):0;return t&&i<t?br(t-i,n)+e:e},mi.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),Hn(Ja(e).replace(Ee,""),t||0)},mi.random=function(e,t,i){if(i&&"boolean"!=typeof i&&Yr(e,t,i)&&(t=i=n),i===n&&("boolean"==typeof t?(i=t,t=n):"boolean"==typeof e&&(i=e,e=n)),e===n&&t===n?(e=0,t=1):(e=Ma(e),t===n?(t=e,e=0):t=Ma(t)),e>t){var o=e;e=t,t=o}if(i||e%1||t%1){var r=Vn();return Kn(e+r*(t-e+qt("1e-"+((r+"").length-1))),t)}return Co(e,t)},mi.reduce=function(e,t,n){var i=ya(e)?en:pn,o=arguments.length<3;return i(e,jr(t,4),n,o,zi)},mi.reduceRight=function(e,t,n){var i=ya(e)?tn:pn,o=arguments.length<3;return i(e,jr(t,4),n,o,Mi)},mi.repeat=function(e,t,i){return t=(i?Yr(e,t,i):t===n)?1:Ga(t),Oo(Ja(e),t)},mi.replace=function(){var e=arguments,t=Ja(e[0]);return e.length<3?t:t.replace(e[1],e[2])},mi.result=function(e,t,i){var o=-1,r=(t=Yo(t,e)).length;for(r||(r=1,e=n);++o<r;){var s=null==e?n:e[fs(t[o])];s===n&&(o=r,s=i),e=Ia(s)?s.call(e):s}return e},mi.round=Zc,mi.runInContext=e,mi.sample=function(e){return(ya(e)?Ii:$o)(e)},mi.size=function(e){if(null==e)return 0;if(wa(e))return Fa(e)?Pn(e):e.length;var t=Ur(e);return t==Y||t==te?e.size:uo(e).length},mi.snakeCase=xc,mi.some=function(e,t,i){var o=ya(e)?nn:Do;return i&&Yr(e,t,i)&&(t=n),o(e,jr(t,3))},mi.sortedIndex=function(e,t){return Ro(e,t)},mi.sortedIndexBy=function(e,t,n){return Fo(e,t,jr(n,2))},mi.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var i=Ro(e,t);if(i<n&&ma(e[i],t))return i}return-1},mi.sortedLastIndex=function(e,t){return Ro(e,t,!0)},mi.sortedLastIndexBy=function(e,t,n){return Fo(e,t,jr(n,2),!0)},mi.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=Ro(e,t,!0)-1;if(ma(e[n],t))return n}return-1},mi.startCase=kc,mi.startsWith=function(e,t,n){return e=Ja(e),n=null==n?0:Fi(Ga(n),0,e.length),t=Lo(t),e.slice(n,n+t.length)==t},mi.subtract=Xc,mi.sum=function(e){return e&&e.length?dn(e,Tc):0},mi.sumBy=function(e,t){return e&&e.length?dn(e,jr(t,2)):0},mi.template=function(e,t,i){var o=mi.templateSettings;i&&Yr(e,t,i)&&(t=n),e=Ja(e),t=Ha({},t,o,qr);var r,s,c=Ha({},t.imports,o.imports,qr),l=sc(c),_=gn(c,l),u=0,f=t.interpolate||Ye,p="__p += '",d=nt((t.escape||Ye).source+"|"+f.source+"|"+(f===$e?ze:Ye).source+"|"+(t.evaluate||Ye).source+"|$","g"),m="//# sourceURL="+(_t.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ct+"]")+"\n";e.replace(d,function(t,n,i,o,a,c){return i||(i=o),p+=e.slice(u,c).replace(He,Cn),n&&(r=!0,p+="' +\n__e("+n+") +\n'"),a&&(s=!0,p+="';\n"+a+";\n__p += '"),i&&(p+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),u=c+t.length,t}),p+="';\n";var v=_t.call(t,"variable")&&t.variable;if(v){if(Le.test(v))throw new Ze(a)}else p="with (obj) {\n"+p+"\n}\n";p=(s?p.replace(ge,""):p).replace(ye,"$1").replace(be,"$1;"),p="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(r?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var h=$c(function(){return Xe(l,m+"return "+p).apply(n,_)});if(h.source=p,Oa(h))throw h;return h},mi.times=function(e,t){if((e=Ga(e))<1||e>E)return[];var n=F,i=Kn(e,F);t=jr(t),e-=F;for(var o=mn(i,t);++n<e;)t(n);return o},mi.toFinite=Ma,mi.toInteger=Ga,mi.toLength=Ua,mi.toLower=function(e){return Ja(e).toLowerCase()},mi.toNumber=Wa,mi.toSafeInteger=function(e){return e?Fi(Ga(e),-E,E):0===e?e:0},mi.toString=Ja,mi.toUpper=function(e){return Ja(e).toUpperCase()},mi.trim=function(e,t,i){if((e=Ja(e))&&(i||t===n))return vn(e);if(!e||!(t=Lo(t)))return e;var o=Tn(e),r=Tn(t);return Vo(o,bn(o,r),wn(o,r)+1).join("")},mi.trimEnd=function(e,t,i){if((e=Ja(e))&&(i||t===n))return e.slice(0,En(e)+1);if(!e||!(t=Lo(t)))return e;var o=Tn(e);return Vo(o,0,wn(o,Tn(t))+1).join("")},mi.trimStart=function(e,t,i){if((e=Ja(e))&&(i||t===n))return e.replace(Ee,"");if(!e||!(t=Lo(t)))return e;var o=Tn(e);return Vo(o,bn(o,Tn(t))).join("")},mi.truncate=function(e,t){var i=I,o=$;if(Aa(t)){var r="separator"in t?t.separator:r;i="length"in t?Ga(t.length):i,o="omission"in t?Lo(t.omission):o}var s=(e=Ja(e)).length;if(On(e)){var a=Tn(e);s=a.length}if(i>=s)return e;var c=i-Pn(o);if(c<1)return o;var l=a?Vo(a,0,c).join(""):e.slice(0,c);if(r===n)return l+o;if(a&&(c+=l.length-c),Da(r)){if(e.slice(c).search(r)){var _,u=l;for(r.global||(r=nt(r.source,Ja(Me.exec(r))+"g")),r.lastIndex=0;_=r.exec(u);)var f=_.index;l=l.slice(0,f===n?c:f)}}else if(e.indexOf(Lo(r),c)!=c){var p=l.lastIndexOf(r);p>-1&&(l=l.slice(0,p))}return l+o},mi.unescape=function(e){return(e=Ja(e))&&ke.test(e)?e.replace(we,Dn):e},mi.uniqueId=function(e){var t=++ut;return Ja(e)+t},mi.upperCase=Cc,mi.upperFirst=Oc,mi.each=Js,mi.eachRight=Ks,mi.first=ws,Fc(mi,(Hc={},Yi(mi,function(e,t){_t.call(mi.prototype,t)||(Hc[t]=e)}),Hc),{chain:!1}),mi.VERSION="4.17.21",Qt(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){mi[e].placeholder=mi}),Qt(["drop","take"],function(e,t){yi.prototype[e]=function(i){i=i===n?1:Jn(Ga(i),0);var o=this.__filtered__&&!t?new yi(this):this.clone();return o.__filtered__?o.__takeCount__=Kn(i,o.__takeCount__):o.__views__.push({size:Kn(i,F),type:e+(o.__dir__<0?"Right":"")}),o},yi.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),Qt(["filter","map","takeWhile"],function(e,t){var n=t+1,i=n==S||3==n;yi.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:jr(e,3),type:n}),t.__filtered__=t.__filtered__||i,t}}),Qt(["head","last"],function(e,t){var n="take"+(t?"Right":"");yi.prototype[e]=function(){return this[n](1).value()[0]}}),Qt(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");yi.prototype[e]=function(){return this.__filtered__?new yi(this):this[n](1)}}),yi.prototype.compact=function(){return this.filter(Tc)},yi.prototype.find=function(e){return this.filter(e).head()},yi.prototype.findLast=function(e){return this.reverse().find(e)},yi.prototype.invokeMap=Io(function(e,t){return"function"==typeof e?new yi(this):this.map(function(n){return ro(n,e,t)})}),yi.prototype.reject=function(e){return this.filter(_a(jr(e)))},yi.prototype.slice=function(e,t){e=Ga(e);var i=this;return i.__filtered__&&(e>0||t<0)?new yi(i):(e<0?i=i.takeRight(-e):e&&(i=i.drop(e)),t!==n&&(i=(t=Ga(t))<0?i.dropRight(-t):i.take(t-e)),i)},yi.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},yi.prototype.toArray=function(){return this.take(F)},Yi(yi.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),o=/^(?:head|last)$/.test(t),r=mi[o?"take"+("last"==t?"Right":""):t],s=o||/^find/.test(t);r&&(mi.prototype[t]=function(){var t=this.__wrapped__,a=o?[1]:arguments,c=t instanceof yi,l=a[0],_=c||ya(t),u=function(e){var t=r.apply(mi,Xt([e],a));return o&&f?t[0]:t};_&&i&&"function"==typeof l&&1!=l.length&&(c=_=!1);var f=this.__chain__,p=!!this.__actions__.length,d=s&&!f,m=c&&!p;if(!s&&_){t=m?t:new yi(this);var v=e.apply(t,a);return v.__actions__.push({func:Ms,args:[u],thisArg:n}),new gi(v,f)}return d&&m?e.apply(this,a):(v=this.thru(u),d?o?v.value()[0]:v.value():v)})}),Qt(["pop","push","shift","sort","splice","unshift"],function(e){var t=rt[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",i=/^(?:pop|shift)$/.test(e);mi.prototype[e]=function(){var e=arguments;if(i&&!this.__chain__){var o=this.value();return t.apply(ya(o)?o:[],e)}return this[n](function(n){return t.apply(ya(n)?n:[],e)})}}),Yi(yi.prototype,function(e,t){var n=mi[t];if(n){var i=n.name+"";_t.call(si,i)||(si[i]=[]),si[i].push({name:t,func:n})}}),si[vr(n,h).name]=[{name:"wrapper",func:n}],yi.prototype.clone=function(){var e=new yi(this.__wrapped__);return e.__actions__=rr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=rr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=rr(this.__views__),e},yi.prototype.reverse=function(){if(this.__filtered__){var e=new yi(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},yi.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=ya(e),i=t<0,o=n?e.length:0,r=function(e,t,n){for(var i=-1,o=n.length;++i<o;){var r=n[i],s=r.size;switch(r.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=Kn(t,e+s);break;case"takeRight":e=Jn(e,t-s)}}return{start:e,end:t}}(0,o,this.__views__),s=r.start,a=r.end,c=a-s,l=i?a:s-1,_=this.__iteratees__,u=_.length,f=0,p=Kn(c,this.__takeCount__);if(!n||!i&&o==c&&p==c)return Uo(e,this.__actions__);var d=[];e:for(;c--&&f<p;){for(var m=-1,v=e[l+=t];++m<u;){var h=_[m],g=h.iteratee,y=h.type,b=g(v);if(y==P)v=b;else if(!b){if(y==S)continue e;break e}}d[f++]=v}return d},mi.prototype.at=Gs,mi.prototype.chain=function(){return zs(this)},mi.prototype.commit=function(){return new gi(this.value(),this.__chain__)},mi.prototype.next=function(){this.__values__===n&&(this.__values__=za(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?n:this.__values__[this.__index__++]}},mi.prototype.plant=function(e){for(var t,i=this;i instanceof hi;){var o=ds(i);o.__index__=0,o.__values__=n,t?r.__wrapped__=o:t=o;var r=o;i=i.__wrapped__}return r.__wrapped__=e,t},mi.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof yi){var t=e;return this.__actions__.length&&(t=new yi(this)),(t=t.reverse()).__actions__.push({func:Ms,args:[As],thisArg:n}),new gi(t,this.__chain__)}return this.thru(As)},mi.prototype.toJSON=mi.prototype.valueOf=mi.prototype.value=function(){return Uo(this.__wrapped__,this.__actions__)},mi.prototype.first=mi.prototype.head,on&&(mi.prototype[on]=function(){return this}),mi}();Dt?((Dt.exports=Rn)._=Rn,Et._=Rn):Tt._=Rn}).call(o)}(r={exports:{}},r.exports),r.exports).debounce(function(e){this.first_search=e},200)}},created:function(){var t=this;this.$nextTick(function(){}),e.$on("register_pos_profile",function(e){t.pos_profile=e.pos_profile,t.get_items(),t.get_items_groups()}),e.$on("update_cur_items_details",function(){t.update_cur_items_details()}),e.$on("update_offers_counters",function(e){t.offersCount=e.offersCount,t.appliedOffersCount=e.appliedOffersCount}),e.$on("update_coupons_counters",function(e){t.couponsCount=e.couponsCount,t.appliedCouponsCount=e.appliedCouponsCount}),e.$on("update_customer_price_list",function(e){t.customer_price_list=e})},mounted:function(){this.scan_barcoud()}},a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-card",{staticClass:"selection mx-auto grey lighten-5",staticStyle:{"max-height":"75vh",height:"75vh"}},[n("v-progress-linear",{attrs:{active:e.loading,indeterminate:e.loading,absolute:"",top:"",color:"deep-purple accent-4"}}),e._v(" "),n("v-row",{staticClass:"items px-2 py-1"},[n("v-col",{staticClass:"pb-0 mb-2",attrs:{cols:"12"}},[n("v-text-field",{attrs:{dense:"",clearable:"",autofocus:"",outlined:"",color:"indigo",label:e.frappe._("Search Items"),hint:"Search by item code, serial number, batch no or barcode","background-color":"white","hide-details":""},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"esc",27,t.key,["Esc","Escape"])?null:e.esc_event(t)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.enter_event(t)}]},model:{value:e.debounce_search,callback:function(t){e.debounce_search=t},expression:"debounce_search"}})],1),e._v(" "),n("v-col",{staticClass:"pt-0 mt-0",attrs:{cols:"12"}},["card"==e.items_view?n("div",{staticClass:"items",attrs:{fluid:""}},[n("v-row",{staticClass:"overflow-y-auto",staticStyle:{"max-height":"67vh"},attrs:{dense:""}},e._l(e.filtred_items,function(t,i){return n("v-col",{key:i,attrs:{xl:"2",lg:"3",md:"6",sm:"6",cols:"6","min-height":"50"}},[n("v-card",{attrs:{hover:"hover"},on:{click:function(n){return e.add_item(t)}}},[n("v-img",{staticClass:"white--text align-end",attrs:{src:t.image||"/assets/posawesome/js/posapp/components/pos/placeholder-image.png",gradient:"to bottom, rgba(0,0,0,.2), rgba(0,0,0,.7)",height:"100px"}},[n("v-card-text",{staticClass:"text-subtitle-2 px-1 pb-2",domProps:{textContent:e._s(t.item_name)}})],1),e._v(" "),n("v-card-text",{staticClass:"text--primary pa-1"},[n("div",{staticClass:"text-caption indigo--text accent-3"},[e._v("\n                    "+e._s(t.rate||0)+" "+e._s(t.currency||"")+"\n                  ")])])],1)],1)}),1)],1):e._e(),e._v(" "),"list"==e.items_view?n("div",{staticClass:"items",attrs:{fluid:""}},[n("div",{staticClass:"my-0 py-0 overflow-y-auto",staticStyle:{"max-height":"65vh"}},[[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.items_headers,items:e.filtred_items,"item-key":"item_code","items-per-page":e.itemsPerPage,"hide-default-footer":""},on:{"click:row":e.add_item},scopedSlots:e._u([{key:"item.rate",fn:function(t){var n=t.item;return[e._v("\n                  "+e._s(e.formtCurrency(n.rate))+"\n                ")]}},{key:"item.actual_qty",fn:function(t){var n=t.item;return[e._v("\n                  "+e._s(e.formtCurrency(n.actual_qty))+"\n                ")]}}],null,!1,1096687177)})]],2)]):e._e()])],1)],1),e._v(" "),n("v-card",{staticClass:"cards mb-0 mt-3 pa-2 grey lighten-5"},[n("v-row",{attrs:{"no-gutters":"",align:"center",justify:"center"}},[n("v-col",{attrs:{cols:"12"}},[n("v-select",{attrs:{items:e.items_group,label:e.frappe._("Items Group"),dense:"",outlined:"","hide-details":""},model:{value:e.item_group,callback:function(t){e.item_group=t},expression:"item_group"}})],1),e._v(" "),n("v-col",{staticClass:"mt-1",attrs:{cols:"3"}},[n("v-btn-toggle",{attrs:{color:"orange",group:"",dense:"",rounded:""},model:{value:e.items_view,callback:function(t){e.items_view=t},expression:"items_view"}},[n("v-btn",{attrs:{small:"",value:"list"}},[e._v(e._s(e.__("List")))]),e._v(" "),n("v-btn",{attrs:{small:"",value:"card"}},[e._v(e._s(e.__("Card")))])],1)],1),e._v(" "),n("v-col",{staticClass:"mt-2",attrs:{cols:"4"}},[n("v-btn",{attrs:{small:"",block:"",color:"warning",text:""},on:{click:e.show_coupons}},[e._v(e._s(e.couponsCount)+" "+e._s(e.__("Coupons")))])],1),e._v(" "),n("v-col",{staticClass:"mt-2",attrs:{cols:"5"}},[n("v-btn",{attrs:{small:"",block:"",color:"warning",text:""},on:{click:e.show_offers}},[e._v(e._s(e.offersCount)+" "+e._s(e.__("Offers"))+" : "+e._s(e.appliedOffersCount)+"\n          "+e._s(e.__("Applied")))])],1)],1)],1)],1)};a._withStripped=!0;var c=function(e,t,n,i,o,r,s,a){var c,l=("function"==typeof n?n.options:n)||{};if(l.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/ItemsSelector.vue",l.render||(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,o&&(l.functional=!0)),l._scopeId=i,t&&(c=function(e){t.call(this,s(e))}),void 0!==c)if(l.functional){var _=l.render;l.render=function(e,t){return c.call(t),_(e,t)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return l}({render:a,staticRenderFns:[]},function(e){e&&e("data-v-cdf19572_0",{source:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",map:{version:3,sources:[],names:[],mappings:"",file:"ItemsSelector.vue"},media:void 0})},s,"data-v-cdf19572",!1,0,function e(){var t=document.head||document.getElementsByTagName("head")[0],n=e.styles||(e.styles={}),i="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(e,o){if(!document.querySelector('style[data-vue-ssr-id~="'+e+'"]')){var r=i?o.media||"default":e,s=n[r]||(n[r]={ids:[],parts:[],element:void 0});if(!s.ids.includes(e)){var a=o.source,c=s.ids.length;if(s.ids.push(e),i&&(s.element=s.element||document.querySelector("style[data-group="+r+"]")),!s.element){var l=s.element=document.createElement("style");l.type="text/css",o.media&&l.setAttribute("media",o.media),i&&(l.setAttribute("data-group",r),l.setAttribute("data-next-index","0")),t.appendChild(l)}if(i&&(c=parseInt(s.element.getAttribute("data-next-index")),s.element.setAttribute("data-next-index",c+1)),s.element.styleSheet)s.parts.push(a),s.element.styleSheet.cssText=s.parts.filter(Boolean).join("\n");else{var _=document.createTextNode(a),u=s.element.childNodes;u[c]&&s.element.removeChild(u[c]),u.length?s.element.insertBefore(_,u[c]):s.element.appendChild(_)}}}}}),l={data:function(){return{pos_profile:"",customers:[],customer:"",readonly:!1}},methods:{get_customer_names:function(){var e=this;e.pos_profile.posa_local_storage&&localStorage.customer_storage&&(e.customers=JSON.parse(localStorage.getItem("customer_storage"))),frappe.call({method:"posawesome.posawesome.api.posapp.get_customer_names",args:{pos_profile:this.pos_profile.pos_profile},callback:function(t){t.message&&(e.customers=t.message,console.info("loadCustomers"),e.pos_profile.posa_local_storage&&(localStorage.setItem("customer_storage",""),localStorage.setItem("customer_storage",JSON.stringify(t.message))))}})},new_customer:function(){e.$emit("open_new_customer")},edit_customer:function(){e.$emit("open_edit_customer")},customFilter:function(e,t,n){var i=e.customer_name?e.customer_name.toLowerCase():"",o=e.tax_id?e.tax_id.toLowerCase():"",r=e.email_id?e.email_id.toLowerCase():"",s=e.mobile_no?e.mobile_no.toLowerCase():"",a=e.name.toLowerCase(),c=t.toLowerCase();return i.indexOf(c)>-1||o.indexOf(c)>-1||r.indexOf(c)>-1||s.indexOf(c)>-1||a.indexOf(c)>-1}},computed:{},created:function(){this.$nextTick(function(){var t=this;e.$on("register_pos_profile",function(e){t.pos_profile=e,t.get_customer_names()}),e.$on("set_customer",function(e){t.customer=e}),e.$on("add_customer_to_list",function(e){t.customers.push(e)}),e.$on("set_customer_readonly",function(e){t.readonly=e})})},watch:{customer:function(){e.$emit("update_customer",this.customer)}}},_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-autocomplete",{attrs:{dense:"",clearable:"","auto-select-first":"",outlined:"",color:"indigo",label:e.frappe._("Customer"),items:e.customers,"item-text":"customer_name","item-value":"name","background-color":"white","no-data-text":e.__("Customer not found"),"hide-details":"",filter:e.customFilter,disabled:e.readonly,"append-icon":"mdi-plus","prepend-inner-icon":"mdi-account-edit"},on:{"click:append":e.new_customer,"click:prepend-inner":e.edit_customer},scopedSlots:e._u([{key:"item",fn:function(t){return[[n("v-list-item-content",[n("v-list-item-title",{staticClass:"indigo--text subtitle-1",domProps:{innerHTML:e._s(t.item.customer_name)}}),e._v(" "),t.item.customer_name!=t.item.name?n("v-list-item-subtitle",{domProps:{innerHTML:e._s("ID: "+t.item.name)}}):e._e(),e._v(" "),t.item.tax_id?n("v-list-item-subtitle",{domProps:{innerHTML:e._s("TAX ID: "+t.item.tax_id)}}):e._e(),e._v(" "),t.item.email_id?n("v-list-item-subtitle",{domProps:{innerHTML:e._s("Email: "+t.item.email_id)}}):e._e(),e._v(" "),t.item.mobile_no?n("v-list-item-subtitle",{domProps:{innerHTML:e._s("Mobile No: "+t.item.mobile_no)}}):e._e(),e._v(" "),t.item.primary_address?n("v-list-item-subtitle",{domProps:{innerHTML:e._s("Primary Address: "+t.item.primary_address)}}):e._e()],1)]]}}]),model:{value:e.customer,callback:function(t){e.customer=t},expression:"customer"}})],1)};_._withStripped=!0;var u={data:function(){return{pos_profile:"",pos_opening_shift:"",stock_settings:"",invoice_doc:"",return_doc:"",customer:"",customer_info:"",discount_amount:0,additional_discount_percentage:0,total_tax:0,items:[],posOffers:[],posa_offers:[],posa_coupons:[],allItems:[],discount_percentage_offer_name:null,invoiceTypes:["Invoice","Order"],invoiceType:"Invoice",itemsPerPage:1e3,expanded:[],singleExpand:!0,cancel_dialog:!1,items_headers:[{text:__("Name"),align:"start",sortable:!0,value:"item_name"},{text:__("QTY"),value:"qty",align:"center"},{text:__("UOM"),value:"uom",align:"center"},{text:__("Rate"),value:"rate",align:"center"},{text:__("Amount"),value:"amount",align:"center"},{text:__("is Offer"),value:"posa_is_offer",align:"center"}]}},components:{Customer:function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/Customer.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:_,staticRenderFns:[]},0,l,void 0,!1)},computed:{total_qty:function(){this.close_payments();var e=0;return this.items.forEach(function(t){e+=t.qty}),flt(e).toFixed(2)},Total:function(){var e=0;return this.items.forEach(function(t){e+=t.qty*t.rate}),flt(e).toFixed(2)},subtotal:function(){this.close_payments();var e=0;return this.items.forEach(function(t){e+=t.qty*t.rate}),e-=flt(this.discount_amount),flt(e).toFixed(2)},total_items_discount_amount:function(){var e=0;return this.items.forEach(function(t){e+=t.qty*t.discount_amount}),flt(e).toFixed(2)}},methods:{remove_item:function(e){var t=this.items.findIndex(function(t){return t.posa_row_id==e.posa_row_id});t>=0&&this.items.splice(t,1);var n=this.expanded.findIndex(function(t){return t.posa_row_id==e.posa_row_id});n>=0&&this.expanded.splice(n,1)},add_one:function(e){e.qty++,0==e.qty&&this.remove_item(e),this.calc_sotck_gty(e,e.qty),this.$forceUpdate()},subtract_one:function(e){e.qty--,0==e.qty&&this.remove_item(e),this.calc_sotck_gty(e,e.qty),this.$forceUpdate()},add_item:function(t){t.uom||(t.uom=t.stock_uom);var n=this.items.findIndex(function(e){return e.item_code===t.item_code&&e.uom===t.uom&&!e.posa_is_offer&&!e.posa_is_replace});if(-1===n){var i=this.get_new_item(t);t.has_serial_no&&t.to_set_serial_no&&(i.serial_no_selected=[],i.serial_no_selected.push(t.to_set_serial_no),t.to_set_serial_no=null),this.items.unshift(i),this.update_item_detail(i)}else{var o=this.items[n];if(this.update_items_details([o]),t.has_serial_no&&t.to_set_serial_no){if(o.serial_no_selected.includes(t.to_set_serial_no))return e.$emit("show_mesage",{text:__("This Serial Number {0} has already been added!",[t.to_set_serial_no]),color:"warning"}),void(t.to_set_serial_no=null);o.serial_no_selected.push(t.to_set_serial_no),t.to_set_serial_no=null}if(o.has_batch_no)if(o.stock_qty<o.actual_batch_qty||!o.batch_no)o.qty+=t.qty||1,this.calc_sotck_gty(o,o.qty);else{var r=this.get_new_item(o);r.batch_no="",r.batch_no_expiry_date="",r.actual_batch_qty="",r.qty=t.qty||1,this.items.unshift(r)}else o.qty+=t.qty||1,this.calc_sotck_gty(o,o.qty);this.set_serial_no(o)}this.$forceUpdate()},get_new_item:function(e){var t=Object.assign({},e);return e.qty||(e.qty=1),e.posa_is_offer||(e.posa_is_offer=0),e.posa_is_replace||(e.posa_is_replace=""),t.stock_qty=e.qty,t.discount_amount=0,t.discount_percentage=0,t.discount_amount_per_item=0,t.price_list_rate=e.rate,t.qty=e.qty,t.uom=e.uom?e.uom:e.stock_uom,t.actual_batch_qty="",t.conversion_factor=1,t.posa_offers=JSON.stringify([]),t.posa_offer_applied=0,t.posa_is_offer=e.posa_is_offer,t.posa_is_replace=e.posa_is_replace||null,t.is_free_item=0,t.posa_notes="",t.posa_delivery_date="",t.posa_row_id=this.makeid(20),(!this.pos_profile.posa_auto_set_batch&&t.has_batch_no||t.has_serial_no)&&this.expanded.push(t),t},cancel_invoice:function(){var t=this.get_invoice_doc();this.invoiceType="Invoice",this.invoiceTypes=["Invoice","Order"],t.name&&this.pos_profile.posa_allow_delete&&frappe.call({method:"posawesome.posawesome.api.posapp.delete_invoice",args:{invoice:t.name},async:!0,callback:function(t){t.message&&e.$emit("show_mesage",{text:t.message,color:"warning"})}}),this.items=[],this.posa_offers=[],e.$emit("set_pos_coupons",[]),this.posa_coupons=[],this.customer=this.pos_profile.customer,this.invoice_doc="",this.return_doc="",this.discount_amount=0,this.additional_discount_percentage=0,e.$emit("set_customer_readonly",!1),this.cancel_dialog=!1},new_invoice:function(t){var n=this;void 0===t&&(t={}),e.$emit("set_customer_readonly",!1),this.expanded=[],this.posa_offers=[],e.$emit("set_pos_coupons",[]),this.posa_coupons=[],this.return_doc="";var i=this.get_invoice_doc();i.name?this.update_invoice(i):i.items.length&&this.update_invoice(i),t.name||t.is_return?(t.is_return&&(e.$emit("set_customer_readonly",!0),this.invoiceType="Return",this.invoiceTypes=["Return"]),this.invoice_doc=t,this.items=t.items,this.update_items_details(this.items),this.posa_offers=t.posa_offers||[],this.items.forEach(function(e){e.posa_row_id||(e.posa_row_id=n.makeid(20)),e.batch_no&&n.set_batch_qty(e,e.batch_no)}),this.customer=t.customer,this.discount_amount=t.discount_amount,this.additional_discount_percentage=t.additional_discount_percentage,this.items.forEach(function(e){e.serial_no&&(e.serial_no_selected=[],e.serial_no.split("\n").forEach(function(t){t.length&&e.serial_no_selected.push(t)}),e.serial_no_selected_count=e.serial_no_selected.length)})):(this.items=[],this.customer=this.pos_profile.customer,this.invoice_doc="",this.discount_amount=0,this.additional_discount_percentage=0,this.invoiceType="Invoice",this.invoiceTypes=["Invoice","Order"])},get_invoice_doc:function(){var e={};return this.invoice_doc.name&&(e=Object.assign({},this.invoice_doc)),e.doctype="Sales Invoice",e.is_pos=1,e.ignore_pricing_rule=1,e.company=e.company||this.pos_profile.company,e.pos_profile=e.pos_profile||this.pos_profile.name,e.campaign=e.campaign||this.pos_profile.campaign,e.currency=e.currency||this.pos_profile.currency,e.naming_series=e.naming_series||this.pos_profile.naming_series,e.customer=this.customer,e.items=this.get_invoice_items(),e.total=this.subtotal,e.discount_amount=flt(this.discount_amount),e.additional_discount_percentage=flt(this.additional_discount_percentage),e.posa_pos_opening_shift=this.pos_opening_shift.name,e.payments=this.get_payments(),e.taxes=[],e.is_return=this.invoice_doc.is_return,e.return_against=this.invoice_doc.return_against,e.posa_offers=this.posa_offers,e.posa_coupons=this.posa_coupons,e},get_invoice_items:function(){var e=[];return this.items.forEach(function(t){var n={item_code:t.item_code,posa_row_id:t.posa_row_id,posa_offers:t.posa_offers,posa_offer_applied:t.posa_offer_applied,posa_is_offer:t.posa_is_offer,posa_is_replace:t.posa_is_replace,is_free_item:t.is_free_item,qty:t.qty,rate:t.rate,uom:t.uom,amount:t.qty*t.rate,conversion_factor:t.conversion_factor,serial_no:t.serial_no,discount_percentage:t.discount_percentage,discount_amount:t.discount_amount,batch_no:t.batch_no,posa_notes:t.posa_notes,posa_delivery_date:t.posa_delivery_date,price_list_rate:t.price_list_rate};e.push(n)}),e},get_payments:function(){var e=[];return this.pos_profile.payments.forEach(function(t){e.push({amount:0,mode_of_payment:t.mode_of_payment,default:t.default,account:""})}),e},update_invoice:function(e){var t=this;return frappe.call({method:"posawesome.posawesome.api.posapp.update_invoice",args:{data:e},async:!1,callback:function(e){e.message&&(t.invoice_doc=e.message)}}),this.invoice_doc},proces_invoice:function(){var e=this.get_invoice_doc();return e.name,this.update_invoice(e)},show_payment:function(){if(this.customer)if(this.items.length){if(this.validate()){e.$emit("show_payment","true");var t=this.proces_invoice();e.$emit("send_invoice_doc_payment",t)}}else e.$emit("show_mesage",{text:__("There is no Items !"),color:"error"});else e.$emit("show_mesage",{text:__("There is no Customer !"),color:"error"})},validate:function(){var t=this,n=!0;return this.items.forEach(function(i){(1!=t.stock_settings.allow_negative_stock&&"Invoice"==t.invoiceType&&(i.is_stock_item&&i.stock_qty&&!i.actual_qty||i.is_stock_item&&i.stock_qty>i.actual_qty)&&(e.$emit("show_mesage",{text:__("The existing quantity '{0}' for item '{1}' is not enough",[i.actual_qty,i.item_name]),color:"error"}),n=!1),i.max_discount>0&&i.discount_percentage>i.max_discount&&(e.$emit("show_mesage",{text:__("Maximum discount for Item {0} is {1}%",[i.item_name,i.max_discount]),color:"error"}),n=!1),i.has_serial_no&&(t.invoice_doc.is_return||i.serial_no_selected&&i.stock_qty==i.serial_no_selected.length||(e.$emit("show_mesage",{text:__("Selected serial numbers of item {0} is incorrect",[i.item_name]),color:"error"}),n=!1)),i.has_batch_no&&i.stock_qty>i.actual_batch_qty&&(e.$emit("show_mesage",{text:__("The existing batch quantity of item {0} is not enough",[i.item_name]),color:"error"}),n=!1),t.pos_profile.posa_allow_user_to_edit_additional_discount)&&(t.discount_amount/t.Total*100>t.pos_profile.posa_max_discount_allowed&&(e.$emit("show_mesage",{text:__("The discount should not be higher than {0}%",[t.pos_profile.posa_max_discount_allowed]),color:"error"}),n=!1));if(t.invoice_doc.is_return){if(t.subtotal>=0)return e.$emit("show_mesage",{text:__("Return Invoice Total Not Correct"),color:"error"}),n=!1;if(-1*t.subtotal>t.return_doc.total)return e.$emit("show_mesage",{text:__("Return Invoice Total should not be higher than {0}",[t.return_doc.total]),color:"error"}),n=!1;t.items.forEach(function(i){var o=t.return_doc.items.find(function(e){return e.item_code==i.item_code});return o?-1*i.qty>o.qty||i.qty>=0?(e.$emit("show_mesage",{text:__("The QTY of the item {0} cannot be greater than {1}",[i.item_name,o.qty]),color:"error"}),n=!1):void 0:(e.$emit("show_mesage",{text:__("The item {0} cannot be returned because it is not in the invoice {1}",[i.item_name,t.return_doc.name]),color:"error"}),n=!1)})}}),n},get_draft_invoices:function(){frappe.call({method:"posawesome.posawesome.api.posapp.get_draft_invoices",args:{pos_opening_shift:this.pos_opening_shift.name},async:!1,callback:function(t){t.message&&e.$emit("open_drafts",t.message)}})},open_returns:function(){e.$emit("open_returns",this.pos_profile.company)},close_payments:function(){e.$emit("show_payment","false")},update_items_details:function(e){if(!(!e.length>0)){this.pos_profile&&frappe.call({method:"posawesome.posawesome.api.posapp.get_items_details",async:!1,args:{pos_profile:this.pos_profile,items_data:e},callback:function(t){t.message&&e.forEach(function(e){var n=t.message.find(function(t){return t.posa_row_id==e.posa_row_id});e.actual_qty=n.actual_qty,e.serial_no_data=n.serial_no_data,e.batch_no_data=n.batch_no_data,e.item_uoms=n.item_uoms,e.has_batch_no=n.has_batch_no,e.has_serial_no=n.has_serial_no})}})}},update_item_detail:function(e){var t=this;frappe.call({method:"posawesome.posawesome.api.posapp.get_item_detail",args:{warehouse:this.pos_profile.warehouse,doc:this.get_invoice_doc(),price_list:this.pos_profile.price_list,item:{item_code:e.item_code,customer:this.customer,doctype:"Sales Invoice",name:"New Sales Invoice 1",company:this.pos_profile.company,conversion_rate:1,qty:e.qty,price_list_rate:e.price_list_rate,child_docname:"New Sales Invoice Item 1",cost_center:this.pos_profile.cost_center,currency:this.pos_profile.currency,pos_profile:this.pos_profile.name,price_list:this.pos_profile.selling_price_list,uom:e.uom,tax_category:"",transaction_type:"selling",update_stock:this.pos_profile.update_stock,price_list:this.get_price_list(),has_batch_no:e.has_batch_no,serial_no:e.serial_no,batch_no:e.batch_no,is_stock_item:e.is_stock_item}},callback:function(n){if(n.message){var i=n.message;e.has_batch_no&&t.pos_profile.posa_auto_set_batch&&!e.batch_no&&i.batch_no&&(e.batch_no=i.batch_no,t.set_batch_qty(e,e.batch_no,!1)),i.has_pricing_rule||t.pos_profile.posa_apply_customer_discount&&t.customer_info.posa_discount>0&&t.customer_info.posa_discount<=100&&(0!=e.posa_is_offer||e.posa_is_replace||0!=e.posa_offer_applied||(e.max_discount>0?e.discount_percentage=e.max_discount<t.customer_info.posa_discount?e.max_discount:t.customer_info.posa_discount:e.discount_percentage=t.customer_info.posa_discount)),e.btach_price||e.is_free_item||e.posa_is_offer||e.posa_is_replace||(e.price_list_rate=i.price_list_rate),e.last_purchase_rate=i.last_purchase_rate,e.projected_qty=i.projected_qty,e.reserved_qty=i.reserved_qty,e.conversion_factor=i.conversion_factor,e.stock_qty=i.stock_qty,e.actual_qty=i.actual_qty,e.stock_uom=i.stock_uom,e.has_serial_no=i.has_serial_no,e.has_batch_no=i.has_batch_no,t.calc_item_price(e)}}})},fetch_customer_details:function(){var e=this;this.customer&&frappe.call({method:"posawesome.posawesome.api.posapp.get_customer_info",args:{customer:e.customer},async:!1,callback:function(t){var n=t.message;t.exc||(e.customer_info=Object.assign({},n)),e.update_price_list()}})},get_price_list:function(){var e=this.pos_profile.selling_price_list;if(this.customer_info&&this.pos_profile){var t=this.customer_info,n=t.customer_price_list,i=t.customer_group_price_list,o=this.pos_profile.selling_price_list;n&&n!=o?e=n:i&&i!=o&&(e=i)}return e},update_price_list:function(){var t=this.get_price_list();t==this.pos_profile.selling_price_list&&(t=null),e.$emit("update_customer_price_list",t)},update_discount_umount:function(){var e=flt(this.additional_discount_percentage);e>=-100&&e<=100?this.discount_amount=this.Total*e/100:(this.additional_discount_percentage=0,this.discount_amount=0)},calc_prices:function(e,t,n){"rate"===event.target.id?(e.discount_percentage=0,t<e.price_list_rate?e.discount_amount=(flt(e.price_list_rate)-flt(t)).toFixed(2):t<0?(e.rate=e.price_list_rate,e.discount_amount=0):t>e.price_list_rate&&(e.discount_amount=0)):"discount_amount"===event.target.id?t<0?(e.discount_amount=0,e.discount_percentage=0):(e.rate=flt(e.price_list_rate)-flt(t),e.discount_percentage=0):"discount_percentage"===event.target.id&&(t<0?(e.discount_amount=0,e.discount_percentage=0):(e.rate=(flt(e.price_list_rate)-flt(e.price_list_rate)*flt(t)/100).toFixed(2),e.discount_amount=(flt(e.price_list_rate)-flt(e.rate)).toFixed(2)))},calc_item_price:function(e){e.posa_offer_applied||e.price_list_rate&&(e.rate=e.price_list_rate),e.discount_percentage?(e.rate=flt(e.price_list_rate)-flt(e.price_list_rate)*flt(e.discount_percentage)/100,e.discount_amount=(flt(e.price_list_rate)-flt(e.rate)).toFixed(2)):e.discount_amount&&(e.rate=(flt(e.price_list_rate)-flt(e.discount_amount)).toFixed(2))},calc_uom:function(e,t){var n=e.item_uoms.find(function(e){return e.uom==t});e.conversion_factor=n.conversion_factor,e.posa_offer_applied||(e.discount_amount=0,e.discount_percentage=0),e.btach_price&&(e.price_list_rate=e.btach_price*n.conversion_factor),this.update_item_detail(e)},calc_sotck_gty:function(e,t){e.stock_qty=e.conversion_factor*t},set_serial_no:function(t){t.has_serial_no&&(t.serial_no="",t.serial_no_selected.forEach(function(e){t.serial_no+=e+"\n"}),t.serial_no_selected_count=t.serial_no_selected.length,t.serial_no_selected_count!=t.stock_qty&&e.$emit("show_mesage",{text:__("Selected Serial No QTY is {0} it should be {1}",[t.serial_no_selected_count,t.stock_qty]),color:"warning"}))},set_batch_qty:function(e,t,n){void 0===n&&(n=!0);var i=e.batch_no_data.find(function(e){return e.batch_no==t});e.actual_batch_qty=i.batch_qty,e.batch_no_expiry_date=i.expiry_date,i.btach_price?(e.btach_price=i.btach_price,e.price_list_rate=i.btach_price,e.rate=i.btach_price):n&&(e.btach_price=null,this.update_item_detail(e))},formtCurrency:function(e){return(e=parseFloat(e)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},shortOpenPayment:function(e){"s"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.show_payment())},shortDeleteFirstItem:function(e){"d"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.remove_item(this.items[0]))},shortOpenFirstItem:function(e){"a"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.expanded=[],this.expanded.push(this.items[0]))},shortSelectDiscount:function(e){"z"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.$refs.discount.focus())},makeid:function(e){for(var t="",n="abcdefghijklmnopqrstuvwxyz0123456789",i=n.length,o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*i));return t},checkOfferIsAppley:function(e,t){for(var n=this,i=!1,o=JSON.parse(e.posa_offers),r=function(){var e=a[s],o=n.posa_offers.find(function(t){return e==t.row_id});if(o&&o.offer_name==t.name)return i=!0,"break"},s=0,a=o;s<a.length;s+=1){if("break"===r())break}return i},handelOffers:function(){var e=this,t=[];this.posOffers.forEach(function(n){if("Item Code"===n.apply_on){var i=e.getItemOffer(n);i&&t.push(i)}else if("Item Group"===n.apply_on){var o=e.getGroupOffer(n);o&&t.push(o)}else if("Brand"===n.apply_on){var r=e.getBrandOffer(n);r&&t.push(r)}else if("Transaction"===n.apply_on){var s=e.getTransactionOffer(n);s&&t.push(s)}}),this.setItemGiveOffer(t),this.updatePosOffers(t)},setItemGiveOffer:function(e){var t=this;e.forEach(function(e){if("Item Code"==e.apply_on&&"Item Code"==e.apply_type&&e.replace_item)e.give_item=e.item,e.apply_item_code=e.item;else if("Item Group"==e.apply_on&&"Item Group"==e.apply_type&&e.replace_cheapest_item){var n=t.getCheapestItem(e).item_code;e.give_item=n,e.apply_item_code=n}})},getCheapestItem:function(e){var t,n=this;t="string"==typeof e.items?JSON.parse(e.items):e.items;var i=[];return t.forEach(function(e){i.push(n.getItemFromRowID(e))}),i.reduce(function(e,t){return!t.posa_is_replace&&!t.posa_is_offer&&t.price_list_rate<e.price_list_rate?t:e})},getItemFromRowID:function(e){return this.items.find(function(t){return t.posa_row_id==e})},checkQtyAnountOffer:function(e,t,n){var i=!1,o=!1,r=!1,s=!1,a=[];(e.min_qty||0==e.min_qty)&&(t>=e.min_qty&&(i=!0),a.push(i)),e.max_qty>0&&(t<=e.max_qty&&(o=!0),a.push(o)),e.min_amt>0&&(n>=e.min_amt&&(r=!0),a.push(r)),e.max_amt>0&&(n<=e.max_amt&&(s=!0),a.push(s));var c=!1;return a.includes(!1)||(c=!0),{apply:c,conditions:{min_qty:i,max_qty:o,min_amt:r,max_amt:s}}},checkOfferCoupon:function(e){if(e.coupon_based){var t=this.posa_coupons.find(function(t){return e.name==t.pos_offer});return!!t&&(e.coupon=t.coupon,!0)}return e.coupon=null,!0},getItemOffer:function(e){var t=this,n=null;return"Item Code"===e.apply_on&&this.checkOfferCoupon(e)&&this.items.forEach(function(i){if(!i.posa_is_offer&&i.item_code===e.item){var o=[];if("Item Price"===e.offer&&i.posa_offer_applied&&!t.checkOfferIsAppley(i,e));else t.checkQtyAnountOffer(e,i.stock_qty,i.stock_qty*i.price_list_rate).apply&&(o.push(i.posa_row_id),e.items=o,n=e)}}),n},getGroupOffer:function(e){var t=this,n=null;if("Item Group"===e.apply_on&&this.checkOfferCoupon(e)){var i=[],o=0,r=0;if(this.items.forEach(function(n){n.posa_is_offer||n.item_group!==e.item_group||"Item Price"===e.offer&&n.posa_offer_applied&&!t.checkOfferIsAppley(n,e)||(o+=n.stock_qty,r+=n.stock_qty*n.price_list_rate,i.push(n.posa_row_id))}),o||r)this.checkQtyAnountOffer(e,o,r).apply&&(e.items=i,n=e)}return n},getBrandOffer:function(e){var t=this,n=null;if("Brand"===e.apply_on&&this.checkOfferCoupon(e)){var i=[],o=0,r=0;if(this.items.forEach(function(n){n.posa_is_offer||n.brand!==e.brand||"Item Price"===e.offer&&n.posa_offer_applied&&!t.checkOfferIsAppley(n,e)||(o+=n.stock_qty,r+=n.stock_qty*n.price_list_rate,i.push(n.posa_row_id))}),o||r)this.checkQtyAnountOffer(e,o,r).apply&&(e.items=i,n=e)}return n},getTransactionOffer:function(e){var t=null;if("Transaction"===e.apply_on&&this.checkOfferCoupon(e)){var n=0;this.items.forEach(function(e){e.posa_is_offer||e.posa_is_replace||(n+=e.stock_qty)});var i=[],o=n,r=this.Total;if(o||r)this.checkQtyAnountOffer(e,o,r).apply&&(this.items.forEach(function(e){i.push(e.posa_row_id)}),e.items=i,t=e)}return t},updatePosOffers:function(t){e.$emit("update_pos_offers",t)},updateInvoiceOffers:function(e){var t=this;this.posa_offers.forEach(function(n){e.find(function(e){return n.row_id==e.row_id})||t.removeApplyOffer(n)}),e.forEach(function(e){var n=t.posa_offers.find(function(t){return t.row_id==e.row_id});if(n){if(n.items=JSON.stringify(e.items),"Give Product"===n.offer&&n.give_item&&n.give_item!=e.give_item){var i=t.items.find(function(e){return e.posa_row_id==n.give_item_row_id});if(i){var o=e.items.filter(function(e){return e!=i.posa_row_id});e.items=o,t.remove_item(i),n.give_item_row_id=null,n.give_item=null}var r=t.ApplyOnGiveProduct(e);if(e.replace_cheapest_item){var s=t.getCheapestItem(e),a=t.items.find(function(e){return e.posa_row_id==i.posa_is_replace});if(r.qty=i.qty,a&&!a.posa_is_replace)a.qty+=i.qty;else{var c=t.ApplyOnGiveProduct({given_qty:i.qty},i.item_code);c.posa_is_offer=0,t.items.unshift(c)}r.posa_is_offer=0,r.posa_is_replace=s.posa_row_id;var l=s.qty-r.qty;l<=0?(r.qty+=l,t.remove_item(s),r.posa_row_id=s.posa_row_id,r.posa_is_replace=r.posa_row_id):s.qty=l}t.items.unshift(r),n.give_item_row_id=r.posa_row_id,n.give_item=r.item_code}else"Give Product"===n.offer&&n.give_item&&n.give_item==e.give_item&&(e.replace_item||e.replace_cheapest_item)?t.$nextTick(function(){var t=this,i=this.getItemFromRowID(n.give_item_row_id),o=e.given_qty-i.qty;if(o>0){var r=JSON.parse(n.items),s=[];r.forEach(function(e){s.push(t.getItemFromRowID(e))});var a=s.find(function(e){return e.item_code==i.item_code&&e.posa_is_replace!=i.posa_row_id});if(a)a.qty-o>0?(i.qty+=o,a.qty-=o):(i.qty+=a.qty,this.remove_item(a))}}):"Item Price"===n.offer?t.ApplyOnPrice(e):"Grand Total"===n.offer&&t.ApplyOnTotal(e);t.addOfferToItems(n)}else t.applyNewOffer(e)})},removeApplyOffer:function(e){if("Item Price"===e.offer){this.RemoveOnPrice(e);var t=this.posa_offers.findIndex(function(t){return t.row_id===e.row_id});this.posa_offers.splice(t,1)}if("Give Product"===e.offer){var n=this.items.find(function(t){return t.posa_row_id==e.give_item_row_id}),i=this.posa_offers.findIndex(function(t){return t.row_id===e.row_id});this.posa_offers.splice(i,1),this.remove_item(n)}if("Grand Total"===e.offer){this.RemoveOnTotal(e);var o=this.posa_offers.findIndex(function(t){return t.row_id===e.row_id});this.posa_offers.splice(o,1)}if("Loyalty Point"===e.offer){var r=this.posa_offers.findIndex(function(t){return t.row_id===e.row_id});this.posa_offers.splice(r,1)}this.deleteOfferFromItems(e)},applyNewOffer:function(t){var n,i=this;if("Item Price"===t.offer&&this.ApplyOnPrice(t),"Give Product"===t.offer)if(n="string"==typeof t.items?JSON.parse(t.items):t.items,"Item Code"==t.apply_on&&"Item Code"==t.apply_type&&t.replace_item){var o=this.ApplyOnGiveProduct(t,t.item);o.posa_is_replace=n[0];var r=this.items.find(function(e){return e.posa_row_id==o.posa_is_replace}),s=r.qty-t.given_qty;o.posa_is_offer=0,s<=0?(o.qty=r.qty,this.remove_item(r),o.posa_row_id=o.posa_is_replace):r.qty=s,this.items.unshift(o),t.give_item_row_id=o.posa_row_id}else if("Item Group"==t.apply_on&&"Item Group"==t.apply_type&&t.replace_cheapest_item){var a=[];n.forEach(function(e){a.push(i.getItemFromRowID(e))});var c=a.find(function(e){return e.item_code==t.give_item}),l=this.ApplyOnGiveProduct(t,t.give_item);l.posa_is_offer=0,l.posa_is_replace=c.posa_row_id;var _=c.qty-t.given_qty;_<=0?(l.qty=c.qty,this.remove_item(c),l.posa_row_id=l.posa_is_replace):c.qty=_,this.items.unshift(l),t.give_item_row_id=l.posa_row_id}else{var u=this.ApplyOnGiveProduct(t);this.items.unshift(u),u&&(t.give_item_row_id=u.posa_row_id)}"Grand Total"===t.offer&&this.ApplyOnTotal(t),"Loyalty Point"===t.offer&&e.$emit("show_mesage",{text:__("Loyalty Point Offer Applied"),color:"success"});var f={offer_name:t.name,row_id:t.row_id,apply_on:t.apply_on,offer:t.offer,items:JSON.stringify(t.items),give_item:t.give_item,give_item_row_id:t.give_item_row_id,offer_applied:t.offer_applied,coupon_based:t.coupon_based,coupon:t.coupon};this.posa_offers.push(f),this.addOfferToItems(f)},ApplyOnGiveProduct:function(e,t){t||(t=e.give_item);var n=this.allItems.find(function(e){return e.item_code==t});if(n){var i=Object.assign({},n);return i.qty=e.given_qty,i.stock_qty=e.given_qty,i.rate="Rate"===e.discount_type?e.rate:n.rate,i.discount_amount="Discount Amount"===e.discount_type?e.discount_amount:0,i.discount_percentage="Discount Percentage"===e.discount_type?e.discount_percentage:0,i.discount_amount_per_item=0,i.uom=n.uom?n.uom:n.stock_uom,i.actual_batch_qty="",i.conversion_factor=1,i.posa_offers=JSON.stringify([]),i.posa_offer_applied=0,i.posa_is_offer=1,i.posa_is_replace=null,i.posa_notes="",i.posa_delivery_date="",i.is_free_item="Rate"===e.discount_type&&!e.rate||"Discount Percentage"===e.discount_type&&0==e.discount_percentage?1:0,i.posa_row_id=this.makeid(20),i.price_list_rate="Rate"===e.discount_type&&!e.rate||"Discount Percentage"===e.discount_type&&0==e.discount_percentage?0:n.rate,(!this.pos_profile.posa_auto_set_batch&&i.has_batch_no||i.has_serial_no)&&this.expanded.push(i),this.update_item_detail(i),i}},ApplyOnPrice:function(e){var t=this;this.items.forEach(function(n){e.items.includes(n.posa_row_id)&&(JSON.parse(n.posa_offers).includes(e.row_id)||("Rate"===e.discount_type?n.rate=e.rate:"Discount Percentage"===e.discount_type?n.discount_percentage+=e.discount_percentage:"Discount Amount"===e.discount_type&&(n.discount_amount+=e.discount_amount),n.posa_offer_applied=1,t.calc_item_price(n)))})},RemoveOnPrice:function(e){var t=this;this.items.forEach(function(n){if(JSON.parse(n.posa_offers).includes(e.row_id)){var i=t.posOffers.find(function(t){return t.name==e.offer_name});i&&("Rate"===i.discount_type?n.rate=n.price_list_rate:"Discount Percentage"===i.discount_type?(n.discount_percentage-=e.discount_percentage,n.discount_percentage||(n.discount_percentage=0,n.discount_amount=0,n.rate=n.price_list_rate)):"Discount Amount"===i.discount_type&&(n.discount_amount-=e.discount_amount),t.calc_item_price(n))}})},ApplyOnTotal:function(e){e.name||(e=this.posOffers.find(function(t){return t.name==e.offer_name})),(!this.discount_percentage_offer_name||this.discount_percentage_offer_name==e.name)&&e.discount_percentage>0&&e.discount_percentage<=100&&(this.discount_amount=(flt(this.Total)*flt(e.discount_percentage)/100).toFixed(2),this.discount_percentage_offer_name=e.name)},RemoveOnTotal:function(e){this.discount_percentage_offer_name&&this.discount_percentage_offer_name==e.offer_name&&(this.discount_amount=0,this.discount_percentage_offer_name=null)},addOfferToItems:function(e){var t=this;JSON.parse(e.items).forEach(function(n){t.items.forEach(function(t){if(t.posa_row_id==n){var i=JSON.parse(t.posa_offers);i.includes(e.row_id)||(i.push(e.row_id),"Item Price"===e.offer&&(t.posa_offer_applied=1)),t.posa_offers=JSON.stringify(i)}})})},deleteOfferFromItems:function(e){var t=this;JSON.parse(e.items).forEach(function(n){t.items.forEach(function(t){if(t.posa_row_id==n){var i=JSON.parse(t.posa_offers).filter(function(t){return t!=e.row_id});"Item Price"===e.offer&&(t.posa_offer_applied=0),t.posa_offers=JSON.stringify(i)}})})},validate_due_date:function(e){var t=frappe.datetime.now_date(),n=Date.parse(t);Date.parse(e.posa_delivery_date)<n&&setTimeout(function(){e.posa_delivery_date=t},0)}},created:function(){var t=this;e.$on("register_pos_profile",function(e){t.pos_profile=e.pos_profile,t.customer=e.pos_profile.customer,t.pos_opening_shift=e.pos_opening_shift,t.stock_settings=e.stock_settings}),e.$on("add_item",function(e){t.add_item(e)}),e.$on("update_customer",function(e){t.customer=e}),e.$on("new_invoice",function(){t.invoice_doc="",t.cancel_invoice()}),e.$on("load_invoice",function(n){t.new_invoice(n),e.$emit("set_pos_coupons",n.posa_coupons)}),e.$on("set_offers",function(e){t.posOffers=e}),e.$on("update_invoice_offers",function(e){t.updateInvoiceOffers(e)}),e.$on("update_invoice_coupons",function(e){t.posa_coupons=e,t.handelOffers()}),e.$on("set_all_items",function(e){t.allItems=e,t.items.forEach(function(e){t.update_item_detail(e)})}),e.$on("load_return_invoice",function(e){t.new_invoice(e.invoice_doc),t.discount_amount=-e.return_doc.discount_amount,t.additional_discount_percentage=-e.return_doc.additional_discount_percentage,t.return_doc=e.return_doc}),document.addEventListener("keydown",this.shortOpenPayment.bind(this)),document.addEventListener("keydown",this.shortDeleteFirstItem.bind(this)),document.addEventListener("keydown",this.shortOpenFirstItem.bind(this)),document.addEventListener("keydown",this.shortSelectDiscount.bind(this))},destroyed:function(){document.removeEventListener("keydown",this.shortOpenPayment),document.removeEventListener("keydown",this.shortDeleteFirstItem),document.removeEventListener("keydown",this.shortOpenFirstItem),document.removeEventListener("keydown",this.shortSelectDiscount)},watch:{customer:function(){this.close_payments(),e.$emit("set_customer",this.customer),this.fetch_customer_details()},customer_info:function(){e.$emit("set_customer_info_to_edit",this.customer_info)},expanded:function(e){this.update_items_details(e),e.length>0&&this.update_item_detail(e[0])},discount_percentage_offer_name:function(){e.$emit("update_discount_percentage_offer_name",{value:this.discount_percentage_offer_name})},items:{deep:!0,handler:function(e){this.handelOffers(),this.$forceUpdate()}},invoiceType:function(){e.$emit("update_invoice_type",this.invoiceType)},discount_amount:function(){this.discount_amount&&0!=this.discount_amount&&this.pos_profile.posa_use_percentage_discount?this.additional_discount_percentage=this.discount_amount/this.Total*100:this.additional_discount_percentage=0}}},f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-dialog",{attrs:{"max-width":"330"},model:{value:e.cancel_dialog,callback:function(t){e.cancel_dialog=t},expression:"cancel_dialog"}},[n("v-card",[n("v-card-title",{staticClass:"text-h5"},[e._v("\n        "+e._s(e.__("Cancel Current Invoice ?"))+"\n      ")]),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error"},on:{click:e.cancel_invoice}},[e._v("\n          "+e._s(e.__("Cancel"))+"\n        ")]),e._v(" "),n("v-btn",{attrs:{color:"primary"},on:{click:function(t){e.cancel_dialog=!1}}},[e._v("\n          "+e._s(e.__("Back"))+"\n        ")])],1)],1)],1),e._v(" "),n("v-card",{staticClass:"cards my-0 py-0 grey lighten-5",staticStyle:{"max-height":"70vh",height:"70vh"}},[n("v-row",{staticClass:"items px-2 py-1",attrs:{align:"center"}},[e.pos_profile.posa_allow_sales_order?n("v-col",{staticClass:"pb-0 mb-2 pr-0",attrs:{cols:"9"}},[n("Customer")],1):e._e(),e._v(" "),e.pos_profile.posa_allow_sales_order?e._e():n("v-col",{staticClass:"pb-0 mb-2",attrs:{cols:"12"}},[n("Customer")],1),e._v(" "),e.pos_profile.posa_allow_sales_order?n("v-col",{staticClass:"pb-0 mb-2",attrs:{cols:"3"}},[n("v-select",{attrs:{dense:"","hide-details":"",outlined:"",color:"indigo","background-color":"white",items:e.invoiceTypes,label:e.frappe._("Type"),disabled:"Return"==e.invoiceType},model:{value:e.invoiceType,callback:function(t){e.invoiceType=t},expression:"invoiceType"}})],1):e._e()],1),e._v(" "),n("div",{staticClass:"my-0 py-0 overflow-y-auto",staticStyle:{"max-height":"60vh"}},[[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.items_headers,items:e.items,"single-expand":e.singleExpand,expanded:e.expanded,"show-expand":"","item-key":"posa_row_id","items-per-page":e.itemsPerPage,"hide-default-footer":""},on:{"update:expanded":function(t){e.expanded=t}},scopedSlots:e._u([{key:"item.qty",fn:function(t){var n=t.item;return[e._v(e._s(e.formtCurrency(n.qty)))]}},{key:"item.rate",fn:function(t){var n=t.item;return[e._v(e._s(e.formtCurrency(n.rate)))]}},{key:"item.amount",fn:function(t){var n=t.item;return[e._v(e._s(e.formtCurrency(n.qty*n.rate)))]}},{key:"item.posa_is_offer",fn:function(e){var t=e.item;return[n("v-simple-checkbox",{attrs:{value:!!t.posa_is_offer||!!t.posa_is_replace,disabled:""}})]}},{key:"expanded-item",fn:function(t){var i=t.headers,o=t.item;return[n("td",{staticClass:"ma-0 pa-0",attrs:{colspan:i.length}},[n("v-row",{staticClass:"ma-0 pa-0"},[n("v-col",{attrs:{cols:"1"}},[n("v-btn",{attrs:{disabled:!!o.posa_is_offer||!!o.posa_is_replace,icon:"",color:"red"},on:{click:function(t){return t.stopPropagation(),e.remove_item(o)}}},[n("v-icon",[e._v("mdi-delete")])],1)],1),e._v(" "),n("v-spacer"),e._v(" "),n("v-col",{attrs:{cols:"1"}},[n("v-btn",{attrs:{disabled:!!o.posa_is_offer||!!o.posa_is_replace,icon:"",color:"indigo lighten-1"},on:{click:function(t){return t.stopPropagation(),e.subtract_one(o)}}},[n("v-icon",[e._v("mdi-minus-circle-outline")])],1)],1),e._v(" "),n("v-col",{attrs:{cols:"1"}},[n("v-btn",{attrs:{disabled:!!o.posa_is_offer||!!o.posa_is_replace,icon:"",color:"indigo lighten-1"},on:{click:function(t){return t.stopPropagation(),e.add_one(o)}}},[n("v-icon",[e._v("mdi-plus-circle-outline")])],1)],1)],1),e._v(" "),n("v-row",{staticClass:"ma-0 pa-0"},[n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Item Code"),"background-color":"white","hide-details":"",disabled:""},model:{value:o.item_code,callback:function(t){e.$set(o,"item_code",t)},expression:"item.item_code"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("QTY"),"background-color":"white","hide-details":"",type:"number",disabled:!!o.posa_is_offer||!!o.posa_is_replace},on:{change:function(t){return e.calc_sotck_gty(o,t)}},model:{value:o.qty,callback:function(t){e.$set(o,"qty",e._n(t))},expression:"item.qty"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-select",{attrs:{dense:"","background-color":"white",label:e.frappe._("UOM"),items:o.item_uoms,outlined:"","item-text":"uom","item-value":"uom","hide-details":"",disabled:!!e.invoice_doc.is_return||!!o.posa_is_offer||!!o.posa_is_replace},on:{change:function(t){return e.calc_uom(o,t)}},model:{value:o.uom,callback:function(t){e.$set(o,"uom",t)},expression:"item.uom"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Rate"),"background-color":"white","hide-details":"",type:"number",prefix:e.invoice_doc.currency,id:"rate",disabled:!!(o.posa_is_offer||o.posa_is_replace||o.posa_offer_applied||!e.pos_profile.posa_allow_user_to_edit_rate||e.invoice_doc.is_return)},on:{change:function(t){return e.calc_prices(o,t)}},model:{value:o.rate,callback:function(t){e.$set(o,"rate",e._n(t))},expression:"item.rate"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Discount Percentage"),"background-color":"white","hide-details":"",type:"number",id:"discount_percentage",disabled:!!(o.posa_is_offer||o.posa_is_replace||o.posa_offer_applied||!e.pos_profile.posa_allow_user_to_edit_item_discount||e.invoice_doc.is_return)},on:{change:function(t){return e.calc_prices(o,t)}},model:{value:o.discount_percentage,callback:function(t){e.$set(o,"discount_percentage",e._n(t))},expression:"item.discount_percentage"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Discount Amount"),"background-color":"white","hide-details":"",type:"number",prefix:e.invoice_doc.currency,id:"discount_amount",disabled:!!(o.posa_is_offer||o.posa_is_replace||o.posa_offer_applied||!e.pos_profile.posa_allow_user_to_edit_item_discount||e.invoice_doc.is_return)},on:{change:function(t){return e.calc_prices(o,t)}},model:{value:o.discount_amount,callback:function(t){e.$set(o,"discount_amount",e._n(t))},expression:"item.discount_amount"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Price list Rate"),"background-color":"white","hide-details":"",type:"number",disabled:"",prefix:e.invoice_doc.currency},model:{value:o.price_list_rate,callback:function(t){e.$set(o,"price_list_rate",t)},expression:"item.price_list_rate"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Available QTY"),"background-color":"white","hide-details":"",type:"number",disabled:""},model:{value:o.actual_qty,callback:function(t){e.$set(o,"actual_qty",t)},expression:"item.actual_qty"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Group"),"background-color":"white","hide-details":"",disabled:""},model:{value:o.item_group,callback:function(t){e.$set(o,"item_group",t)},expression:"item.item_group"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Stock QTY"),"background-color":"white","hide-details":"",type:"number",disabled:""},model:{value:o.stock_qty,callback:function(t){e.$set(o,"stock_qty",t)},expression:"item.stock_qty"}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Stock UOM"),"background-color":"white","hide-details":"",disabled:""},model:{value:o.stock_uom,callback:function(t){e.$set(o,"stock_uom",t)},expression:"item.stock_uom"}})],1),e._v(" "),o.posa_offer_applied?n("v-col",{attrs:{align:"center",cols:"4"}},[n("v-checkbox",{staticClass:"shrink mr-2 mt-0",attrs:{dense:"",label:e.frappe._("Offer Applied"),readonly:"","hide-details":""},model:{value:o.posa_offer_applied,callback:function(t){e.$set(o,"posa_offer_applied",t)},expression:"item.posa_offer_applied"}})],1):e._e(),e._v(" "),1==o.has_serial_no||o.serial_no?n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Serial No QTY"),"background-color":"white","hide-details":"",type:"number",disabled:""},model:{value:o.serial_no_selected_count,callback:function(t){e.$set(o,"serial_no_selected_count",t)},expression:"item.serial_no_selected_count"}})],1):e._e(),e._v(" "),1==o.has_serial_no||o.serial_no?n("v-col",{attrs:{cols:"12"}},[n("v-autocomplete",{attrs:{items:o.serial_no_data,"item-text":"serial_no",outlined:"",dense:"",chips:"",color:"indigo","small-chips":"",label:e.frappe._("Serial No"),multiple:""},on:{change:function(t){return e.set_serial_no(o)}},model:{value:o.serial_no_selected,callback:function(t){e.$set(o,"serial_no_selected",t)},expression:"item.serial_no_selected"}})],1):e._e(),e._v(" "),1==o.has_batch_no||o.batch_no?n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Batch No Available QTY"),"background-color":"white","hide-details":"",type:"number",disabled:""},model:{value:o.actual_batch_qty,callback:function(t){e.$set(o,"actual_batch_qty",t)},expression:"item.actual_batch_qty"}})],1):e._e(),e._v(" "),1==o.has_batch_no||o.batch_no?n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Batch No Expiry Date"),"background-color":"white","hide-details":"",disabled:""},model:{value:o.batch_no_expiry_date,callback:function(t){e.$set(o,"batch_no_expiry_date",t)},expression:"item.batch_no_expiry_date"}})],1):e._e(),e._v(" "),1==o.has_batch_no||o.batch_no?n("v-col",{attrs:{cols:"8"}},[n("v-autocomplete",{attrs:{items:o.batch_no_data,"item-text":"batch_no",outlined:"",dense:"",color:"indigo",label:e.frappe._("Batch No")},on:{change:function(t){return e.set_batch_qty(o,t)}},scopedSlots:e._u([{key:"item",fn:function(t){return[[n("v-list-item-content",[n("v-list-item-title",{domProps:{innerHTML:e._s(t.item.batch_no)}}),e._v(" "),n("v-list-item-subtitle",{domProps:{innerHTML:e._s("Available QTY  '"+t.item.batch_qty+"' - Expiry Date "+t.item.expiry_date)}})],1)]]}}],null,!0),model:{value:o.batch_no,callback:function(t){e.$set(o,"batch_no",t)},expression:"item.batch_no"}})],1):e._e(),e._v(" "),e.pos_profile.posa_allow_sales_order&&"Order"==e.invoiceType?n("v-col",{attrs:{cols:"4"}},[n("v-menu",{ref:"item_delivery_date",attrs:{"close-on-content-click":!1,"return-value":o.posa_delivery_date,transition:"scale-transition",dense:""},on:{"update:returnValue":function(t){return e.$set(o,"posa_delivery_date",t)},"update:return-value":function(t){return e.$set(o,"posa_delivery_date",t)}},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,r=t.attrs;return[n("v-text-field",e._g(e._b({attrs:{label:e.frappe._("Delivery Date"),readonly:"",outlined:"",dense:"",clearable:"",color:"indigo","hide-details":""},model:{value:o.posa_delivery_date,callback:function(t){e.$set(o,"posa_delivery_date",t)},expression:"item.posa_delivery_date"}},"v-text-field",r,!1),i))]}}],null,!0),model:{value:o.item_delivery_date,callback:function(t){e.$set(o,"item_delivery_date",t)},expression:"item.item_delivery_date"}},[e._v(" "),n("v-date-picker",{attrs:{"no-title":"",scrollable:"",color:"indigo",min:e.frappe.datetime.now_date()},model:{value:o.posa_delivery_date,callback:function(t){e.$set(o,"posa_delivery_date",t)},expression:"item.posa_delivery_date"}},[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(e){o.item_delivery_date=!1}}},[e._v("\n                        Cancel\n                      ")]),e._v(" "),n("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){e.$refs.item_delivery_date.save(o.posa_delivery_date),e.validate_due_date(o)}}},[e._v("\n                        OK\n                      ")])],1)],1)],1):e._e(),e._v(" "),e.pos_profile.posa_display_additional_notes?n("v-col",{attrs:{cols:"8"}},[n("v-textarea",{staticClass:"pa-0",attrs:{outlined:"",dense:"",clearable:"",color:"indigo","auto-grow":"",rows:"1",label:e.frappe._("Additional Notes"),value:o.posa_notes},model:{value:o.posa_notes,callback:function(t){e.$set(o,"posa_notes",t)},expression:"item.posa_notes"}})],1):e._e()],1)],1)]}}])})]],2)],1),e._v(" "),n("v-card",{staticClass:"cards mb-0 mt-3 py-0 grey lighten-5"},[n("v-row",{attrs:{"no-gutters":""}},[n("v-col",{attrs:{cols:"7"}},[n("v-row",{staticClass:"pa-1 pt-9 pr-1",attrs:{"no-gutters":""}},[n("v-col",{staticClass:"pa-1",attrs:{cols:"6"}},[n("v-text-field",{attrs:{value:e.formtCurrency(e.total_qty),label:e.frappe._("Total Qty"),outlined:"",dense:"",readonly:"","hide-details":""}})],1),e._v(" "),e.pos_profile.posa_use_percentage_discount?e._e():n("v-col",{staticClass:"pa-1",attrs:{cols:"6"}},[n("v-text-field",{ref:"discount",attrs:{label:e.frappe._("Additional Discount"),outlined:"",dense:"","hide-details":"",type:"number",prefix:e.pos_profile.currency,disabled:!(e.pos_profile.posa_allow_user_to_edit_additional_discount&&!e.discount_percentage_offer_name)},model:{value:e.discount_amount,callback:function(t){e.discount_amount=t},expression:"discount_amount"}})],1),e._v(" "),e.pos_profile.posa_use_percentage_discount?n("v-col",{staticClass:"pa-1",attrs:{cols:"6"}},[n("v-text-field",{ref:"percentage_discount",attrs:{label:e.frappe._("Additional Discount %"),outlined:"",dense:"","hide-details":"",type:"number",disabled:!(e.pos_profile.posa_allow_user_to_edit_additional_discount&&!e.discount_percentage_offer_name)},on:{change:e.update_discount_umount},model:{value:e.additional_discount_percentage,callback:function(t){e.additional_discount_percentage=t},expression:"additional_discount_percentage"}})],1):e._e(),e._v(" "),n("v-col",{staticClass:"pa-1 mt-2",attrs:{cols:"6"}},[n("v-text-field",{attrs:{value:e.formtCurrency(e.total_items_discount_amount),label:e.frappe._("Items Discounts"),outlined:"",dense:"",readonly:"","hide-details":"",prefix:e.pos_profile.currency}})],1),e._v(" "),n("v-col",{staticClass:"pa-1 mt-2",attrs:{cols:"6"}},[n("v-text-field",{staticClass:"text--red",attrs:{value:e.formtCurrency(e.subtotal),label:e.frappe._("Total"),outlined:"",dense:"",readonly:"","hide-details":"",prefix:e.pos_profile.currency}})],1)],1)],1),e._v(" "),n("v-col",{attrs:{cols:"5"}},[n("v-row",{staticClass:"pa-1 pt-2 pl-0",attrs:{"no-gutters":""}},[n("v-col",{staticClass:"pa-1",attrs:{cols:"6"}},[n("v-btn",{staticClass:"pa-0",attrs:{block:"",color:"warning",dark:""},on:{click:e.get_draft_invoices}},[e._v(e._s(e.__("Held")))])],1),e._v(" "),n("v-col",{staticClass:"pa-1",attrs:{cols:"6"}},[n("v-btn",{staticClass:"pa-0",class:{"disable-events":!e.pos_profile.posa_allow_return},attrs:{block:"",color:"info",dark:""},on:{click:e.open_returns}},[e._v(e._s(e.__("Return")))])],1),e._v(" "),n("v-col",{staticClass:"pa-1",attrs:{cols:"6"}},[n("v-btn",{staticClass:"pa-0",attrs:{block:"",color:"error",dark:""},on:{click:function(t){e.cancel_dialog=!0}}},[e._v(e._s(e.__("Cancel")))])],1),e._v(" "),n("v-col",{staticClass:"pa-1",attrs:{cols:"6"}},[n("v-btn",{staticClass:"pa-0",attrs:{block:"",color:"success",dark:""},on:{click:e.new_invoice}},[e._v(e._s(e.__("Save/New")))])],1),e._v(" "),n("v-col",{staticClass:"pa-1",attrs:{cols:"12"}},[n("v-btn",{staticClass:"pa-0",attrs:{block:"",color:"primary",dark:""},on:{click:e.show_payment}},[e._v(e._s(e.__("PAY")))])],1)],1)],1)],1)],1)],1)};f._withStripped=!0;var p=function(e,t,n,i,o,r,s,a){var c,l=("function"==typeof n?n.options:n)||{};if(l.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/Invoice.vue",l.render||(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,o&&(l.functional=!0)),l._scopeId=i,t&&(c=function(e){t.call(this,s(e))}),void 0!==c)if(l.functional){var _=l.render;l.render=function(e,t){return c.call(t),_(e,t)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return l}({render:f,staticRenderFns:[]},function(e){e&&e("data-v-8ce8e520_0",{source:"\n.border_line_bottom[data-v-8ce8e520] {\n  border-bottom: 1px solid lightgray;\n}\n.disable-events[data-v-8ce8e520] {\n  pointer-events: none;\n}\n",map:{version:3,sources:["/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/Invoice.vue"],names:[],mappings:";AA0yEA;EACA,kCAAA;AACA;AACA;EACA,oBAAA;AACA",file:"Invoice.vue",sourcesContent:['<template>\n  <div>\n    <v-dialog v-model="cancel_dialog" max-width="330">\n      <v-card>\n        <v-card-title class="text-h5">\n          {{ __(\'Cancel Current Invoice ?\') }}\n        </v-card-title>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn color="error" @click="cancel_invoice">\n            {{ __(\'Cancel\') }}\n          </v-btn>\n          <v-btn color="primary" @click="cancel_dialog = false">\n            {{ __(\'Back\') }}\n          </v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n    <v-card\n      style="max-height: 70vh; height: 70vh"\n      class="cards my-0 py-0 grey lighten-5"\n    >\n      <v-row align="center" class="items px-2 py-1">\n        <v-col\n          v-if="pos_profile.posa_allow_sales_order"\n          cols="9"\n          class="pb-0 mb-2 pr-0"\n        >\n          <Customer></Customer>\n        </v-col>\n        <v-col\n          v-if="!pos_profile.posa_allow_sales_order"\n          cols="12"\n          class="pb-0 mb-2"\n        >\n          <Customer></Customer>\n        </v-col>\n        <v-col\n          v-if="pos_profile.posa_allow_sales_order"\n          cols="3"\n          class="pb-0 mb-2"\n        >\n          <v-select\n            dense\n            hide-details\n            outlined\n            color="indigo"\n            background-color="white"\n            :items="invoiceTypes"\n            :label="frappe._(\'Type\')"\n            v-model="invoiceType"\n            :disabled="invoiceType == \'Return\'"\n          ></v-select>\n        </v-col>\n      </v-row>\n\n      <div class="my-0 py-0 overflow-y-auto" style="max-height: 60vh">\n        <template @mouseover="style = \'cursor: pointer\'">\n          <v-data-table\n            :headers="items_headers"\n            :items="items"\n            :single-expand="singleExpand"\n            :expanded.sync="expanded"\n            show-expand\n            item-key="posa_row_id"\n            class="elevation-1"\n            :items-per-page="itemsPerPage"\n            hide-default-footer\n          >\n            <template v-slot:item.qty="{ item }">{{\n              formtCurrency(item.qty)\n            }}</template>\n            <template v-slot:item.rate="{ item }">{{\n              formtCurrency(item.rate)\n            }}</template>\n            <template v-slot:item.amount="{ item }">{{\n              formtCurrency(item.qty * item.rate)\n            }}</template>\n            <template v-slot:item.posa_is_offer="{ item }">\n              <v-simple-checkbox\n                :value="!!item.posa_is_offer || !!item.posa_is_replace"\n                disabled\n              ></v-simple-checkbox>\n            </template>\n\n            <template v-slot:expanded-item="{ headers, item }">\n              <td :colspan="headers.length" class="ma-0 pa-0">\n                <v-row class="ma-0 pa-0">\n                  <v-col cols="1">\n                    <v-btn\n                      :disabled="!!item.posa_is_offer || !!item.posa_is_replace"\n                      icon\n                      color="red"\n                      @click.stop="remove_item(item)"\n                    >\n                      <v-icon>mdi-delete</v-icon>\n                    </v-btn>\n                  </v-col>\n                  <v-spacer></v-spacer>\n                  <v-col cols="1">\n                    <v-btn\n                      :disabled="!!item.posa_is_offer || !!item.posa_is_replace"\n                      icon\n                      color="indigo lighten-1"\n                      @click.stop="subtract_one(item)"\n                    >\n                      <v-icon>mdi-minus-circle-outline</v-icon>\n                    </v-btn>\n                  </v-col>\n                  <v-col cols="1">\n                    <v-btn\n                      :disabled="!!item.posa_is_offer || !!item.posa_is_replace"\n                      icon\n                      color="indigo lighten-1"\n                      @click.stop="add_one(item)"\n                    >\n                      <v-icon>mdi-plus-circle-outline</v-icon>\n                    </v-btn>\n                  </v-col>\n                </v-row>\n                <v-row class="ma-0 pa-0">\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Item Code\')"\n                      background-color="white"\n                      hide-details\n                      v-model="item.item_code"\n                      disabled\n                    ></v-text-field>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'QTY\')"\n                      background-color="white"\n                      hide-details\n                      v-model.number="item.qty"\n                      type="number"\n                      @change="calc_sotck_gty(item, $event)"\n                      :disabled="!!item.posa_is_offer || !!item.posa_is_replace"\n                    ></v-text-field>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-select\n                      dense\n                      background-color="white"\n                      :label="frappe._(\'UOM\')"\n                      v-model="item.uom"\n                      :items="item.item_uoms"\n                      outlined\n                      item-text="uom"\n                      item-value="uom"\n                      hide-details\n                      @change="calc_uom(item, $event)"\n                      :disabled="\n                        !!invoice_doc.is_return ||\n                        !!item.posa_is_offer ||\n                        !!item.posa_is_replace\n                      "\n                    >\n                    </v-select>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Rate\')"\n                      background-color="white"\n                      hide-details\n                      v-model.number="item.rate"\n                      type="number"\n                      :prefix="invoice_doc.currency"\n                      @change="calc_prices(item, $event)"\n                      id="rate"\n                      :disabled="\n                        !!item.posa_is_offer ||\n                        !!item.posa_is_replace ||\n                        !!item.posa_offer_applied ||\n                        !pos_profile.posa_allow_user_to_edit_rate ||\n                        !!invoice_doc.is_return\n                          ? true\n                          : false\n                      "\n                    ></v-text-field>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Discount Percentage\')"\n                      background-color="white"\n                      hide-details\n                      v-model.number="item.discount_percentage"\n                      type="number"\n                      @change="calc_prices(item, $event)"\n                      id="discount_percentage"\n                      :disabled="\n                        !!item.posa_is_offer ||\n                        !!item.posa_is_replace ||\n                        item.posa_offer_applied ||\n                        !pos_profile.posa_allow_user_to_edit_item_discount ||\n                        !!invoice_doc.is_return\n                          ? true\n                          : false\n                      "\n                    ></v-text-field>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Discount Amount\')"\n                      background-color="white"\n                      hide-details\n                      v-model.number="item.discount_amount"\n                      type="number"\n                      :prefix="invoice_doc.currency"\n                      @change="calc_prices(item, $event)"\n                      id="discount_amount"\n                      :disabled="\n                        !!item.posa_is_offer ||\n                        !!item.posa_is_replace ||\n                        !!item.posa_offer_applied ||\n                        !pos_profile.posa_allow_user_to_edit_item_discount ||\n                        !!invoice_doc.is_return\n                          ? true\n                          : false\n                      "\n                    ></v-text-field>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Price list Rate\')"\n                      background-color="white"\n                      hide-details\n                      v-model="item.price_list_rate"\n                      type="number"\n                      disabled\n                      :prefix="invoice_doc.currency"\n                    ></v-text-field>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Available QTY\')"\n                      background-color="white"\n                      hide-details\n                      v-model="item.actual_qty"\n                      type="number"\n                      disabled\n                    ></v-text-field>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Group\')"\n                      background-color="white"\n                      hide-details\n                      v-model="item.item_group"\n                      disabled\n                    ></v-text-field>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Stock QTY\')"\n                      background-color="white"\n                      hide-details\n                      v-model="item.stock_qty"\n                      type="number"\n                      disabled\n                    ></v-text-field>\n                  </v-col>\n                  <v-col cols="4">\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Stock UOM\')"\n                      background-color="white"\n                      hide-details\n                      v-model="item.stock_uom"\n                      disabled\n                    ></v-text-field>\n                  </v-col>\n                  <v-col align="center" cols="4" v-if="item.posa_offer_applied">\n                    <v-checkbox\n                      dense\n                      :label="frappe._(\'Offer Applied\')"\n                      v-model="item.posa_offer_applied"\n                      readonly\n                      hide-details\n                      class="shrink mr-2 mt-0"\n                    ></v-checkbox>\n                  </v-col>\n                  <v-col\n                    cols="4"\n                    v-if="item.has_serial_no == 1 || item.serial_no"\n                  >\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Serial No QTY\')"\n                      background-color="white"\n                      hide-details\n                      v-model="item.serial_no_selected_count"\n                      type="number"\n                      disabled\n                    ></v-text-field>\n                  </v-col>\n                  <v-col\n                    cols="12"\n                    v-if="item.has_serial_no == 1 || item.serial_no"\n                  >\n                    <v-autocomplete\n                      v-model="item.serial_no_selected"\n                      :items="item.serial_no_data"\n                      item-text="serial_no"\n                      outlined\n                      dense\n                      chips\n                      color="indigo"\n                      small-chips\n                      :label="frappe._(\'Serial No\')"\n                      multiple\n                      @change="set_serial_no(item)"\n                    ></v-autocomplete>\n                  </v-col>\n                  <v-col\n                    cols="4"\n                    v-if="item.has_batch_no == 1 || item.batch_no"\n                  >\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Batch No Available QTY\')"\n                      background-color="white"\n                      hide-details\n                      v-model="item.actual_batch_qty"\n                      type="number"\n                      disabled\n                    ></v-text-field>\n                  </v-col>\n                  <v-col\n                    cols="4"\n                    v-if="item.has_batch_no == 1 || item.batch_no"\n                  >\n                    <v-text-field\n                      dense\n                      outlined\n                      color="indigo"\n                      :label="frappe._(\'Batch No Expiry Date\')"\n                      background-color="white"\n                      hide-details\n                      v-model="item.batch_no_expiry_date"\n                      disabled\n                    ></v-text-field>\n                  </v-col>\n                  <v-col\n                    cols="8"\n                    v-if="item.has_batch_no == 1 || item.batch_no"\n                  >\n                    <v-autocomplete\n                      v-model="item.batch_no"\n                      :items="item.batch_no_data"\n                      item-text="batch_no"\n                      outlined\n                      dense\n                      color="indigo"\n                      :label="frappe._(\'Batch No\')"\n                      @change="set_batch_qty(item, $event)"\n                    >\n                      <template v-slot:item="data">\n                        <template>\n                          <v-list-item-content>\n                            <v-list-item-title\n                              v-html="data.item.batch_no"\n                            ></v-list-item-title>\n                            <v-list-item-subtitle\n                              v-html="\n                                `Available QTY  \'${data.item.batch_qty}\' - Expiry Date ${data.item.expiry_date}`\n                              "\n                            ></v-list-item-subtitle>\n                          </v-list-item-content>\n                        </template>\n                      </template>\n                    </v-autocomplete>\n                  </v-col>\n                  <v-col\n                    cols="4"\n                    v-if="\n                      pos_profile.posa_allow_sales_order &&\n                      invoiceType == \'Order\'\n                    "\n                  >\n                    <v-menu\n                      ref="item_delivery_date"\n                      v-model="item.item_delivery_date"\n                      :close-on-content-click="false"\n                      :return-value.sync="item.posa_delivery_date"\n                      transition="scale-transition"\n                      dense\n                    >\n                      <template v-slot:activator="{ on, attrs }">\n                        <v-text-field\n                          v-model="item.posa_delivery_date"\n                          :label="frappe._(\'Delivery Date\')"\n                          readonly\n                          outlined\n                          dense\n                          clearable\n                          color="indigo"\n                          hide-details\n                          v-bind="attrs"\n                          v-on="on"\n                        ></v-text-field>\n                      </template>\n                      <v-date-picker\n                        v-model="item.posa_delivery_date"\n                        no-title\n                        scrollable\n                        color="indigo"\n                        :min="frappe.datetime.now_date()"\n                      >\n                        <v-spacer></v-spacer>\n                        <v-btn\n                          text\n                          color="primary"\n                          @click="item.item_delivery_date = false"\n                        >\n                          Cancel\n                        </v-btn>\n                        <v-btn\n                          text\n                          color="primary"\n                          @click="\n                            [\n                              $refs.item_delivery_date.save(\n                                item.posa_delivery_date\n                              ),\n                              validate_due_date(item),\n                            ]\n                          "\n                        >\n                          OK\n                        </v-btn>\n                      </v-date-picker>\n                    </v-menu>\n                  </v-col>\n                  <v-col\n                    cols="8"\n                    v-if="pos_profile.posa_display_additional_notes"\n                  >\n                    <v-textarea\n                      class="pa-0"\n                      outlined\n                      dense\n                      clearable\n                      color="indigo"\n                      auto-grow\n                      rows="1"\n                      :label="frappe._(\'Additional Notes\')"\n                      v-model="item.posa_notes"\n                      :value="item.posa_notes"\n                    ></v-textarea>\n                  </v-col>\n                </v-row>\n              </td>\n            </template>\n          </v-data-table>\n        </template>\n      </div>\n    </v-card>\n    <v-card class="cards mb-0 mt-3 py-0 grey lighten-5">\n      <v-row no-gutters>\n        <v-col cols="7">\n          <v-row no-gutters class="pa-1 pt-9 pr-1">\n            <v-col cols="6" class="pa-1">\n              <v-text-field\n                :value="formtCurrency(total_qty)"\n                :label="frappe._(\'Total Qty\')"\n                outlined\n                dense\n                readonly\n                hide-details\n              ></v-text-field>\n            </v-col>\n            <v-col\n              v-if="!pos_profile.posa_use_percentage_discount"\n              cols="6"\n              class="pa-1"\n            >\n              <v-text-field\n                v-model="discount_amount"\n                :label="frappe._(\'Additional Discount\')"\n                ref="discount"\n                outlined\n                dense\n                hide-details\n                type="number"\n                :prefix="pos_profile.currency"\n                :disabled="\n                  !pos_profile.posa_allow_user_to_edit_additional_discount ||\n                  discount_percentage_offer_name\n                    ? true\n                    : false\n                "\n              ></v-text-field>\n            </v-col>\n            <v-col\n              v-if="pos_profile.posa_use_percentage_discount"\n              cols="6"\n              class="pa-1"\n            >\n              <v-text-field\n                v-model="additional_discount_percentage"\n                :label="frappe._(\'Additional Discount %\')"\n                ref="percentage_discount"\n                outlined\n                dense\n                hide-details\n                type="number"\n                :disabled="\n                  !pos_profile.posa_allow_user_to_edit_additional_discount ||\n                  discount_percentage_offer_name\n                    ? true\n                    : false\n                "\n                @change="update_discount_umount"\n              ></v-text-field>\n            </v-col>\n            <v-col cols="6" class="pa-1 mt-2">\n              <v-text-field\n                :value="formtCurrency(total_items_discount_amount)"\n                :label="frappe._(\'Items Discounts\')"\n                outlined\n                dense\n                readonly\n                hide-details\n                :prefix="pos_profile.currency"\n              ></v-text-field>\n            </v-col>\n\n            <v-col cols="6" class="pa-1 mt-2">\n              <v-text-field\n                :value="formtCurrency(subtotal)"\n                :label="frappe._(\'Total\')"\n                outlined\n                dense\n                readonly\n                hide-details\n                class="text--red"\n                :prefix="pos_profile.currency"\n              ></v-text-field>\n            </v-col>\n          </v-row>\n        </v-col>\n        <v-col cols="5">\n          <v-row no-gutters class="pa-1 pt-2 pl-0">\n            <v-col cols="6" class="pa-1">\n              <v-btn\n                block\n                class="pa-0"\n                color="warning"\n                dark\n                @click="get_draft_invoices"\n                >{{ __(\'Held\') }}</v-btn\n              >\n            </v-col>\n            <v-col cols="6" class="pa-1">\n              <v-btn\n                block\n                class="pa-0"\n                :class="{ \'disable-events\': !pos_profile.posa_allow_return }"\n                color="info"\n                dark\n                @click="open_returns"\n                >{{ __(\'Return\') }}</v-btn\n              >\n            </v-col>\n            <v-col cols="6" class="pa-1">\n              <v-btn\n                block\n                class="pa-0"\n                color="error"\n                dark\n                @click="cancel_dialog = true"\n                >{{ __(\'Cancel\') }}</v-btn\n              >\n            </v-col>\n            <v-col cols="6" class="pa-1">\n              <v-btn\n                block\n                class="pa-0"\n                color="success"\n                dark\n                @click="new_invoice"\n                >{{ __(\'Save/New\') }}</v-btn\n              >\n            </v-col>\n            <v-col cols="12" class="pa-1">\n              <v-btn\n                block\n                class="pa-0"\n                color="primary"\n                @click="show_payment"\n                dark\n                >{{ __(\'PAY\') }}</v-btn\n              >\n            </v-col>\n          </v-row>\n        </v-col>\n      </v-row>\n    </v-card>\n  </div>\n</template>\n\n<script>\nimport { evntBus } from \'../../bus\';\nimport Customer from \'./Customer.vue\';\n\nexport default {\n  data() {\n    return {\n      pos_profile: \'\',\n      pos_opening_shift: \'\',\n      stock_settings: \'\',\n      invoice_doc: \'\',\n      return_doc: \'\',\n      customer: \'\',\n      customer_info: \'\',\n      discount_amount: 0,\n      additional_discount_percentage: 0,\n      total_tax: 0,\n      items: [],\n      posOffers: [],\n      posa_offers: [],\n      posa_coupons: [],\n      allItems: [],\n      discount_percentage_offer_name: null,\n      invoiceTypes: [\'Invoice\', \'Order\'],\n      invoiceType: \'Invoice\',\n      itemsPerPage: 1000,\n      expanded: [],\n      singleExpand: true,\n      cancel_dialog: false,\n      items_headers: [\n        {\n          text: __(\'Name\'),\n          align: \'start\',\n          sortable: true,\n          value: \'item_name\',\n        },\n        { text: __(\'QTY\'), value: \'qty\', align: \'center\' },\n        { text: __(\'UOM\'), value: \'uom\', align: \'center\' },\n        { text: __(\'Rate\'), value: \'rate\', align: \'center\' },\n        { text: __(\'Amount\'), value: \'amount\', align: \'center\' },\n        { text: __(\'is Offer\'), value: \'posa_is_offer\', align: \'center\' },\n      ],\n    };\n  },\n\n  components: {\n    Customer,\n  },\n\n  computed: {\n    total_qty() {\n      this.close_payments();\n      let qty = 0;\n      this.items.forEach((item) => {\n        qty += item.qty;\n      });\n      return flt(qty).toFixed(2);\n    },\n    Total() {\n      let sum = 0;\n      this.items.forEach((item) => {\n        sum += item.qty * item.rate;\n      });\n      return flt(sum).toFixed(2);\n    },\n    subtotal() {\n      this.close_payments();\n      let sum = 0;\n      this.items.forEach((item) => {\n        sum += item.qty * item.rate;\n      });\n      sum -= flt(this.discount_amount);\n      return flt(sum).toFixed(2);\n    },\n    total_items_discount_amount() {\n      let sum = 0;\n      this.items.forEach((item) => {\n        sum += item.qty * item.discount_amount;\n      });\n      return flt(sum).toFixed(2);\n    },\n  },\n\n  methods: {\n    remove_item(item) {\n      const index = this.items.findIndex(\n        (el) => el.posa_row_id == item.posa_row_id\n      );\n      if (index >= 0) {\n        this.items.splice(index, 1);\n      }\n      const idx = this.expanded.findIndex(\n        (el) => el.posa_row_id == item.posa_row_id\n      );\n      if (idx >= 0) {\n        this.expanded.splice(idx, 1);\n      }\n    },\n\n    add_one(item) {\n      item.qty++;\n      if (item.qty == 0) {\n        this.remove_item(item);\n      }\n      this.calc_sotck_gty(item, item.qty);\n      this.$forceUpdate();\n    },\n    subtract_one(item) {\n      item.qty--;\n      if (item.qty == 0) {\n        this.remove_item(item);\n      }\n      this.calc_sotck_gty(item, item.qty);\n      this.$forceUpdate();\n    },\n\n    add_item(item) {\n      if (!item.uom) {\n        item.uom = item.stock_uom;\n      }\n      const index = this.items.findIndex(\n        (el) =>\n          el.item_code === item.item_code &&\n          el.uom === item.uom &&\n          !el.posa_is_offer &&\n          !el.posa_is_replace\n      );\n      if (index === -1) {\n        const new_item = this.get_new_item(item);\n        if (item.has_serial_no && item.to_set_serial_no) {\n          new_item.serial_no_selected = [];\n          new_item.serial_no_selected.push(item.to_set_serial_no);\n          item.to_set_serial_no = null;\n        }\n        this.items.unshift(new_item);\n        this.update_item_detail(new_item);\n      } else {\n        const cur_item = this.items[index];\n        this.update_items_details([cur_item]);\n        if (item.has_serial_no && item.to_set_serial_no) {\n          if (cur_item.serial_no_selected.includes(item.to_set_serial_no)) {\n            evntBus.$emit(\'show_mesage\', {\n              text: __(`This Serial Number {0} has already been added!`, [\n                item.to_set_serial_no,\n              ]),\n              color: \'warning\',\n            });\n            item.to_set_serial_no = null;\n            return;\n          }\n          cur_item.serial_no_selected.push(item.to_set_serial_no);\n          item.to_set_serial_no = null;\n        }\n        if (!cur_item.has_batch_no) {\n          cur_item.qty += item.qty || 1;\n          this.calc_sotck_gty(cur_item, cur_item.qty);\n        } else {\n          if (\n            cur_item.stock_qty < cur_item.actual_batch_qty ||\n            !cur_item.batch_no\n          ) {\n            cur_item.qty += item.qty || 1;\n            this.calc_sotck_gty(cur_item, cur_item.qty);\n          } else {\n            const new_item = this.get_new_item(cur_item);\n            new_item.batch_no = \'\';\n            new_item.batch_no_expiry_date = \'\';\n            new_item.actual_batch_qty = \'\';\n            new_item.qty = item.qty || 1;\n            this.items.unshift(new_item);\n          }\n        }\n        this.set_serial_no(cur_item);\n      }\n      this.$forceUpdate();\n    },\n\n    get_new_item(item) {\n      const new_item = { ...item };\n      if (!item.qty) {\n        item.qty = 1;\n      }\n      if (!item.posa_is_offer) {\n        item.posa_is_offer = 0;\n      }\n      if (!item.posa_is_replace) {\n        item.posa_is_replace = \'\';\n      }\n      new_item.stock_qty = item.qty;\n      new_item.discount_amount = 0;\n      new_item.discount_percentage = 0;\n      new_item.discount_amount_per_item = 0;\n      new_item.price_list_rate = item.rate;\n      new_item.qty = item.qty;\n      new_item.uom = item.uom ? item.uom : item.stock_uom;\n      new_item.actual_batch_qty = \'\';\n      new_item.conversion_factor = 1;\n      new_item.posa_offers = JSON.stringify([]);\n      new_item.posa_offer_applied = 0;\n      new_item.posa_is_offer = item.posa_is_offer;\n      new_item.posa_is_replace = item.posa_is_replace || null;\n      new_item.is_free_item = 0;\n      new_item.posa_notes = \'\';\n      new_item.posa_delivery_date = \'\';\n      new_item.posa_row_id = this.makeid(20);\n      if (\n        (!this.pos_profile.posa_auto_set_batch && new_item.has_batch_no) ||\n        new_item.has_serial_no\n      ) {\n        this.expanded.push(new_item);\n      }\n      return new_item;\n    },\n\n    cancel_invoice() {\n      const doc = this.get_invoice_doc();\n      this.invoiceType = \'Invoice\';\n      this.invoiceTypes = [\'Invoice\', \'Order\'];\n      if (doc.name && this.pos_profile.posa_allow_delete) {\n        frappe.call({\n          method: \'posawesome.posawesome.api.posapp.delete_invoice\',\n          args: { invoice: doc.name },\n          async: true,\n          callback: function (r) {\n            if (r.message) {\n              evntBus.$emit(\'show_mesage\', {\n                text: r.message,\n                color: \'warning\',\n              });\n            }\n          },\n        });\n      }\n      this.items = [];\n      this.posa_offers = [];\n      evntBus.$emit(\'set_pos_coupons\', []);\n      this.posa_coupons = [];\n      this.customer = this.pos_profile.customer;\n      this.invoice_doc = \'\';\n      this.return_doc = \'\';\n      this.discount_amount = 0;\n      this.additional_discount_percentage = 0;\n      evntBus.$emit(\'set_customer_readonly\', false);\n      this.cancel_dialog = false;\n    },\n\n    new_invoice(data = {}) {\n      evntBus.$emit(\'set_customer_readonly\', false);\n      this.expanded = [];\n      this.posa_offers = [];\n      evntBus.$emit(\'set_pos_coupons\', []);\n      this.posa_coupons = [];\n      this.return_doc = \'\';\n      const doc = this.get_invoice_doc();\n      if (doc.name) {\n        this.update_invoice(doc);\n      } else {\n        if (doc.items.length) {\n          this.update_invoice(doc);\n        }\n      }\n      if (!data.name && !data.is_return) {\n        this.items = [];\n        this.customer = this.pos_profile.customer;\n        this.invoice_doc = \'\';\n        this.discount_amount = 0;\n        this.additional_discount_percentage = 0;\n        this.invoiceType = \'Invoice\';\n        this.invoiceTypes = [\'Invoice\', \'Order\'];\n      } else {\n        if (data.is_return) {\n          evntBus.$emit(\'set_customer_readonly\', true);\n          this.invoiceType = \'Return\';\n          this.invoiceTypes = [\'Return\'];\n        }\n        this.invoice_doc = data;\n        this.items = data.items;\n        this.update_items_details(this.items);\n        this.posa_offers = data.posa_offers || [];\n        this.items.forEach((item) => {\n          if (!item.posa_row_id) {\n            item.posa_row_id = this.makeid(20);\n          }\n          if (item.batch_no) {\n            this.set_batch_qty(item, item.batch_no);\n          }\n        });\n        this.customer = data.customer;\n        this.discount_amount = data.discount_amount;\n        this.additional_discount_percentage =\n          data.additional_discount_percentage;\n        this.items.forEach((item) => {\n          if (item.serial_no) {\n            item.serial_no_selected = [];\n            const serial_list = item.serial_no.split(\'\\n\');\n            serial_list.forEach((element) => {\n              if (element.length) {\n                item.serial_no_selected.push(element);\n              }\n            });\n            item.serial_no_selected_count = item.serial_no_selected.length;\n          }\n        });\n      }\n    },\n\n    get_invoice_doc() {\n      let doc = {};\n      if (this.invoice_doc.name) {\n        doc = { ...this.invoice_doc };\n      }\n      doc.doctype = \'Sales Invoice\';\n      doc.is_pos = 1;\n      doc.ignore_pricing_rule = 1;\n      doc.company = doc.company || this.pos_profile.company;\n      doc.pos_profile = doc.pos_profile || this.pos_profile.name;\n      doc.campaign = doc.campaign || this.pos_profile.campaign;\n      doc.currency = doc.currency || this.pos_profile.currency;\n      doc.naming_series = doc.naming_series || this.pos_profile.naming_series;\n      doc.customer = this.customer;\n      doc.items = this.get_invoice_items();\n      doc.total = this.subtotal;\n      doc.discount_amount = flt(this.discount_amount);\n      doc.additional_discount_percentage = flt(\n        this.additional_discount_percentage\n      );\n      doc.posa_pos_opening_shift = this.pos_opening_shift.name;\n      doc.payments = this.get_payments();\n      doc.taxes = [];\n      doc.is_return = this.invoice_doc.is_return;\n      doc.return_against = this.invoice_doc.return_against;\n      doc.posa_offers = this.posa_offers;\n      doc.posa_coupons = this.posa_coupons;\n      return doc;\n    },\n\n    get_invoice_items() {\n      const items_list = [];\n      this.items.forEach((item) => {\n        const new_item = {\n          item_code: item.item_code,\n          posa_row_id: item.posa_row_id,\n          posa_offers: item.posa_offers,\n          posa_offer_applied: item.posa_offer_applied,\n          posa_is_offer: item.posa_is_offer,\n          posa_is_replace: item.posa_is_replace,\n          is_free_item: item.is_free_item,\n          qty: item.qty,\n          rate: item.rate,\n          uom: item.uom,\n          amount: item.qty * item.rate,\n          conversion_factor: item.conversion_factor,\n          serial_no: item.serial_no,\n          discount_percentage: item.discount_percentage,\n          discount_amount: item.discount_amount,\n          batch_no: item.batch_no,\n          posa_notes: item.posa_notes,\n          posa_delivery_date: item.posa_delivery_date,\n          price_list_rate: item.price_list_rate,\n        };\n        items_list.push(new_item);\n      });\n\n      return items_list;\n    },\n\n    get_payments() {\n      const payments = [];\n      this.pos_profile.payments.forEach((payment) => {\n        payments.push({\n          amount: 0,\n          mode_of_payment: payment.mode_of_payment,\n          default: payment.default,\n          account: \'\',\n        });\n      });\n      return payments;\n    },\n\n    update_invoice(doc) {\n      const vm = this;\n      frappe.call({\n        method: \'posawesome.posawesome.api.posapp.update_invoice\',\n        args: {\n          data: doc,\n        },\n        async: false,\n        callback: function (r) {\n          if (r.message) {\n            vm.invoice_doc = r.message;\n          }\n        },\n      });\n      return this.invoice_doc;\n    },\n\n    proces_invoice() {\n      const doc = this.get_invoice_doc();\n      if (doc.name) {\n        return this.update_invoice(doc);\n      } else {\n        return this.update_invoice(doc);\n      }\n    },\n\n    show_payment() {\n      if (!this.customer) {\n        evntBus.$emit(\'show_mesage\', {\n          text: __(`There is no Customer !`),\n          color: \'error\',\n        });\n        return;\n      }\n      if (!this.items.length) {\n        evntBus.$emit(\'show_mesage\', {\n          text: __(`There is no Items !`),\n          color: \'error\',\n        });\n        return;\n      }\n      if (!this.validate()) {\n        return;\n      }\n      evntBus.$emit(\'show_payment\', \'true\');\n      const invoice_doc = this.proces_invoice();\n      evntBus.$emit(\'send_invoice_doc_payment\', invoice_doc);\n    },\n\n    validate() {\n      let value = true;\n      this.items.forEach((item) => {\n        if (this.stock_settings.allow_negative_stock != 1) {\n          if (\n            this.invoiceType == \'Invoice\' &&\n            ((item.is_stock_item && item.stock_qty && !item.actual_qty) ||\n              (item.is_stock_item && item.stock_qty > item.actual_qty))\n          ) {\n            evntBus.$emit(\'show_mesage\', {\n              text: __(\n                `The existing quantity \'{0}\' for item \'{1}\' is not enough`,\n                [item.actual_qty, item.item_name]\n              ),\n              color: \'error\',\n            });\n            value = false;\n          }\n        }\n        if (\n          item.max_discount > 0 &&\n          item.discount_percentage > item.max_discount\n        ) {\n          evntBus.$emit(\'show_mesage\', {\n            text: __(`Maximum discount for Item {0} is {1}%`, [\n              item.item_name,\n              item.max_discount,\n            ]),\n            color: \'error\',\n          });\n          value = false;\n        }\n        if (item.has_serial_no) {\n          if (\n            !this.invoice_doc.is_return &&\n            (!item.serial_no_selected ||\n              item.stock_qty != item.serial_no_selected.length)\n          ) {\n            evntBus.$emit(\'show_mesage\', {\n              text: __(`Selected serial numbers of item {0} is incorrect`, [\n                item.item_name,\n              ]),\n              color: \'error\',\n            });\n            value = false;\n          }\n        }\n        if (item.has_batch_no) {\n          if (item.stock_qty > item.actual_batch_qty) {\n            evntBus.$emit(\'show_mesage\', {\n              text: __(\n                `The existing batch quantity of item {0} is not enough`,\n                [item.item_name]\n              ),\n              color: \'error\',\n            });\n            value = false;\n          }\n        }\n        if (this.pos_profile.posa_allow_user_to_edit_additional_discount) {\n          const clac_percentage = (this.discount_amount / this.Total) * 100;\n          if (clac_percentage > this.pos_profile.posa_max_discount_allowed) {\n            evntBus.$emit(\'show_mesage\', {\n              text: __(`The discount should not be higher than {0}%`, [\n                this.pos_profile.posa_max_discount_allowed,\n              ]),\n              color: \'error\',\n            });\n            value = false;\n          }\n        }\n        if (this.invoice_doc.is_return) {\n          if (this.subtotal >= 0) {\n            evntBus.$emit(\'show_mesage\', {\n              text: __(`Return Invoice Total Not Correct`),\n              color: \'error\',\n            });\n            value = false;\n            return value;\n          }\n          if (this.subtotal * -1 > this.return_doc.total) {\n            evntBus.$emit(\'show_mesage\', {\n              text: __(`Return Invoice Total should not be higher than {0}`, [\n                this.return_doc.total,\n              ]),\n              color: \'error\',\n            });\n            value = false;\n            return value;\n          }\n          this.items.forEach((item) => {\n            const return_item = this.return_doc.items.find(\n              (element) => element.item_code == item.item_code\n            );\n\n            if (!return_item) {\n              evntBus.$emit(\'show_mesage\', {\n                text: __(\n                  `The item {0} cannot be returned because it is not in the invoice {1}`,\n                  [item.item_name, this.return_doc.name]\n                ),\n                color: \'error\',\n              });\n              value = false;\n              return value;\n            } else if (item.qty * -1 > return_item.qty || item.qty >= 0) {\n              evntBus.$emit(\'show_mesage\', {\n                text: __(`The QTY of the item {0} cannot be greater than {1}`, [\n                  item.item_name,\n                  return_item.qty,\n                ]),\n                color: \'error\',\n              });\n              value = false;\n              return value;\n            }\n          });\n        }\n      });\n      return value;\n    },\n\n    get_draft_invoices() {\n      const vm = this;\n      frappe.call({\n        method: \'posawesome.posawesome.api.posapp.get_draft_invoices\',\n        args: {\n          pos_opening_shift: this.pos_opening_shift.name,\n        },\n        async: false,\n        callback: function (r) {\n          if (r.message) {\n            evntBus.$emit(\'open_drafts\', r.message);\n          }\n        },\n      });\n    },\n\n    open_returns() {\n      evntBus.$emit(\'open_returns\', this.pos_profile.company);\n    },\n\n    close_payments() {\n      evntBus.$emit(\'show_payment\', \'false\');\n    },\n\n    update_items_details(items) {\n      if (!items.length > 0) {\n        return;\n      }\n      const vm = this;\n      if (!vm.pos_profile) return;\n      frappe.call({\n        method: \'posawesome.posawesome.api.posapp.get_items_details\',\n        async: false,\n        args: {\n          pos_profile: vm.pos_profile,\n          items_data: items,\n        },\n        callback: function (r) {\n          if (r.message) {\n            items.forEach((item) => {\n              const updated_item = r.message.find(\n                (element) => element.posa_row_id == item.posa_row_id\n              );\n              item.actual_qty = updated_item.actual_qty;\n              item.serial_no_data = updated_item.serial_no_data;\n              item.batch_no_data = updated_item.batch_no_data;\n              item.item_uoms = updated_item.item_uoms;\n              item.has_batch_no = updated_item.has_batch_no;\n              item.has_serial_no = updated_item.has_serial_no;\n            });\n          }\n        },\n      });\n    },\n\n    update_item_detail(item) {\n      const vm = this;\n      frappe.call({\n        method: \'posawesome.posawesome.api.posapp.get_item_detail\',\n        args: {\n          warehouse: this.pos_profile.warehouse,\n          doc: this.get_invoice_doc(),\n          price_list: this.pos_profile.price_list,\n          item: {\n            item_code: item.item_code,\n            customer: this.customer,\n            doctype: \'Sales Invoice\',\n            name: \'New Sales Invoice 1\',\n            company: this.pos_profile.company,\n            conversion_rate: 1,\n            qty: item.qty,\n            price_list_rate: item.price_list_rate,\n            child_docname: \'New Sales Invoice Item 1\',\n            cost_center: this.pos_profile.cost_center,\n            currency: this.pos_profile.currency,\n            // plc_conversion_rate: 1,\n            pos_profile: this.pos_profile.name,\n            price_list: this.pos_profile.selling_price_list,\n            uom: item.uom,\n            tax_category: \'\',\n            transaction_type: \'selling\',\n            update_stock: this.pos_profile.update_stock,\n            price_list: this.get_price_list(),\n            has_batch_no: item.has_batch_no,\n            serial_no: item.serial_no,\n            batch_no: item.batch_no,\n            is_stock_item: item.is_stock_item,\n          },\n        },\n        callback: function (r) {\n          if (r.message) {\n            const data = r.message;\n            if (\n              item.has_batch_no &&\n              vm.pos_profile.posa_auto_set_batch &&\n              !item.batch_no &&\n              data.batch_no\n            ) {\n              item.batch_no = data.batch_no;\n              vm.set_batch_qty(item, item.batch_no, false);\n            }\n            if (data.has_pricing_rule) {\n            } else if (\n              vm.pos_profile.posa_apply_customer_discount &&\n              vm.customer_info.posa_discount > 0 &&\n              vm.customer_info.posa_discount <= 100\n            ) {\n              if (\n                item.posa_is_offer == 0 &&\n                !item.posa_is_replace &&\n                item.posa_offer_applied == 0\n              ) {\n                if (item.max_discount > 0) {\n                  item.discount_percentage =\n                    item.max_discount < vm.customer_info.posa_discount\n                      ? item.max_discount\n                      : vm.customer_info.posa_discount;\n                } else {\n                  item.discount_percentage = vm.customer_info.posa_discount;\n                }\n              }\n            }\n            if (!item.btach_price) {\n              if (\n                !item.is_free_item &&\n                !item.posa_is_offer &&\n                !item.posa_is_replace\n              ) {\n                item.price_list_rate = data.price_list_rate;\n              }\n            }\n            item.last_purchase_rate = data.last_purchase_rate;\n            item.projected_qty = data.projected_qty;\n            item.reserved_qty = data.reserved_qty;\n            item.conversion_factor = data.conversion_factor;\n            item.stock_qty = data.stock_qty;\n            item.actual_qty = data.actual_qty;\n            item.stock_uom = data.stock_uom;\n            (item.has_serial_no = data.has_serial_no),\n              (item.has_batch_no = data.has_batch_no),\n              vm.calc_item_price(item);\n          }\n        },\n      });\n    },\n\n    fetch_customer_details() {\n      const vm = this;\n      if (this.customer) {\n        frappe.call({\n          method: \'posawesome.posawesome.api.posapp.get_customer_info\',\n          args: {\n            customer: vm.customer,\n          },\n          async: false,\n          callback: (r) => {\n            const message = r.message;\n            if (!r.exc) {\n              vm.customer_info = {\n                ...message,\n              };\n            }\n            vm.update_price_list();\n          },\n        });\n      }\n    },\n\n    get_price_list() {\n      let price_list = this.pos_profile.selling_price_list;\n      if (this.customer_info && this.pos_profile) {\n        const { customer_price_list, customer_group_price_list } =\n          this.customer_info;\n        const pos_price_list = this.pos_profile.selling_price_list;\n        if (customer_price_list && customer_price_list != pos_price_list) {\n          price_list = customer_price_list;\n        } else if (\n          customer_group_price_list &&\n          customer_group_price_list != pos_price_list\n        ) {\n          price_list = customer_group_price_list;\n        }\n      }\n      return price_list;\n    },\n\n    update_price_list() {\n      let price_list = this.get_price_list();\n      if (price_list == this.pos_profile.selling_price_list) {\n        price_list = null;\n      }\n      evntBus.$emit(\'update_customer_price_list\', price_list);\n    },\n    update_discount_umount() {\n      const value = flt(this.additional_discount_percentage);\n      if (value >= -100 && value <= 100) {\n        this.discount_amount = (this.Total * value) / 100;\n      } else {\n        this.additional_discount_percentage = 0;\n        this.discount_amount = 0;\n      }\n    },\n\n    calc_prices(item, value, $event) {\n      if (event.target.id === \'rate\') {\n        item.discount_percentage = 0;\n        if (value < item.price_list_rate) {\n          item.discount_amount = (\n            flt(item.price_list_rate) - flt(value)\n          ).toFixed(2);\n        } else if (value < 0) {\n          item.rate = item.price_list_rate;\n          item.discount_amount = 0;\n        } else if (value > item.price_list_rate) {\n          item.discount_amount = 0;\n        }\n      } else if (event.target.id === \'discount_amount\') {\n        if (value < 0) {\n          item.discount_amount = 0;\n          item.discount_percentage = 0;\n        } else {\n          item.rate = flt(item.price_list_rate) - flt(value);\n          item.discount_percentage = 0;\n        }\n      } else if (event.target.id === \'discount_percentage\') {\n        if (value < 0) {\n          item.discount_amount = 0;\n          item.discount_percentage = 0;\n        } else {\n          item.rate = (\n            flt(item.price_list_rate) -\n            (flt(item.price_list_rate) * flt(value)) / 100\n          ).toFixed(2);\n          item.discount_amount = (\n            flt(item.price_list_rate) - flt(item.rate)\n          ).toFixed(2);\n        }\n      }\n    },\n\n    calc_item_price(item) {\n      if (!item.posa_offer_applied) {\n        if (item.price_list_rate) {\n          item.rate = item.price_list_rate;\n        }\n      }\n      if (item.discount_percentage) {\n        item.rate =\n          flt(item.price_list_rate) -\n          (flt(item.price_list_rate) * flt(item.discount_percentage)) / 100;\n        item.discount_amount = (\n          flt(item.price_list_rate) - flt(item.rate)\n        ).toFixed(2);\n      } else if (item.discount_amount) {\n        item.rate = (\n          flt(item.price_list_rate) - flt(item.discount_amount)\n        ).toFixed(2);\n      }\n    },\n\n    calc_uom(item, value) {\n      const new_uom = item.item_uoms.find((element) => element.uom == value);\n      item.conversion_factor = new_uom.conversion_factor;\n      if (!item.posa_offer_applied) {\n        item.discount_amount = 0;\n        item.discount_percentage = 0;\n      }\n      if (item.btach_price) {\n        item.price_list_rate = item.btach_price * new_uom.conversion_factor;\n      }\n      this.update_item_detail(item);\n    },\n\n    calc_sotck_gty(item, value) {\n      item.stock_qty = item.conversion_factor * value;\n    },\n\n    set_serial_no(item) {\n      if (!item.has_serial_no) return;\n      item.serial_no = \'\';\n      item.serial_no_selected.forEach((element) => {\n        item.serial_no += element + \'\\n\';\n      });\n      item.serial_no_selected_count = item.serial_no_selected.length;\n      if (item.serial_no_selected_count != item.stock_qty) {\n        evntBus.$emit(\'show_mesage\', {\n          text: __(`Selected Serial No QTY is {0} it should be {1}`, [\n            item.serial_no_selected_count,\n            item.stock_qty,\n          ]),\n          color: \'warning\',\n        });\n      }\n    },\n\n    set_batch_qty(item, value, update = true) {\n      const batch_no = item.batch_no_data.find(\n        (element) => element.batch_no == value\n      );\n      item.actual_batch_qty = batch_no.batch_qty;\n      item.batch_no_expiry_date = batch_no.expiry_date;\n      if (batch_no.btach_price) {\n        item.btach_price = batch_no.btach_price;\n        item.price_list_rate = batch_no.btach_price;\n        item.rate = batch_no.btach_price;\n      } else if (update) {\n        item.btach_price = null;\n        this.update_item_detail(item);\n      }\n    },\n\n    formtCurrency(value) {\n      value = parseFloat(value);\n      return value.toFixed(2).replace(/\\d(?=(\\d{3})+\\.)/g, \'$&,\');\n    },\n\n    shortOpenPayment(e) {\n      if (e.key === \'s\' && (e.ctrlKey || e.metaKey)) {\n        e.preventDefault();\n        this.show_payment();\n      }\n    },\n\n    shortDeleteFirstItem(e) {\n      if (e.key === \'d\' && (e.ctrlKey || e.metaKey)) {\n        e.preventDefault();\n        this.remove_item(this.items[0]);\n      }\n    },\n\n    shortOpenFirstItem(e) {\n      if (e.key === \'a\' && (e.ctrlKey || e.metaKey)) {\n        e.preventDefault();\n        this.expanded = [];\n        this.expanded.push(this.items[0]);\n      }\n    },\n\n    shortSelectDiscount(e) {\n      if (e.key === \'z\' && (e.ctrlKey || e.metaKey)) {\n        e.preventDefault();\n        this.$refs.discount.focus();\n      }\n    },\n\n    makeid(length) {\n      let result = \'\';\n      const characters = \'abcdefghijklmnopqrstuvwxyz0123456789\';\n      const charactersLength = characters.length;\n      for (var i = 0; i < length; i++) {\n        result += characters.charAt(\n          Math.floor(Math.random() * charactersLength)\n        );\n      }\n      return result;\n    },\n\n    checkOfferIsAppley(item, offer) {\n      let applied = false;\n      const item_offers = JSON.parse(item.posa_offers);\n      for (const row_id of item_offers) {\n        const exist_offer = this.posa_offers.find((el) => row_id == el.row_id);\n        if (exist_offer && exist_offer.offer_name == offer.name) {\n          applied = true;\n          break;\n        }\n      }\n      return applied;\n    },\n\n    handelOffers() {\n      const offers = [];\n      this.posOffers.forEach((offer) => {\n        if (offer.apply_on === \'Item Code\') {\n          const itemOffer = this.getItemOffer(offer);\n          if (itemOffer) {\n            offers.push(itemOffer);\n          }\n        } else if (offer.apply_on === \'Item Group\') {\n          const groupOffer = this.getGroupOffer(offer);\n          if (groupOffer) {\n            offers.push(groupOffer);\n          }\n        } else if (offer.apply_on === \'Brand\') {\n          const brandOffer = this.getBrandOffer(offer);\n          if (brandOffer) {\n            offers.push(brandOffer);\n          }\n        } else if (offer.apply_on === \'Transaction\') {\n          const transactionOffer = this.getTransactionOffer(offer);\n          if (transactionOffer) {\n            offers.push(transactionOffer);\n          }\n        }\n      });\n\n      this.setItemGiveOffer(offers);\n      this.updatePosOffers(offers);\n    },\n\n    setItemGiveOffer(offers) {\n      // Set item give offer for replace\n      offers.forEach((offer) => {\n        if (\n          offer.apply_on == \'Item Code\' &&\n          offer.apply_type == \'Item Code\' &&\n          offer.replace_item\n        ) {\n          offer.give_item = offer.item;\n          offer.apply_item_code = offer.item;\n        } else if (\n          offer.apply_on == \'Item Group\' &&\n          offer.apply_type == \'Item Group\' &&\n          offer.replace_cheapest_item\n        ) {\n          const offerItemCode = this.getCheapestItem(offer).item_code;\n          offer.give_item = offerItemCode;\n          offer.apply_item_code = offerItemCode;\n        }\n      });\n    },\n\n    getCheapestItem(offer) {\n      let itemsRowID;\n      if (typeof offer.items === \'string\') {\n        itemsRowID = JSON.parse(offer.items);\n      } else {\n        itemsRowID = offer.items;\n      }\n      const itemsList = [];\n      itemsRowID.forEach((row_id) => {\n        itemsList.push(this.getItemFromRowID(row_id));\n      });\n      const result = itemsList.reduce(function (res, obj) {\n        return !obj.posa_is_replace &&\n          !obj.posa_is_offer &&\n          obj.price_list_rate < res.price_list_rate\n          ? obj\n          : res;\n      });\n      return result;\n    },\n\n    getItemFromRowID(row_id) {\n      const item = this.items.find((el) => el.posa_row_id == row_id);\n      return item;\n    },\n\n    checkQtyAnountOffer(offer, qty, amount) {\n      let min_qty = false;\n      let max_qty = false;\n      let min_amt = false;\n      let max_amt = false;\n      const applys = [];\n\n      if (offer.min_qty || offer.min_qty == 0) {\n        if (qty >= offer.min_qty) {\n          min_qty = true;\n        }\n        applys.push(min_qty);\n      }\n\n      if (offer.max_qty > 0) {\n        if (qty <= offer.max_qty) {\n          max_qty = true;\n        }\n        applys.push(max_qty);\n      }\n\n      if (offer.min_amt > 0) {\n        if (amount >= offer.min_amt) {\n          min_amt = true;\n        }\n        applys.push(min_amt);\n      }\n\n      if (offer.max_amt > 0) {\n        if (amount <= offer.max_amt) {\n          max_amt = true;\n        }\n        applys.push(max_amt);\n      }\n      let apply = false;\n      if (!applys.includes(false)) {\n        apply = true;\n      }\n      const res = {\n        apply: apply,\n        conditions: { min_qty, max_qty, min_amt, max_amt },\n      };\n      return res;\n    },\n\n    checkOfferCoupon(offer) {\n      if (offer.coupon_based) {\n        const coupon = this.posa_coupons.find(\n          (el) => offer.name == el.pos_offer\n        );\n        if (coupon) {\n          offer.coupon = coupon.coupon;\n          return true;\n        } else {\n          return false;\n        }\n      } else {\n        offer.coupon = null;\n        return true;\n      }\n    },\n\n    getItemOffer(offer) {\n      let apply_offer = null;\n      if (offer.apply_on === \'Item Code\') {\n        if (this.checkOfferCoupon(offer)) {\n          this.items.forEach((item) => {\n            if (!item.posa_is_offer && item.item_code === offer.item) {\n              const items = [];\n              if (\n                offer.offer === \'Item Price\' &&\n                item.posa_offer_applied &&\n                !this.checkOfferIsAppley(item, offer)\n              ) {\n              } else {\n                const res = this.checkQtyAnountOffer(\n                  offer,\n                  item.stock_qty,\n                  item.stock_qty * item.price_list_rate\n                );\n                if (res.apply) {\n                  items.push(item.posa_row_id);\n                  offer.items = items;\n                  apply_offer = offer;\n                }\n              }\n            }\n          });\n        }\n      }\n      return apply_offer;\n    },\n\n    getGroupOffer(offer) {\n      let apply_offer = null;\n      if (offer.apply_on === \'Item Group\') {\n        if (this.checkOfferCoupon(offer)) {\n          const items = [];\n          let total_count = 0;\n          let total_amount = 0;\n          this.items.forEach((item) => {\n            if (!item.posa_is_offer && item.item_group === offer.item_group) {\n              if (\n                offer.offer === \'Item Price\' &&\n                item.posa_offer_applied &&\n                !this.checkOfferIsAppley(item, offer)\n              ) {\n              } else {\n                total_count += item.stock_qty;\n                total_amount += item.stock_qty * item.price_list_rate;\n                items.push(item.posa_row_id);\n              }\n            }\n          });\n          if (total_count || total_amount) {\n            const res = this.checkQtyAnountOffer(\n              offer,\n              total_count,\n              total_amount\n            );\n            if (res.apply) {\n              offer.items = items;\n              apply_offer = offer;\n            }\n          }\n        }\n      }\n      return apply_offer;\n    },\n\n    getBrandOffer(offer) {\n      let apply_offer = null;\n      if (offer.apply_on === \'Brand\') {\n        if (this.checkOfferCoupon(offer)) {\n          const items = [];\n          let total_count = 0;\n          let total_amount = 0;\n          this.items.forEach((item) => {\n            if (!item.posa_is_offer && item.brand === offer.brand) {\n              if (\n                offer.offer === \'Item Price\' &&\n                item.posa_offer_applied &&\n                !this.checkOfferIsAppley(item, offer)\n              ) {\n              } else {\n                total_count += item.stock_qty;\n                total_amount += item.stock_qty * item.price_list_rate;\n                items.push(item.posa_row_id);\n              }\n            }\n          });\n          if (total_count || total_amount) {\n            const res = this.checkQtyAnountOffer(\n              offer,\n              total_count,\n              total_amount\n            );\n            if (res.apply) {\n              offer.items = items;\n              apply_offer = offer;\n            }\n          }\n        }\n      }\n      return apply_offer;\n    },\n    getTransactionOffer(offer) {\n      let apply_offer = null;\n      if (offer.apply_on === \'Transaction\') {\n        if (this.checkOfferCoupon(offer)) {\n          let total_qty = 0;\n          this.items.forEach((item) => {\n            if (!item.posa_is_offer && !item.posa_is_replace) {\n              total_qty += item.stock_qty;\n            }\n          });\n          const items = [];\n          const total_count = total_qty;\n          const total_amount = this.Total;\n          if (total_count || total_amount) {\n            const res = this.checkQtyAnountOffer(\n              offer,\n              total_count,\n              total_amount\n            );\n            if (res.apply) {\n              this.items.forEach((item) => {\n                items.push(item.posa_row_id);\n              });\n              offer.items = items;\n              apply_offer = offer;\n            }\n          }\n        }\n      }\n      return apply_offer;\n    },\n\n    updatePosOffers(offers) {\n      evntBus.$emit(\'update_pos_offers\', offers);\n    },\n\n    updateInvoiceOffers(offers) {\n      this.posa_offers.forEach((invoiceOffer) => {\n        const existOffer = offers.find(\n          (offer) => invoiceOffer.row_id == offer.row_id\n        );\n        if (!existOffer) {\n          this.removeApplyOffer(invoiceOffer);\n        }\n      });\n      offers.forEach((offer) => {\n        const existOffer = this.posa_offers.find(\n          (invoiceOffer) => invoiceOffer.row_id == offer.row_id\n        );\n        if (existOffer) {\n          existOffer.items = JSON.stringify(offer.items);\n          if (\n            existOffer.offer === \'Give Product\' &&\n            existOffer.give_item &&\n            existOffer.give_item != offer.give_item\n          ) {\n            const item_to_remove = this.items.find(\n              (item) => item.posa_row_id == existOffer.give_item_row_id\n            );\n            if (item_to_remove) {\n              const updated_item_offers = offer.items.filter(\n                (row_id) => row_id != item_to_remove.posa_row_id\n              );\n              offer.items = updated_item_offers;\n              this.remove_item(item_to_remove);\n              existOffer.give_item_row_id = null;\n              existOffer.give_item = null;\n            }\n            const newItemOffer = this.ApplyOnGiveProduct(offer);\n            if (offer.replace_cheapest_item) {\n              const cheapestItem = this.getCheapestItem(offer);\n              const oldBaseItem = this.items.find(\n                (el) => el.posa_row_id == item_to_remove.posa_is_replace\n              );\n              newItemOffer.qty = item_to_remove.qty;\n              if (oldBaseItem && !oldBaseItem.posa_is_replace) {\n                oldBaseItem.qty += item_to_remove.qty;\n              } else {\n                const restoredItem = this.ApplyOnGiveProduct(\n                  {\n                    given_qty: item_to_remove.qty,\n                  },\n                  item_to_remove.item_code\n                );\n                restoredItem.posa_is_offer = 0;\n                this.items.unshift(restoredItem);\n              }\n              newItemOffer.posa_is_offer = 0;\n              newItemOffer.posa_is_replace = cheapestItem.posa_row_id;\n              const diffQty = cheapestItem.qty - newItemOffer.qty;\n              if (diffQty <= 0) {\n                newItemOffer.qty += diffQty;\n                this.remove_item(cheapestItem);\n                newItemOffer.posa_row_id = cheapestItem.posa_row_id;\n                newItemOffer.posa_is_replace = newItemOffer.posa_row_id;\n              } else {\n                cheapestItem.qty = diffQty;\n              }\n            }\n            this.items.unshift(newItemOffer);\n            existOffer.give_item_row_id = newItemOffer.posa_row_id;\n            existOffer.give_item = newItemOffer.item_code;\n          } else if (\n            existOffer.offer === \'Give Product\' &&\n            existOffer.give_item &&\n            existOffer.give_item == offer.give_item &&\n            (offer.replace_item || offer.replace_cheapest_item)\n          ) {\n            this.$nextTick(function () {\n              const offerItem = this.getItemFromRowID(\n                existOffer.give_item_row_id\n              );\n              const diff = offer.given_qty - offerItem.qty;\n              if (diff > 0) {\n                const itemsRowID = JSON.parse(existOffer.items);\n                const itemsList = [];\n                itemsRowID.forEach((row_id) => {\n                  itemsList.push(this.getItemFromRowID(row_id));\n                });\n                const existItem = itemsList.find(\n                  (el) =>\n                    el.item_code == offerItem.item_code &&\n                    el.posa_is_replace != offerItem.posa_row_id\n                );\n                if (existItem) {\n                  const diffExistQty = existItem.qty - diff;\n                  if (diffExistQty > 0) {\n                    offerItem.qty += diff;\n                    existItem.qty -= diff;\n                  } else {\n                    offerItem.qty += existItem.qty;\n                    this.remove_item(existItem);\n                  }\n                }\n              }\n            });\n          } else if (existOffer.offer === \'Item Price\') {\n            this.ApplyOnPrice(offer);\n          } else if (existOffer.offer === \'Grand Total\') {\n            this.ApplyOnTotal(offer);\n          }\n          this.addOfferToItems(existOffer);\n        } else {\n          this.applyNewOffer(offer);\n        }\n      });\n    },\n\n    removeApplyOffer(invoiceOffer) {\n      if (invoiceOffer.offer === \'Item Price\') {\n        this.RemoveOnPrice(invoiceOffer);\n        const index = this.posa_offers.findIndex(\n          (el) => el.row_id === invoiceOffer.row_id\n        );\n        this.posa_offers.splice(index, 1);\n      }\n      if (invoiceOffer.offer === \'Give Product\') {\n        const item_to_remove = this.items.find(\n          (item) => item.posa_row_id == invoiceOffer.give_item_row_id\n        );\n        const index = this.posa_offers.findIndex(\n          (el) => el.row_id === invoiceOffer.row_id\n        );\n        this.posa_offers.splice(index, 1);\n        this.remove_item(item_to_remove);\n      }\n      if (invoiceOffer.offer === \'Grand Total\') {\n        this.RemoveOnTotal(invoiceOffer);\n        const index = this.posa_offers.findIndex(\n          (el) => el.row_id === invoiceOffer.row_id\n        );\n        this.posa_offers.splice(index, 1);\n      }\n      if (invoiceOffer.offer === \'Loyalty Point\') {\n        const index = this.posa_offers.findIndex(\n          (el) => el.row_id === invoiceOffer.row_id\n        );\n        this.posa_offers.splice(index, 1);\n      }\n      this.deleteOfferFromItems(invoiceOffer);\n    },\n\n    applyNewOffer(offer) {\n      if (offer.offer === \'Item Price\') {\n        this.ApplyOnPrice(offer);\n      }\n      if (offer.offer === \'Give Product\') {\n        let itemsRowID;\n        if (typeof offer.items === \'string\') {\n          itemsRowID = JSON.parse(offer.items);\n        } else {\n          itemsRowID = offer.items;\n        }\n        if (\n          offer.apply_on == \'Item Code\' &&\n          offer.apply_type == \'Item Code\' &&\n          offer.replace_item\n        ) {\n          const item = this.ApplyOnGiveProduct(offer, offer.item);\n          item.posa_is_replace = itemsRowID[0];\n          const baseItem = this.items.find(\n            (el) => el.posa_row_id == item.posa_is_replace\n          );\n          const diffQty = baseItem.qty - offer.given_qty;\n          item.posa_is_offer = 0;\n          if (diffQty <= 0) {\n            item.qty = baseItem.qty;\n            this.remove_item(baseItem);\n            item.posa_row_id = item.posa_is_replace;\n          } else {\n            baseItem.qty = diffQty;\n          }\n          this.items.unshift(item);\n          offer.give_item_row_id = item.posa_row_id;\n        } else if (\n          offer.apply_on == \'Item Group\' &&\n          offer.apply_type == \'Item Group\' &&\n          offer.replace_cheapest_item\n        ) {\n          const itemsList = [];\n          itemsRowID.forEach((row_id) => {\n            itemsList.push(this.getItemFromRowID(row_id));\n          });\n          const baseItem = itemsList.find(\n            (el) => el.item_code == offer.give_item\n          );\n          const item = this.ApplyOnGiveProduct(offer, offer.give_item);\n          item.posa_is_offer = 0;\n          item.posa_is_replace = baseItem.posa_row_id;\n          const diffQty = baseItem.qty - offer.given_qty;\n          if (diffQty <= 0) {\n            item.qty = baseItem.qty;\n            this.remove_item(baseItem);\n            item.posa_row_id = item.posa_is_replace;\n          } else {\n            baseItem.qty = diffQty;\n          }\n          this.items.unshift(item);\n          offer.give_item_row_id = item.posa_row_id;\n        } else {\n          const item = this.ApplyOnGiveProduct(offer);\n          this.items.unshift(item);\n          if (item) {\n            offer.give_item_row_id = item.posa_row_id;\n          }\n        }\n      }\n      if (offer.offer === \'Grand Total\') {\n        this.ApplyOnTotal(offer);\n      }\n      if (offer.offer === \'Loyalty Point\') {\n        evntBus.$emit(\'show_mesage\', {\n          text: __(\'Loyalty Point Offer Applied\'),\n          color: \'success\',\n        });\n      }\n\n      const newOffer = {\n        offer_name: offer.name,\n        row_id: offer.row_id,\n        apply_on: offer.apply_on,\n        offer: offer.offer,\n        items: JSON.stringify(offer.items),\n        give_item: offer.give_item,\n        give_item_row_id: offer.give_item_row_id,\n        offer_applied: offer.offer_applied,\n        coupon_based: offer.coupon_based,\n        coupon: offer.coupon,\n      };\n      this.posa_offers.push(newOffer);\n      this.addOfferToItems(newOffer);\n    },\n\n    ApplyOnGiveProduct(offer, item_code) {\n      if (!item_code) {\n        item_code = offer.give_item;\n      }\n      const items = this.allItems;\n      const item = items.find((item) => item.item_code == item_code);\n      if (!item) {\n        return;\n      }\n      const new_item = { ...item };\n      new_item.qty = offer.given_qty;\n      new_item.stock_qty = offer.given_qty;\n      new_item.rate = offer.discount_type === \'Rate\' ? offer.rate : item.rate;\n      new_item.discount_amount =\n        offer.discount_type === \'Discount Amount\' ? offer.discount_amount : 0;\n      new_item.discount_percentage =\n        offer.discount_type === \'Discount Percentage\'\n          ? offer.discount_percentage\n          : 0;\n      new_item.discount_amount_per_item = 0;\n      new_item.uom = item.uom ? item.uom : item.stock_uom;\n      new_item.actual_batch_qty = \'\';\n      new_item.conversion_factor = 1;\n      new_item.posa_offers = JSON.stringify([]);\n      new_item.posa_offer_applied = 0;\n      new_item.posa_is_offer = 1;\n      new_item.posa_is_replace = null;\n      new_item.posa_notes = \'\';\n      new_item.posa_delivery_date = \'\';\n      new_item.is_free_item =\n        (offer.discount_type === \'Rate\' && !offer.rate) ||\n        (offer.discount_type === \'Discount Percentage\' &&\n          offer.discount_percentage == 0)\n          ? 1\n          : 0;\n      new_item.posa_row_id = this.makeid(20);\n      new_item.price_list_rate =\n        (offer.discount_type === \'Rate\' && !offer.rate) ||\n        (offer.discount_type === \'Discount Percentage\' &&\n          offer.discount_percentage == 0)\n          ? 0\n          : item.rate;\n      if (\n        (!this.pos_profile.posa_auto_set_batch && new_item.has_batch_no) ||\n        new_item.has_serial_no\n      ) {\n        this.expanded.push(new_item);\n      }\n      this.update_item_detail(new_item);\n      return new_item;\n    },\n\n    ApplyOnPrice(offer) {\n      this.items.forEach((item) => {\n        if (offer.items.includes(item.posa_row_id)) {\n          const item_offers = JSON.parse(item.posa_offers);\n          if (!item_offers.includes(offer.row_id)) {\n            if (offer.discount_type === \'Rate\') {\n              item.rate = offer.rate;\n            } else if (offer.discount_type === \'Discount Percentage\') {\n              item.discount_percentage += offer.discount_percentage;\n            } else if (offer.discount_type === \'Discount Amount\') {\n              item.discount_amount += offer.discount_amount;\n            }\n            item.posa_offer_applied = 1;\n            this.calc_item_price(item);\n          }\n        }\n      });\n    },\n\n    RemoveOnPrice(offer) {\n      this.items.forEach((item) => {\n        const item_offers = JSON.parse(item.posa_offers);\n        if (item_offers.includes(offer.row_id)) {\n          const originalOffer = this.posOffers.find(\n            (el) => el.name == offer.offer_name\n          );\n          if (originalOffer) {\n            if (originalOffer.discount_type === \'Rate\') {\n              item.rate = item.price_list_rate;\n            } else if (originalOffer.discount_type === \'Discount Percentage\') {\n              item.discount_percentage -= offer.discount_percentage;\n              if (!item.discount_percentage) {\n                item.discount_percentage = 0;\n                item.discount_amount = 0;\n                item.rate = item.price_list_rate;\n              }\n            } else if (originalOffer.discount_type === \'Discount Amount\') {\n              item.discount_amount -= offer.discount_amount;\n            }\n            this.calc_item_price(item);\n          }\n        }\n      });\n    },\n\n    ApplyOnTotal(offer) {\n      if (!offer.name) {\n        offer = this.posOffers.find((el) => el.name == offer.offer_name);\n      }\n      if (\n        (!this.discount_percentage_offer_name ||\n          this.discount_percentage_offer_name == offer.name) &&\n        offer.discount_percentage > 0 &&\n        offer.discount_percentage <= 100\n      ) {\n        this.discount_amount = (\n          (flt(this.Total) * flt(offer.discount_percentage)) /\n          100\n        ).toFixed(2);\n        this.discount_percentage_offer_name = offer.name;\n      }\n    },\n\n    RemoveOnTotal(offer) {\n      if (\n        this.discount_percentage_offer_name &&\n        this.discount_percentage_offer_name == offer.offer_name\n      ) {\n        this.discount_amount = 0;\n        this.discount_percentage_offer_name = null;\n      }\n    },\n\n    addOfferToItems(offer) {\n      const offer_items = JSON.parse(offer.items);\n      offer_items.forEach((el) => {\n        this.items.forEach((exist_item) => {\n          if (exist_item.posa_row_id == el) {\n            const item_offers = JSON.parse(exist_item.posa_offers);\n            if (!item_offers.includes(offer.row_id)) {\n              item_offers.push(offer.row_id);\n              if (offer.offer === \'Item Price\') {\n                exist_item.posa_offer_applied = 1;\n              }\n            }\n            exist_item.posa_offers = JSON.stringify(item_offers);\n          }\n        });\n      });\n    },\n\n    deleteOfferFromItems(offer) {\n      const offer_items = JSON.parse(offer.items);\n      offer_items.forEach((el) => {\n        this.items.forEach((exist_item) => {\n          if (exist_item.posa_row_id == el) {\n            const item_offers = JSON.parse(exist_item.posa_offers);\n            const updated_item_offers = item_offers.filter(\n              (row_id) => row_id != offer.row_id\n            );\n            if (offer.offer === \'Item Price\') {\n              exist_item.posa_offer_applied = 0;\n            }\n            exist_item.posa_offers = JSON.stringify(updated_item_offers);\n          }\n        });\n      });\n    },\n\n    validate_due_date(item) {\n      const today = frappe.datetime.now_date();\n      const parse_today = Date.parse(today);\n      const new_date = Date.parse(item.posa_delivery_date);\n      if (new_date < parse_today) {\n        setTimeout(() => {\n          item.posa_delivery_date = today;\n        }, 0);\n      }\n    },\n  },\n\n  created() {\n    evntBus.$on(\'register_pos_profile\', (data) => {\n      this.pos_profile = data.pos_profile;\n      this.customer = data.pos_profile.customer;\n      this.pos_opening_shift = data.pos_opening_shift;\n      this.stock_settings = data.stock_settings;\n    });\n    evntBus.$on(\'add_item\', (item) => {\n      this.add_item(item);\n    });\n    evntBus.$on(\'update_customer\', (customer) => {\n      this.customer = customer;\n    });\n    evntBus.$on(\'new_invoice\', () => {\n      this.invoice_doc = \'\';\n      this.cancel_invoice();\n    });\n    evntBus.$on(\'load_invoice\', (data) => {\n      this.new_invoice(data);\n      evntBus.$emit(\'set_pos_coupons\', data.posa_coupons);\n    });\n    evntBus.$on(\'set_offers\', (data) => {\n      this.posOffers = data;\n    });\n    evntBus.$on(\'update_invoice_offers\', (data) => {\n      this.updateInvoiceOffers(data);\n    });\n    evntBus.$on(\'update_invoice_coupons\', (data) => {\n      this.posa_coupons = data;\n      this.handelOffers();\n    });\n    evntBus.$on(\'set_all_items\', (data) => {\n      this.allItems = data;\n      this.items.forEach((item) => {\n        this.update_item_detail(item);\n      });\n    });\n    evntBus.$on(\'load_return_invoice\', (data) => {\n      this.new_invoice(data.invoice_doc);\n      this.discount_amount = -data.return_doc.discount_amount;\n      this.additional_discount_percentage =\n        -data.return_doc.additional_discount_percentage;\n      this.return_doc = data.return_doc;\n    });\n    document.addEventListener(\'keydown\', this.shortOpenPayment.bind(this));\n    document.addEventListener(\'keydown\', this.shortDeleteFirstItem.bind(this));\n    document.addEventListener(\'keydown\', this.shortOpenFirstItem.bind(this));\n    document.addEventListener(\'keydown\', this.shortSelectDiscount.bind(this));\n  },\n  destroyed() {\n    document.removeEventListener(\'keydown\', this.shortOpenPayment);\n    document.removeEventListener(\'keydown\', this.shortDeleteFirstItem);\n    document.removeEventListener(\'keydown\', this.shortOpenFirstItem);\n    document.removeEventListener(\'keydown\', this.shortSelectDiscount);\n  },\n  watch: {\n    customer() {\n      this.close_payments();\n      evntBus.$emit(\'set_customer\', this.customer);\n      this.fetch_customer_details();\n    },\n    customer_info() {\n      evntBus.$emit(\'set_customer_info_to_edit\', this.customer_info);\n    },\n    expanded(data_value) {\n      this.update_items_details(data_value);\n      if (data_value.length > 0) {\n        this.update_item_detail(data_value[0]);\n      }\n    },\n    discount_percentage_offer_name() {\n      evntBus.$emit(\'update_discount_percentage_offer_name\', {\n        value: this.discount_percentage_offer_name,\n      });\n    },\n    items: {\n      deep: true,\n      handler(items) {\n        this.handelOffers();\n        this.$forceUpdate();\n      },\n    },\n    invoiceType() {\n      evntBus.$emit(\'update_invoice_type\', this.invoiceType);\n    },\n    discount_amount() {\n      if (!this.discount_amount || this.discount_amount == 0) {\n        this.additional_discount_percentage = 0;\n      } else if (this.pos_profile.posa_use_percentage_discount) {\n        this.additional_discount_percentage =\n          (this.discount_amount / this.Total) * 100;\n      } else {\n        this.additional_discount_percentage = 0;\n      }\n    },\n  },\n};\n<\/script>\n\n<style scoped>\n.border_line_bottom {\n  border-bottom: 1px solid lightgray;\n}\n.disable-events {\n  pointer-events: none;\n}\n</style>']},media:void 0})},u,"data-v-8ce8e520",!1,0,function e(){var t=document.head||document.getElementsByTagName("head")[0],n=e.styles||(e.styles={}),i="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(e,o){if(!document.querySelector('style[data-vue-ssr-id~="'+e+'"]')){var r=i?o.media||"default":e,s=n[r]||(n[r]={ids:[],parts:[],element:void 0});if(!s.ids.includes(e)){var a=o.source,c=s.ids.length;if(s.ids.push(e),i&&(s.element=s.element||document.querySelector("style[data-group="+r+"]")),!s.element){var l=s.element=document.createElement("style");l.type="text/css",o.media&&l.setAttribute("media",o.media),i&&(l.setAttribute("data-group",r),l.setAttribute("data-next-index","0")),t.appendChild(l)}if(i&&(c=parseInt(s.element.getAttribute("data-next-index")),s.element.setAttribute("data-next-index",c+1)),s.element.styleSheet)s.parts.push(a),s.element.styleSheet.cssText=s.parts.filter(Boolean).join("\n");else{var _=document.createTextNode(a),u=s.element.childNodes;u[c]&&s.element.removeChild(u[c]),u.length?s.element.insertBefore(_,u[c]):s.element.appendChild(_)}}}}}),d={props:["dialog"],data:function(){return{dialog_data:{},companys:[],company:"",pos_profiles_data:[],pos_profiles:[],pos_profile:"",payments_method_data:[],payments_methods:[],payments_methods_headers:[{text:__("Mode of Payment"),align:"start",sortable:!1,value:"mode_of_payment"},{text:__("Opening Amount"),value:"amount",align:"center",sortable:!1}],itemsPerPage:100,max25chars:function(e){return e.length<=12||"Input too long!"},pagination:{},snack:!1,snackColor:"",snackText:""}},watch:{company:function(e){var t=this;this.pos_profiles=[],this.pos_profiles_data.forEach(function(n){n.company===e&&t.pos_profiles.push(n.name),t.pos_profiles.length?t.pos_profile=t.pos_profiles[0]:t.pos_profile=""})},pos_profile:function(e){var t=this;this.payments_methods=[],this.payments_method_data.forEach(function(n){n.parent===e&&t.payments_methods.push({mode_of_payment:n.mode_of_payment,amount:0})})}},methods:{close_opening_dialog:function(){e.$emit("close_opening_dialog")},get_opening_dialog_data:function(){var e=this;frappe.call({method:"posawesome.posawesome.api.posapp.get_opening_dialog_data",args:{},callback:function(t){t.message&&(t.message.companys.forEach(function(t){e.companys.push(t.name)}),e.company=e.companys[0],e.pos_profiles_data=t.message.pos_profiles_data,e.payments_method_data=t.message.payments_method)}})},submit_dialog:function(){if(this.payments_methods.length&&this.company&&this.pos_profile){var t=this;return frappe.call("posawesome.posawesome.api.posapp.create_opening_voucher",{pos_profile:this.pos_profile,company:this.company,balance_details:this.payments_methods}).then(function(n){n.message&&(e.$emit("register_pos_data",n.message),e.$emit("set_company",n.message.company),t.close_opening_dialog())})}},formtCurrency:function(e){return(e=parseFloat(e)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}},created:function(){this.$nextTick(function(){this.get_opening_dialog_data()})}},m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{persistent:"","max-width":"600px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v(e._s(e.__("Create POS Opening Shift")))])]),e._v(" "),n("v-card-text",[n("v-container",[n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-autocomplete",{attrs:{items:e.companys,label:e.frappe._("Company"),required:""},model:{value:e.company,callback:function(t){e.company=t},expression:"company"}})],1),e._v(" "),n("v-col",{attrs:{cols:"12"}},[n("v-autocomplete",{attrs:{items:e.pos_profiles,label:e.frappe._("POS Profile"),required:""},model:{value:e.pos_profile,callback:function(t){e.pos_profile=t},expression:"pos_profile"}})],1),e._v(" "),n("v-col",{attrs:{cols:"12"}},[[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.payments_methods_headers,items:e.payments_methods,"item-key":"mode_of_payment","items-per-page":e.itemsPerPage,"hide-default-footer":""},scopedSlots:e._u([{key:"item.amount",fn:function(t){return[n("v-edit-dialog",{attrs:{"return-value":t.item.amount},on:{"update:returnValue":function(n){return e.$set(t.item,"amount",n)},"update:return-value":function(n){return e.$set(t.item,"amount",n)}},scopedSlots:e._u([{key:"input",fn:function(){return[n("v-text-field",{attrs:{rules:[e.max25chars],label:e.frappe._("Edit"),"single-line":"",counter:"",type:"number"},model:{value:t.item.amount,callback:function(n){e.$set(t.item,"amount",n)},expression:"props.item.amount"}})]},proxy:!0}],null,!0)},[e._v("\n                      "+e._s(e.formtCurrency(t.item.amount))+"\n                      ")])]}}])})]],2)],1)],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"primary",dark:""},on:{click:e.submit_dialog}},[e._v("Submit")])],1)],1)],1)],1)};m._withStripped=!0;var v=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/OpeningDialog.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:m,staticRenderFns:[]},0,d,void 0,!1),h={data:function(){return{loading:!1,pos_profile:"",invoice_doc:"",loyalty_amount:0,is_credit_sale:0,is_write_off_change:0,date_menu:!1,po_date_menu:!1,addresses:[],paid_change:0,order_delivery_date:!1,paid_change_rules:[],is_return:!1,is_cashback:!0,redeem_customer_credit:!1,customer_credit_dict:[],phone_dialog:!1,invoiceType:"Invoice",pos_settings:"",customer_info:"",mpesa_modes:[]}},methods:{back_to_invoice:function(){e.$emit("show_payment","false"),e.$emit("set_customer_readonly",!1)},submit:function(){if(!this.invoice_doc.is_return&&this.total_payments<0)return e.$emit("show_mesage",{text:"Payments not correct",color:"error"}),void frappe.utils.play_sound("error");if(!this.pos_profile.posa_allow_partial_payment&&this.total_payments<this.invoice_doc.grand_total)return e.$emit("show_mesage",{text:"The amount paid is not complete",color:"error"}),void frappe.utils.play_sound("error");if(this.pos_profile.posa_allow_partial_payment&&!this.pos_profile.posa_allow_credit_sale&&0==this.total_payments)return e.$emit("show_mesage",{text:"Please enter the amount paid",color:"error"}),void frappe.utils.play_sound("error");if(this.paid_change||(this.paid_change=0),this.paid_change>-this.diff_payment)return e.$emit("show_mesage",{text:"Paid change can not be greater than total change!",color:"error"}),void frappe.utils.play_sound("error");var t=flt(flt(this.paid_change)+flt(-this.credit_change));return this.is_cashback&&t!=-this.diff_payment?(e.$emit("show_mesage",{text:"Error in change calculations!",color:"error"}),void frappe.utils.play_sound("error")):this.customer_credit_dict.filter(function(e){return!!e.credit_to_redeem&&e.credit_to_redeem>e.total_credit}).length>0?(e.$emit("show_mesage",{text:"redeamed credit can not greater than its total.",color:"error"}),void frappe.utils.play_sound("error")):!this.invoice_doc.is_return&&this.redeemed_customer_credit>this.invoice_doc.grand_total?(e.$emit("show_mesage",{text:"can not redeam customer credit more than invoice total",color:"error"}),void frappe.utils.play_sound("error")):(this.submit_invoice(),this.customer_credit_dict=[],this.redeem_customer_credit=!1,this.is_cashback=!0,e.$emit("new_invoice","false"),void this.back_to_invoice())},submit_invoice:function(){var t={};t.total_change=-this.diff_payment,t.paid_change=this.paid_change,t.credit_change=-this.credit_change,t.redeemed_customer_credit=this.redeemed_customer_credit,t.customer_credit_dict=this.customer_credit_dict,t.is_cashback=this.is_cashback;var n=this;frappe.call({method:"posawesome.posawesome.api.posapp.submit_invoice",args:{data:t,invoice:this.invoice_doc},async:!0,callback:function(t){t.message&&(n.load_print_page(),e.$emit("set_last_invoice",n.invoice_doc.name),e.$emit("show_mesage",{text:"Invoice "+t.message.name+" is Submited",color:"success"}),frappe.utils.play_sound("submit"),this.addresses=[])}})},set_full_amount:function(e){var t=this;this.invoice_doc.payments.forEach(function(n){n.amount=n.idx==e?t.invoice_doc.grand_total:0})},set_rest_amount:function(e){var t=this;this.invoice_doc.payments.forEach(function(n){n.idx==e&&0==n.amount&&t.diff_payment>0&&(n.amount=t.diff_payment)})},clear_all_amounts:function(){this.invoice_doc.payments.forEach(function(e){e.amount=0})},load_print_page:function(){var e=this.pos_profile.print_format_for_online||this.pos_profile.print_format,t=this.pos_profile.letter_head||0,n=frappe.urllib.get_base_url()+"/printview?doctype=Sales%20Invoice&name="+this.invoice_doc.name+"&trigger_print=1&format="+e+"&no_letterhead="+t,i=window.open(n,"Print");i.addEventListener("load",function(){i.print()},!0)},validate_due_date:function(){var e=this,t=frappe.datetime.now_date(),n=Date.parse(t);Date.parse(this.invoice_doc.due_date)<n&&setTimeout(function(){e.invoice_doc.due_date=t},0)},formtCurrency:function(e){return(e=parseFloat(e)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},shortPay:function(e){"x"===e.key&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.submit())},set_paid_change:function(){this.paid_change||(this.paid_change=0),this.paid_change_rules=[];var e=-this.diff_payment;this.paid_change>e&&(this.paid_change_rules=["Paid change can not be greater than total change!"],this.credit_change=0)},get_available_credit:function(e){var t=this;this.clear_all_amounts(),e?frappe.call("posawesome.posawesome.api.posapp.get_available_credit",{customer:this.invoice_doc.customer,company:this.pos_profile.company}).then(function(e){var n=e.message;n.length?t.customer_credit_dict=n:t.customer_credit_dict=[]}):this.customer_credit_dict=[]},get_addresses:function(){var e=this;e.invoice_doc&&frappe.call({method:"posawesome.posawesome.api.posapp.get_customer_addresses",args:{customer:e.invoice_doc.customer},async:!0,callback:function(t){t.exc?e.addresses=[]:e.addresses=t.message}})},addressFilter:function(e,t,n){var i=e.address_title?e.address_title.toLowerCase():"",o=e.address_line1?e.address_line1.toLowerCase():"",r=e.address_line2?e.address_line2.toLowerCase():"",s=e.city?e.city.toLowerCase():"",a=e.name.toLowerCase(),c=t.toLowerCase();return i.indexOf(c)>-1||o.indexOf(c)>-1||r.indexOf(c)>-1||s.indexOf(c)>-1||a.indexOf(c)>-1},new_address:function(){e.$emit("open_new_address",this.invoice_doc.customer)},request_payment:function(){this.phone_dialog=!1;var t=this;if(!this.invoice_doc.contact_mobile)return e.$emit("show_mesage",{text:__("Pleas Set Customer Mobile Number"),color:"error"}),e.$emit("open_edit_customer"),void this.back_to_invoice();e.$emit("freeze",{title:__("Waiting for payment... ")});var n=this.invoice_doc;n.total_change=-this.diff_payment,n.paid_change=this.paid_change,n.credit_change=-this.credit_change,n.redeemed_customer_credit=this.redeemed_customer_credit,n.customer_credit_dict=this.customer_credit_dict,n.is_cashback=this.is_cashback,frappe.call({method:"posawesome.posawesome.api.posapp.update_invoice",args:{data:n},async:!1,callback:function(e){e.message&&(t.invoice_doc=e.message)}}).then(function(){frappe.call({method:"posawesome.posawesome.api.posapp.create_payment_request",args:{doc:t.invoice_doc}}).fail(function(){e.$emit("unfreeze"),e.$emit("show_mesage",{text:__("Payment request failed"),color:"error"})}).then(function(n){var i=n.message.name;setTimeout(function(){frappe.db.get_value("Payment Request",i,["status","grand_total"]).then(function(n){var i=n.message;"Paid"!=i.status?(e.$emit("unfreeze"),e.$emit("show_mesage",{text:__("Payment Request took too long to respond. Please try requesting for payment again"),color:"error"})):(e.$emit("unfreeze"),e.$emit("show_mesage",{text:__("Payment of {0} received successfully.",[format_currency(i.grand_total,t.invoice_doc.currency,0)]),color:"success"}),frappe.db.get_doc("Sales Invoice",t.invoice_doc.name).then(function(e){t.invoice_doc=e,t.submit()}))})},3e4)})})},get_mpesa_modes:function(){var e=this;frappe.call({method:"posawesome.posawesome.api.m_pesa.get_mpesa_mode_of_payment",args:{company:e.pos_profile.company},async:!0,callback:function(t){t.exc?e.mpesa_modes=[]:e.mpesa_modes=t.message}})},is_mpesa_c2b_payment:function(e){return!(!this.mpesa_modes.includes(e.mode_of_payment)||"Bank"!=e.type)&&(e.amount=0,!0)},mpesa_c2b_dialg:function(t){var n={company:this.pos_profile.company,mode_of_payment:t.mode_of_payment,customer:this.invoice_doc.customer};e.$emit("open_mpesa_payments",n)},set_mpesa_payment:function(e){this.pos_profile.use_customer_credit=1,this.redeem_customer_credit=!0;var t={type:"Advance",credit_origin:e.name,total_credit:e.unallocated_amount,credit_to_redeem:e.unallocated_amount};this.clear_all_amounts(),this.customer_credit_dict.push(t)}},computed:{total_payments:function(){var e=parseFloat(this.invoice_doc.loyalty_amount);return this.invoice_doc&&this.invoice_doc.payments&&this.invoice_doc.payments.forEach(function(t){e+=parseFloat(t.amount)}),e+=parseFloat(this.redeemed_customer_credit),this.is_cashback||(e=0),e.toFixed(2)},diff_payment:function(){var e=(this.invoice_doc.grand_total-this.total_payments).toFixed(2);return this.paid_change=-e,e},credit_change:function(){var e=-this.diff_payment;return this.paid_change>e?0:(this.paid_change-e).toFixed(2)},diff_lable:function(){return this.diff_payment<0?"Change":"To Be Paid"},available_pioints_amount:function(){var e=0;return this.customer_info.loyalty_points&&(e=this.customer_info.loyalty_points*this.customer_info.conversion_factor),e},available_customer_credit:function(){var e=0;return this.customer_credit_dict.map(function(t){e+=t.total_credit}),e},redeemed_customer_credit:function(){var e=0;return this.customer_credit_dict.map(function(t){t.credit_to_redeem?e+=parseFloat(t.credit_to_redeem):t.credit_to_redeem=0}),e},vaildatPayment:function(){return!!this.pos_profile.posa_allow_sales_order&&("Order"==this.invoiceType&&!this.invoice_doc.posa_delivery_date)},request_payment_field:function(){var e=!1;return this.pos_settings&&0!=this.pos_settings.invoice_fields.length?this.pos_settings.invoice_fields.forEach(function(t){"Button"==t.fieldtype&&"request_for_payment"==t.fieldname&&(e=!0)}):e=!1,e}},created:function(){var t=this;this.$nextTick(function(){var t=this;e.$on("send_invoice_doc_payment",function(e){t.invoice_doc=e;var n=t.invoice_doc.payments.find(function(e){return 1==e.default});t.is_credit_sale=0,t.is_write_off_change=0,n&&(n.amount=e.grand_total.toFixed(2)),t.loyalty_amount=0,t.get_addresses()}),e.$on("register_pos_profile",function(e){t.pos_profile=e.pos_profile,t.get_mpesa_modes()}),e.$on("add_the_new_address",function(e){t.addresses.push(e),t.$forceUpdate()}),e.$on("update_invoice_type",function(e){t.invoiceType=e,t.invoice_doc&&"Order"!=e&&(t.invoice_doc.posa_delivery_date=null,t.invoice_doc.posa_notes=null,t.invoice_doc.shipping_address_name=null)})}),e.$on("update_customer",function(e){t.customer!=e&&(t.customer_credit_dict=[],t.redeem_customer_credit=!1,t.is_cashback=!0)}),e.$on("set_pos_settings",function(e){t.pos_settings=e}),e.$on("set_customer_info_to_edit",function(e){t.customer_info=e}),e.$on("set_mpesa_payment",function(e){t.set_mpesa_payment(e)}),document.addEventListener("keydown",this.shortPay.bind(this))},destroyed:function(){document.removeEventListener("keydown",this.shortPay)},watch:{loyalty_amount:function(t){t>this.available_pioints_amount?(this.invoice_doc.loyalty_amount=0,this.invoice_doc.redeem_loyalty_points=0,this.invoice_doc.loyalty_points=0,e.$emit("show_mesage",{text:"Loyalty Amount can not be more then "+this.available_pioints_amount,color:"error"})):(this.invoice_doc.loyalty_amount=flt(this.loyalty_amount),this.invoice_doc.redeem_loyalty_points=1,this.invoice_doc.loyalty_points=flt(this.loyalty_amount)*this.customer_info.conversion_factor)},is_credit_sale:function(e){1==e&&this.invoice_doc.payments.forEach(function(e){e.amount=0,e.base_amount=0})},is_write_off_change:function(e){1==e?(this.invoice_doc.write_off_amount=this.diff_payment,this.invoice_doc.write_off_outstanding_amount_automatically=1):(this.invoice_doc.write_off_amount=0,this.invoice_doc.write_off_outstanding_amount_automatically=0)},redeemed_customer_credit:function(t){t>this.available_customer_credit&&e.$emit("show_mesage",{text:"You can redeem customer credit upto "+this.available_customer_credit,color:"error"})}}},g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-card",{staticClass:"selection mx-auto grey lighten-5 pa-1",staticStyle:{"max-height":"76vh",height:"76vh"}},[n("v-progress-linear",{attrs:{active:e.loading,indeterminate:e.loading,absolute:"",top:"",color:"deep-purple accent-4"}}),e._v(" "),n("div",{staticClass:"overflow-y-auto px-2 pt-2",staticStyle:{"max-height":"75vh"}},[e.invoice_doc?n("v-row",{staticClass:"px-1 py-0"},[n("v-col",{attrs:{cols:"7"}},[n("v-text-field",{attrs:{outlined:"",color:"indigo",label:e.frappe._("Paid Amount"),"background-color":"white","hide-details":"",value:e.formtCurrency(e.total_payments),readonly:"",prefix:e.invoice_doc.currency,dense:""}})],1),e._v(" "),n("v-col",{attrs:{cols:"5"}},[n("v-text-field",{attrs:{outlined:"",color:"indigo",label:e.frappe._(e.diff_lable),"background-color":"white","hide-details":"",value:e.formtCurrency(e.diff_payment),disabled:"",prefix:e.invoice_doc.currency,dense:""}})],1),e._v(" "),e.diff_payment<0&&!e.invoice_doc.is_return?n("v-col",{attrs:{cols:"7"}},[n("v-text-field",{attrs:{outlined:"",color:"indigo",label:e.frappe._("Paid Change"),"background-color":"white",prefix:e.invoice_doc.currency,rules:e.paid_change_rules,dense:"",type:"number"},on:{input:function(t){return e.set_paid_change()}},model:{value:e.paid_change,callback:function(t){e.paid_change=t},expression:"paid_change"}})],1):e._e(),e._v(" "),e.diff_payment<0&&!e.invoice_doc.is_return?n("v-col",{attrs:{cols:"5"}},[n("v-text-field",{attrs:{outlined:"",color:"indigo",label:e.frappe._("Credit Change"),"background-color":"white","hide-details":"",value:e.formtCurrency(e.credit_change),disabled:"",prefix:e.invoice_doc.currency,dense:""}})],1):e._e()],1):e._e(),e._v(" "),n("v-divider"),e._v(" "),e.is_cashback?n("div",e._l(e.invoice_doc.payments,function(t){return n("v-row",{key:t.name,staticClass:"pyments px-1 py-0"},[e.is_mpesa_c2b_payment(t)?e._e():n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._(t.mode_of_payment),"background-color":"white","hide-details":"",type:"number",prefix:e.invoice_doc.currency,readonly:!!e.invoice_doc.is_return},on:{focus:function(n){return e.set_rest_amount(t.idx)}},model:{value:t.amount,callback:function(n){e.$set(t,"amount",n)},expression:"payment.amount"}})],1),e._v(" "),e.is_mpesa_c2b_payment(t)?e._e():n("v-col",{attrs:{cols:!("Phone"==t.type&&0!=t.amount&&e.request_payment_field||e.is_mpesa_c2b_payment(t))}},[n("v-btn",{attrs:{block:"",color:"primary",dark:""},on:{click:function(n){return e.set_full_amount(t.idx)}}},[e._v(e._s(t.mode_of_payment))])],1),e._v(" "),e.is_mpesa_c2b_payment(t)?n("v-col",{staticClass:"pl-3",attrs:{cols:12}},[n("v-btn",{attrs:{block:"",color:"success",dark:""},on:{click:function(n){return e.mpesa_c2b_dialg(t)}}},[e._v("\n              "+e._s(e.__("Get Payments "+t.mode_of_payment))+"\n            ")])],1):e._e(),e._v(" "),"Phone"==t.type&&t.amount>0&&e.request_payment_field?n("v-col",{staticClass:"pl-1",attrs:{cols:3}},[n("v-btn",{attrs:{block:"",color:"success",dark:"",disabled:0==t.amount},on:{click:function(t){e.phone_dialog=!0}}},[e._v("\n              "+e._s(e.__("Request"))+"\n            ")])],1):e._e()],1)}),1):e._e(),e._v(" "),e.invoice_doc&&e.available_pioints_amount>0&&!e.invoice_doc.is_return?n("v-row",{staticClass:"pyments px-1 py-0"},[n("v-col",{attrs:{cols:"7"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Redeem Loyalty Points"),"background-color":"white","hide-details":"",type:"number",prefix:e.invoice_doc.currency},model:{value:e.loyalty_amount,callback:function(t){e.loyalty_amount=t},expression:"loyalty_amount"}})],1),e._v(" "),n("v-col",{attrs:{cols:"5"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("You can redeem upto"),"background-color":"white","hide-details":"",value:e.formtCurrency(e.available_pioints_amount),prefix:e.invoice_doc.currency,disabled:""}})],1)],1):e._e(),e._v(" "),e.invoice_doc&&e.available_customer_credit>0&&!e.invoice_doc.is_return&&e.redeem_customer_credit?n("v-row",{staticClass:"pyments px-1 py-0"},[n("v-col",{attrs:{cols:"7"}},[n("v-text-field",{attrs:{dense:"",outlined:"",disabled:"",color:"indigo",label:e.frappe._("Redeemed Customer Credit"),"background-color":"white","hide-details":"",type:"number",prefix:e.invoice_doc.currency},model:{value:e.redeemed_customer_credit,callback:function(t){e.redeemed_customer_credit=t},expression:"redeemed_customer_credit"}})],1),e._v(" "),n("v-col",{attrs:{cols:"5"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("You can redeem credit upto"),"background-color":"white","hide-details":"",value:e.formtCurrency(e.available_customer_credit),prefix:e.invoice_doc.currency,disabled:""}})],1)],1):e._e(),e._v(" "),n("v-divider"),e._v(" "),n("v-row",{staticClass:"px-1 py-0"},[n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Net Total"),"background-color":"white","hide-details":"",value:e.formtCurrency(e.invoice_doc.net_total),disabled:"",prefix:e.invoice_doc.currency}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Tax and Charges"),"background-color":"white","hide-details":"",value:e.formtCurrency(e.invoice_doc.total_taxes_and_charges),disabled:"",prefix:e.invoice_doc.currency}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Total Amount"),"background-color":"white","hide-details":"",value:e.formtCurrency(e.invoice_doc.total),disabled:"",prefix:e.invoice_doc.currency}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Discount Amount"),"background-color":"white","hide-details":"",value:e.formtCurrency(e.invoice_doc.discount_amount),disabled:"",prefix:e.invoice_doc.currency}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Grand Total"),"background-color":"white","hide-details":"",value:e.formtCurrency(e.invoice_doc.grand_total),disabled:"",prefix:e.invoice_doc.currency}})],1),e._v(" "),e.pos_profile.posa_allow_sales_order&&"Order"==e.invoiceType?n("v-col",{attrs:{cols:"6"}},[n("v-menu",{ref:"order_delivery_date",attrs:{"close-on-content-click":!1,transition:"scale-transition",dense:""},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,o=t.attrs;return[n("v-text-field",e._g(e._b({attrs:{label:e.frappe._("Delivery Date"),readonly:"",outlined:"",dense:"","background-color":"white",clearable:"",color:"indigo","hide-details":""},model:{value:e.invoice_doc.posa_delivery_date,callback:function(t){e.$set(e.invoice_doc,"posa_delivery_date",t)},expression:"invoice_doc.posa_delivery_date"}},"v-text-field",o,!1),i))]}}],null,!1,2151590711),model:{value:e.order_delivery_date,callback:function(t){e.order_delivery_date=t},expression:"order_delivery_date"}},[e._v(" "),n("v-date-picker",{attrs:{"no-title":"",scrollable:"",color:"indigo",min:e.frappe.datetime.now_date()},on:{input:function(t){e.order_delivery_date=!1}},model:{value:e.invoice_doc.posa_delivery_date,callback:function(t){e.$set(e.invoice_doc,"posa_delivery_date",t)},expression:"invoice_doc.posa_delivery_date"}})],1)],1):e._e(),e._v(" "),e.invoice_doc.posa_delivery_date?n("v-col",{attrs:{cols:"12"}},[n("v-autocomplete",{attrs:{dense:"",clearable:"","auto-select-first":"",outlined:"",color:"indigo",label:e.frappe._("Address"),items:e.addresses,"item-text":"address_title","item-value":"name","background-color":"white","no-data-text":"Address not found","hide-details":"",filter:e.addressFilter,"append-icon":"mdi-plus"},on:{"click:append":e.new_address},scopedSlots:e._u([{key:"item",fn:function(t){return[[n("v-list-item-content",[n("v-list-item-title",{staticClass:"indigo--text subtitle-1",domProps:{innerHTML:e._s(t.item.address_title)}}),e._v(" "),n("v-list-item-title",{domProps:{innerHTML:e._s(t.item.address_line1)}}),e._v(" "),t.item.custoaddress_line2mer_name?n("v-list-item-subtitle",{domProps:{innerHTML:e._s(t.item.address_line2)}}):e._e(),e._v(" "),t.item.city?n("v-list-item-subtitle",{domProps:{innerHTML:e._s(t.item.city)}}):e._e(),e._v(" "),t.item.state?n("v-list-item-subtitle",{domProps:{innerHTML:e._s(t.item.state)}}):e._e(),e._v(" "),t.item.country?n("v-list-item-subtitle",{domProps:{innerHTML:e._s(t.item.mobile_no)}}):e._e(),e._v(" "),t.item.address_type?n("v-list-item-subtitle",{domProps:{innerHTML:e._s(t.item.address_type)}}):e._e()],1)]]}}],null,!1,2950595207),model:{value:e.invoice_doc.shipping_address_name,callback:function(t){e.$set(e.invoice_doc,"shipping_address_name",t)},expression:"invoice_doc.shipping_address_name"}})],1):e._e(),e._v(" "),e.pos_profile.posa_display_additional_notes?n("v-col",{attrs:{cols:"12"}},[n("v-textarea",{staticClass:"pa-0",attrs:{outlined:"",dense:"","background-color":"white",clearable:"",color:"indigo","auto-grow":"",rows:"2",label:e.frappe._("Additional Notes"),value:e.invoice_doc.posa_notes},model:{value:e.invoice_doc.posa_notes,callback:function(t){e.$set(e.invoice_doc,"posa_notes",t)},expression:"invoice_doc.posa_notes"}})],1):e._e()],1),e._v(" "),e.pos_profile.posa_allow_customer_purchase_order?n("div",[n("v-divider"),e._v(" "),n("v-row",{staticClass:"px-1 py-0",attrs:{justify:"center",align:"start"}},[n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{label:e.frappe._("Purchase Order"),outlined:"",dense:"","background-color":"white",clearable:"",color:"indigo","hide-details":""},model:{value:e.invoice_doc.po_no,callback:function(t){e.$set(e.invoice_doc,"po_no",t)},expression:"invoice_doc.po_no"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-menu",{ref:"po_date_menu",attrs:{"close-on-content-click":!1,transition:"scale-transition"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,o=t.attrs;return[n("v-text-field",e._g(e._b({attrs:{label:e.frappe._("Purchase Order Date"),readonly:"",outlined:"",dense:"","hide-details":"",color:"indigo"},model:{value:e.invoice_doc.po_date,callback:function(t){e.$set(e.invoice_doc,"po_date",t)},expression:"invoice_doc.po_date"}},"v-text-field",o,!1),i))]}}],null,!1,3403780053),model:{value:e.po_date_menu,callback:function(t){e.po_date_menu=t},expression:"po_date_menu"}},[e._v(" "),n("v-date-picker",{attrs:{"no-title":"",scrollable:"",color:"indigo"},on:{input:function(t){e.po_date_menu=!1}},model:{value:e.invoice_doc.po_date,callback:function(t){e.$set(e.invoice_doc,"po_date",t)},expression:"invoice_doc.po_date"}})],1)],1)],1)],1):e._e(),e._v(" "),n("v-divider"),e._v(" "),n("v-row",{staticClass:"px-1 py-0",attrs:{align:"start","no-gutters":""}},[e.pos_profile.posa_allow_write_off_change&&e.diff_payment>0&&!e.invoice_doc.is_return?n("v-col",{attrs:{cols:"6"}},[n("v-switch",{staticClass:"my-0 py-0",attrs:{flat:"",label:e.frappe._("Write Off Difference Amount")},model:{value:e.is_write_off_change,callback:function(t){e.is_write_off_change=t},expression:"is_write_off_change"}})],1):e._e(),e._v(" "),e.pos_profile.posa_allow_credit_sale&&!e.invoice_doc.is_return?n("v-col",{attrs:{cols:"6"}},[n("v-switch",{staticClass:"my-0 py-0",attrs:{flat:"",label:e.frappe._("Is Credit Sale")},model:{value:e.is_credit_sale,callback:function(t){e.is_credit_sale=t},expression:"is_credit_sale"}})],1):e._e(),e._v(" "),e.invoice_doc.is_return&&e.pos_profile.use_cashback?n("v-col",{attrs:{cols:"6"}},[n("v-switch",{staticClass:"my-0 py-0",attrs:{flat:"",label:e.frappe._("Is Cashback")},model:{value:e.is_cashback,callback:function(t){e.is_cashback=t},expression:"is_cashback"}})],1):e._e(),e._v(" "),e.is_credit_sale?n("v-col",{attrs:{cols:"6"}},[n("v-menu",{ref:"date_menu",attrs:{"close-on-content-click":!1,transition:"scale-transition"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,o=t.attrs;return[n("v-text-field",e._g(e._b({attrs:{label:e.frappe._("Due Date"),readonly:"",outlined:"",dense:"","hide-details":"",color:"indigo"},model:{value:e.invoice_doc.due_date,callback:function(t){e.$set(e.invoice_doc,"due_date",t)},expression:"invoice_doc.due_date"}},"v-text-field",o,!1),i))]}}],null,!1,3789313935),model:{value:e.date_menu,callback:function(t){e.date_menu=t},expression:"date_menu"}},[e._v(" "),n("v-date-picker",{attrs:{"no-title":"",scrollable:"",color:"indigo",min:e.frappe.datetime.now_date()},on:{input:function(t){e.date_menu=!1}},model:{value:e.invoice_doc.due_date,callback:function(t){e.$set(e.invoice_doc,"due_date",t)},expression:"invoice_doc.due_date"}})],1)],1):e._e(),e._v(" "),!e.invoice_doc.is_return&&e.pos_profile.use_customer_credit?n("v-col",{attrs:{cols:"6"}},[n("v-switch",{staticClass:"my-0 py-0",attrs:{flat:"",label:e.frappe._("Use Customer Credit")},on:{change:function(t){return e.get_available_credit(t)}},model:{value:e.redeem_customer_credit,callback:function(t){e.redeem_customer_credit=t},expression:"redeem_customer_credit"}})],1):e._e()],1),e._v(" "),e.invoice_doc&&e.available_customer_credit>0&&!e.invoice_doc.is_return&&e.redeem_customer_credit?n("div",e._l(e.customer_credit_dict,function(t,i){return n("v-row",{key:i},[n("v-col",{attrs:{cols:"4"}},[n("div",{staticClass:"pa-2 py-3"},[e._v(e._s(t.credit_origin))])]),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Available Credit"),"background-color":"white","hide-details":"",value:e.formtCurrency(t.total_credit),disabled:"",prefix:e.invoice_doc.currency}})],1),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Redeem Credit"),"background-color":"white","hide-details":"",type:"number",prefix:e.invoice_doc.currency},model:{value:t.credit_to_redeem,callback:function(n){e.$set(t,"credit_to_redeem",n)},expression:"row.credit_to_redeem"}})],1)],1)}),1):e._e()],1)],1),e._v(" "),n("v-card",{staticClass:"cards mb-0 mt-3 py-0",attrs:{flat:""}},[n("v-row",{attrs:{align:"start","no-gutters":""}},[n("v-col",{attrs:{cols:"12"}},[n("v-btn",{staticClass:"pa-1",attrs:{block:"",large:"",color:"warning",dark:""},on:{click:e.back_to_invoice}},[e._v(e._s(e.__("Back")))])],1),e._v(" "),n("v-col",{attrs:{cols:"12"}},[n("v-btn",{staticClass:"mt-2",attrs:{block:"",large:"",color:"primary",dark:"",disabled:e.vaildatPayment},on:{click:e.submit}},[e._v(e._s(e.__("Submit Payments")))])],1)],1)],1),e._v(" "),n("div",[n("v-dialog",{attrs:{"max-width":"400px"},model:{value:e.phone_dialog,callback:function(t){e.phone_dialog=t},expression:"phone_dialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v(e._s(e.__("Confirm Mobile Number")))])]),e._v(" "),n("v-card-text",{staticClass:"pa-0"},[n("v-container",[n("v-text-field",{attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Mobile Number"),"background-color":"white","hide-details":"",type:"number"},model:{value:e.invoice_doc.contact_mobile,callback:function(t){e.$set(e.invoice_doc,"contact_mobile",t)},expression:"invoice_doc.contact_mobile"}})],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error",dark:""},on:{click:function(t){e.phone_dialog=!1}}},[e._v(e._s(e.__("Close")))]),e._v(" "),n("v-btn",{attrs:{color:"primary",dark:""},on:{click:e.request_payment}},[e._v(e._s(e.__("Request")))])],1)],1)],1)],1)],1)};g._withStripped=!0;var y=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/Payments.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:g,staticRenderFns:[]},0,h,void 0,!1),b={data:function(){return{loading:!1,pos_profile:"",pos_offers:[],allItems:[],discount_percentage_offer_name:null,itemsPerPage:1e3,expanded:[],singleExpand:!0,items_headers:[{text:__("Name"),value:"name",align:"start"},{text:__("Apply On"),value:"apply_on",align:"start"},{text:__("Offer"),value:"offer",align:"start"},{text:__("Applied"),value:"offer_applied",align:"start"}]}},computed:{offersCount:function(){return this.pos_offers.length},appliedOffersCount:function(){return this.pos_offers.filter(function(e){return!!e.offer_applied}).length}},methods:{back_to_invoice:function(){e.$emit("show_offers","false")},forceUpdateItem:function(){var e;e=[].concat(this.pos_offers),this.pos_offers=e},makeid:function(e){for(var t="",n="abcdefghijklmnopqrstuvwxyz0123456789",i=n.length,o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*i));return t},formtCurrency:function(e){return(e=parseFloat(e)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},updatePosOffers:function(t){var n=this,i=[];this.pos_offers.forEach(function(e){t.find(function(t){return t.name===e.name})||i.push(e.row_id)}),this.removeOffers(i),t.forEach(function(t){var i=n.pos_offers.find(function(e){return t.name===e.name});if(i)i.items=t.items,"Grand Total"!==i.offer||n.discount_percentage_offer_name||(i.offer_applied=!!i.auto),"Item Group"==t.apply_on&&"Item Group"==t.apply_type&&t.replace_cheapest_item&&(i.give_item=t.give_item,i.apply_item_code=t.apply_item_code);else{var o=Object.assign({},t);t.row_id||(o.row_id=n.makeid(20)),"Item Code"==t.apply_type&&(o.give_item=t.apply_item_code||"Nothing"),t.offer_applied?(o.offer_applied,t.offer_applied):"Item Group"!=t.apply_type||"Give Product"!=t.offer||t.replace_cheapest_item||t.replace_item?"Grand Total"===t.offer&&n.discount_percentage_offer_name?o.offer_applied=!1:o.offer_applied=!!t.auto:o.offer_applied=!1,"Give Product"!=o.offer||o.give_item||(o.give_item=n.get_give_items(o)[0].item_code),n.pos_offers.push(o),e.$emit("show_mesage",{text:__("New Offer Available"),color:"warning"})}})},removeOffers:function(e){this.pos_offers=this.pos_offers.filter(function(t){return!e.includes(t.row_id)})},handelOffers:function(){var t=this.pos_offers.filter(function(e){return e.offer_applied});e.$emit("update_invoice_offers",t)},handleNewLine:function(e){return e?e.replace(/(?:\r\n|\r|\n)/g,"<br />"):""},get_give_items:function(e){if("Item Code"==e.apply_type)return[e.apply_item_code];if("Item Group"==e.apply_type){var t=this.allItems.filter(function(t){return t.item_group==e.apply_item_group});return e.less_then>0?t.filter(function(t){return t.rate<e.less_then}):t}return[]},updateCounters:function(){e.$emit("update_offers_counters",{offersCount:this.offersCount,appliedOffersCount:this.appliedOffersCount})},updatePosCoupuns:function(){var t=this.pos_offers.filter(function(e){return e.offer_applied&&e.coupon_based});e.$emit("update_pos_coupons",t)}},watch:{pos_offers:{deep:!0,handler:function(e){this.handelOffers(),this.updateCounters(),this.updatePosCoupuns()}}},created:function(){var t=this;this.$nextTick(function(){var t=this;e.$on("register_pos_profile",function(e){t.pos_profile=e.pos_profile})}),e.$on("update_customer",function(e){t.customer!=e&&(t.offers=[])}),e.$on("update_pos_offers",function(e){t.updatePosOffers(e)}),e.$on("update_discount_percentage_offer_name",function(e){t.discount_percentage_offer_name=e.value}),e.$on("set_all_items",function(e){t.allItems=e})}},w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-card",{staticClass:"selection mx-auto grey lighten-5",staticStyle:{"max-height":"80vh",height:"80vh"}},[n("v-card-title",[n("span",{staticClass:"text-h6 warning--text"},[e._v(e._s(e.__("Offers")))])]),e._v(" "),n("div",{staticClass:"my-0 py-0 overflow-y-auto",staticStyle:{"max-height":"75vh"}},[[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.items_headers,items:e.pos_offers,"single-expand":e.singleExpand,expanded:e.expanded,"show-expand":"","item-key":"row_id","items-per-page":e.itemsPerPage,"hide-default-footer":""},on:{"update:expanded":function(t){e.expanded=t}},scopedSlots:e._u([{key:"item.offer_applied",fn:function(t){var i=t.item;return[n("v-simple-checkbox",{attrs:{disabled:"Give Product"==i.offer&&!i.give_item&&(!e.offer.replace_cheapest_item||!e.offer.replace_item)||"Grand Total"==i.offer&&e.discount_percentage_offer_name&&e.discount_percentage_offer_name!=i.name},on:{click:e.forceUpdateItem},model:{value:i.offer_applied,callback:function(t){e.$set(i,"offer_applied",t)},expression:"item.offer_applied"}})]}},{key:"expanded-item",fn:function(t){var i=t.headers,o=t.item;return[n("td",{attrs:{colspan:i.length}},[n("v-row",{staticClass:"mt-2"},[o.description?n("v-col",[n("div",{staticClass:"indigo--text",domProps:{innerHTML:e._s(e.handleNewLine(o.description))}})]):e._e(),e._v(" "),"Give Product"==o.offer?n("v-col",[n("v-autocomplete",{attrs:{items:e.get_give_items(o),"item-text":"item_code",outlined:"",dense:"",color:"indigo",label:e.frappe._("Give Item"),disabled:"Item Group"!=o.apply_type||o.replace_item||o.replace_cheapest_item},model:{value:o.give_item,callback:function(t){e.$set(o,"give_item",t)},expression:"item.give_item"}})],1):e._e()],1)],1)]}}])})]],2)],1),e._v(" "),n("v-card",{staticClass:"cards mb-0 mt-3 py-0",staticStyle:{"max-height":"11vh",height:"11vh"},attrs:{flat:""}},[n("v-row",{attrs:{align:"start","no-gutters":""}},[n("v-col",{attrs:{cols:"12"}},[n("v-btn",{staticClass:"pa-1",attrs:{block:"",large:"",color:"warning",dark:""},on:{click:e.back_to_invoice}},[e._v(e._s(e.__("Back")))])],1)],1)],1)],1)};w._withStripped=!0;var x=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/PosOffers.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:w,staticRenderFns:[]},0,b,void 0,!1),k={data:function(){return{loading:!1,pos_profile:"",customer:"",posa_coupons:[],new_coupon:null,itemsPerPage:1e3,singleExpand:!0,items_headers:[{text:__("Coupon"),value:"coupon_code",align:"start"},{text:__("Type"),value:"type",align:"start"},{text:__("Offer"),value:"pos_offer",align:"start"},{text:__("Applied"),value:"applied",align:"start"}]}},computed:{couponsCount:function(){return this.posa_coupons.length},appliedCouponsCount:function(){return this.posa_coupons.filter(function(e){return!!e.applied}).length}},methods:{back_to_invoice:function(){e.$emit("show_coupons","false")},add_coupon:function(t){if(this.customer&&t)if(this.posa_coupons.find(function(e){return e.coupon_code==t}))e.$emit("show_mesage",{text:__("This coupon already used !"),color:"error"});else{var n=this;frappe.call({method:"posawesome.posawesome.api.posapp.get_pos_coupon",args:{coupon:t,customer:n.customer,company:n.pos_profile.company},callback:function(t){if(t.message){var i=t.message;if("Apply"==i.msg&&i.coupon){n.new_coupon=null;var o=i.coupon;n.posa_coupons.push({coupon:o.name,coupon_code:o.coupon_code,type:o.coupon_type,applied:0,pos_offer:o.pos_offer,customer:o.customer||n.customer})}else e.$emit("show_mesage",{text:i.msg,color:"error"})}}})}},setActiveGiftCoupons:function(){if(this.customer){var e=this;frappe.call({method:"posawesome.posawesome.api.posapp.get_active_gift_coupons",args:{customer:e.customer,company:e.pos_profile.company},callback:function(t){t.message&&t.message.forEach(function(t){e.add_coupon(t)})}})}},updatePosCoupons:function(e){this.posa_coupons.forEach(function(t){var n=e.find(function(e){return e.offer_applied&&e.coupon==t.coupon});t.applied=n?1:0})},removeCoupon:function(e){this.posa_coupons=this.posa_coupons.filter(function(t){return!e.includes(t.coupon)})},updateInvoice:function(){e.$emit("update_invoice_coupons",this.posa_coupons)},updateCounters:function(){e.$emit("update_coupons_counters",{couponsCount:this.couponsCount,appliedCouponsCount:this.appliedCouponsCount})}},watch:{posa_coupons:{deep:!0,handler:function(){this.updateInvoice(),this.updateCounters()}}},created:function(){var t=this;this.$nextTick(function(){var t=this;e.$on("register_pos_profile",function(e){t.pos_profile=e.pos_profile})}),e.$on("update_customer",function(e){if(t.customer!=e){var n=[];t.posa_coupons.forEach(function(t){"Promotional"==t.type?t.customer=e:n.push(t.coupon)}),t.customer=e,n.length&&t.removeCoupon(n)}t.setActiveGiftCoupons()}),e.$on("update_pos_coupons",function(e){t.updatePosCoupons(e)}),e.$on("set_pos_coupons",function(e){t.posa_coupons=e})}},C=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-card",{staticClass:"selection mx-auto grey lighten-5",staticStyle:{"max-height":"80vh",height:"80vh"}},[n("v-card-title",[n("v-row",{attrs:{"no-gutters":"",align:"center",justify:"center"}},[n("v-col",{attrs:{cols:"6"}},[n("span",{staticClass:"text-h6 warning--text"},[e._v(e._s(e.__("Coupons")))])]),e._v(" "),n("v-col",{attrs:{cols:"4"}},[n("v-text-field",{staticClass:"mr-4",attrs:{dense:"",outlined:"",color:"indigo",label:e.frappe._("Coupon"),"background-color":"white","hide-details":""},model:{value:e.new_coupon,callback:function(t){e.new_coupon=t},expression:"new_coupon"}})],1),e._v(" "),n("v-col",{attrs:{cols:"2"}},[n("v-btn",{staticClass:"pa-1",attrs:{color:"primary",dark:""},on:{click:function(t){return e.add_coupon(e.new_coupon)}}},[e._v(e._s(e.__("add")))])],1)],1)],1),e._v(" "),n("div",{staticClass:"my-0 py-0 overflow-y-auto",staticStyle:{"max-height":"75vh"}},[[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.items_headers,items:e.posa_coupons,"single-expand":e.singleExpand,expanded:e.expanded,"item-key":"coupon","items-per-page":e.itemsPerPage,"hide-default-footer":""},on:{"update:expanded":function(t){e.expanded=t}},scopedSlots:e._u([{key:"item.applied",fn:function(t){var i=t.item;return[n("v-simple-checkbox",{attrs:{disabled:""},model:{value:i.applied,callback:function(t){e.$set(i,"applied",t)},expression:"item.applied"}})]}}])})]],2)],1),e._v(" "),n("v-card",{staticClass:"cards mb-0 mt-3 py-0",staticStyle:{"max-height":"11vh",height:"11vh"},attrs:{flat:""}},[n("v-row",{attrs:{align:"start","no-gutters":""}},[n("v-col",{attrs:{cols:"12"}},[n("v-btn",{staticClass:"pa-1",attrs:{block:"",large:"",color:"warning",dark:""},on:{click:e.back_to_invoice}},[e._v(e._s(e.__("Back")))])],1)],1)],1)],1)};C._withStripped=!0;var O=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/PosCoupons.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:C,staticRenderFns:[]},0,k,void 0,!1),I={data:function(){return{draftsDialog:!1,singleSelect:!0,selected:[],dialog_data:{},headers:[{text:__("Customer"),value:"customer",align:"start",sortable:!0},{text:__("Date"),align:"start",sortable:!0,value:"posting_date"},{text:__("Invoice"),value:"name",align:"start",sortable:!0},{text:__("Amount"),value:"grand_total",align:"start",sortable:!1}]}},watch:{},methods:{close_dialog:function(){this.draftsDialog=!1},submit_dialog:function(){this.selected.length>0&&(e.$emit("load_invoice",this.selected[0]),this.draftsDialog=!1)}},created:function(){var t=this;e.$on("open_drafts",function(e){t.draftsDialog=!0,t.dialog_data=e})}},q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"800px"},model:{value:e.draftsDialog,callback:function(t){e.draftsDialog=t},expression:"draftsDialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v(e._s(e.__("Select Hold Invoice")))])]),e._v(" "),n("v-card-text",{staticClass:"pa-0"},[n("v-container",[n("v-row",[n("v-col",{staticClass:"pa-1",attrs:{cols:"12"}},[[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.dialog_data,"item-key":"name","single-select":e.singleSelect,"show-select":""},model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})]],2)],1)],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error",dark:""},on:{click:e.close_dialog}},[e._v("Close")]),e._v(" "),n("v-btn",{attrs:{color:"primary",dark:""},on:{click:e.submit_dialog}},[e._v("Select")])],1)],1)],1)],1)};q._withStripped=!0;var A=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/Drafts.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:q,staticRenderFns:[]},0,I,void 0,!1),S={data:function(){return{closingDialog:!1,itemsPerPage:20,dialog_data:{},headers:[{text:__("Mode of Payment"),value:"mode_of_payment",align:"start",sortable:!0},{text:__("Opening Amount"),align:"end",sortable:!0,value:"opening_amount"},{text:__("Closing Amount"),value:"closing_amount",align:"end",sortable:!0},{text:__("Expected Amount"),value:"expected_amount",align:"end",sortable:!1},{text:__("Difference"),value:"difference",align:"end",sortable:!1}],max25chars:function(e){return e.length<=20||"Input too long!"},pagination:{}}},watch:{},methods:{close_dialog:function(){this.closingDialog=!1},submit_dialog:function(){e.$emit("submit_closing_pos",this.dialog_data),this.closingDialog=!1},formtCurrency:function(e){return(e=parseFloat(e)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}},created:function(){var t=this;e.$on("open_ClosingDialog",function(e){t.closingDialog=!0,t.dialog_data=e})}},P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"900px"},model:{value:e.closingDialog,callback:function(t){e.closingDialog=t},expression:"closingDialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v(e._s(e.__("Closing POS Shift")))])]),e._v(" "),n("v-card-text",{staticClass:"pa-0"},[n("v-container",[n("v-row",[n("v-col",{staticClass:"pa-1",attrs:{cols:"12"}},[[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.dialog_data.payment_reconciliation,"item-key":"mode_of_payment","items-per-page":e.itemsPerPage,"hide-default-footer":""},scopedSlots:e._u([{key:"item.closing_amount",fn:function(t){return[n("v-edit-dialog",{attrs:{"return-value":t.item.closing_amount},on:{"update:returnValue":function(n){return e.$set(t.item,"closing_amount",n)},"update:return-value":function(n){return e.$set(t.item,"closing_amount",n)}},scopedSlots:e._u([{key:"input",fn:function(){return[n("v-text-field",{attrs:{rules:[e.max25chars],label:e.frappe._("Edit"),"single-line":"",counter:"",type:"number"},model:{value:t.item.closing_amount,callback:function(n){e.$set(t.item,"closing_amount",n)},expression:"props.item.closing_amount"}})]},proxy:!0}],null,!0)},[e._v("\n                      "+e._s(e.formtCurrency(t.item.closing_amount))+"\n                      ")])]}},{key:"item.difference",fn:function(t){var n=t.item;return[e._v(e._s(n.difference=e.formtCurrency(n.expected_amount-n.closing_amount)))]}},{key:"item.opening_amount",fn:function(t){var n=t.item;return[e._v(e._s(e.formtCurrency(n.opening_amount)))]}},{key:"item.expected_amount",fn:function(t){var n=t.item;return[e._v(e._s(e.formtCurrency(n.expected_amount)))]}}])})]],2)],1)],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error",dark:""},on:{click:e.close_dialog}},[e._v(e._s(e.__("Close")))]),e._v(" "),n("v-btn",{attrs:{color:"primary",dark:""},on:{click:e.submit_dialog}},[e._v(e._s(e.__("Submit")))])],1)],1)],1)],1)};P._withStripped=!0;var T=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/ClosingDialog.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:P,staticRenderFns:[]},0,S,void 0,!1),E={data:function(){return{customerDialog:!1,pos_profile:"",customer_name:"",tax_id:"",mobile_no:"",email_id:"",referral_code:"",birthday:null,birthday_menu:!1,group:"",groups:[],territory:"",territorys:[]}},watch:{},methods:{close_dialog:function(){this.customerDialog=!1},getCustomerGroups:function(){if(!(this.groups.length>0)){var e=this;frappe.db.get_list("Customer Group",{fields:["name"],page_length:1e3}).then(function(t){t.length>0&&t.forEach(function(t){e.groups.push(t.name)})})}},getCustomerTerritorys:function(){if(!(this.territorys.length>0)){var e=this;frappe.db.get_list("Territory",{fields:["name"],page_length:1e3}).then(function(t){t.length>0&&t.forEach(function(t){e.territorys.push(t.name)})})}},submit_dialog:function(){if(this.customer_name){var t=this,n={customer_name:this.customer_name,company:this.pos_profile.company,tax_id:this.tax_id,mobile_no:this.mobile_no,email_id:this.email_id,referral_code:this.referral_code,birthday:this.birthday,customer_group:this.group,territory:this.territory};frappe.call({method:"posawesome.posawesome.api.posapp.create_customer",args:n,callback:function(i){!i.exc&&i.message.name&&(e.$emit("show_mesage",{text:__("Customer contact created successfully."),color:"success"}),n.name=i.message.name,frappe.utils.play_sound("submit"),e.$emit("add_customer_to_list",n),e.$emit("set_customer",i.message.name),t.customer_name="",t.tax_id="",t.mobile_no="",t.email_id="",t.referral_code="",t.birthday="",t.group="",t.customerDialog=!1)}}),this.customerDialog=!1}}},created:function(){var t=this;e.$on("open_new_customer",function(){t.customerDialog=!0}),e.$on("register_pos_profile",function(e){t.pos_profile=e.pos_profile}),this.getCustomerGroups(),this.getCustomerTerritorys()}},D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"600px"},model:{value:e.customerDialog,callback:function(t){e.customerDialog=t},expression:"customerDialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v(e._s(e.__("New Customer")))])]),e._v(" "),n("v-card-text",{staticClass:"pa-0"},[n("v-container",[n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Customer Name"),"background-color":"white","hide-details":""},model:{value:e.customer_name,callback:function(t){e.customer_name=t},expression:"customer_name"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Tax ID"),"background-color":"white","hide-details":""},model:{value:e.tax_id,callback:function(t){e.tax_id=t},expression:"tax_id"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Mobile No"),"background-color":"white","hide-details":""},model:{value:e.mobile_no,callback:function(t){e.mobile_no=t},expression:"mobile_no"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Email Id"),"background-color":"white","hide-details":""},model:{value:e.email_id,callback:function(t){e.email_id=t},expression:"email_id"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Referral Code"),"background-color":"white","hide-details":""},model:{value:e.referral_code,callback:function(t){e.referral_code=t},expression:"referral_code"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-menu",{ref:"birthday_menu",attrs:{"close-on-content-click":!1,transition:"scale-transition",dense:""},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,o=t.attrs;return[n("v-text-field",e._g(e._b({attrs:{label:e.frappe._("Birthday"),readonly:"",dense:"",clearable:"","hide-details":"",color:"indigo"},model:{value:e.birthday,callback:function(t){e.birthday=t},expression:"birthday"}},"v-text-field",o,!1),i))]}}]),model:{value:e.birthday_menu,callback:function(t){e.birthday_menu=t},expression:"birthday_menu"}},[e._v(" "),n("v-date-picker",{attrs:{color:"indigo","no-title":"",scrollable:"",max:e.frappe.datetime.now_date()},on:{input:function(t){e.birthday_menu=!1}},model:{value:e.birthday,callback:function(t){e.birthday=t},expression:"birthday"}})],1)],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-autocomplete",{attrs:{clearable:"",dense:"","auto-select-first":"",color:"indigo",label:e.frappe._("Customer Group"),items:e.groups,"background-color":"white","no-data-text":e.__("Group not found"),"hide-details":""},model:{value:e.group,callback:function(t){e.group=t},expression:"group"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-autocomplete",{attrs:{clearable:"",dense:"","auto-select-first":"",color:"indigo",label:e.frappe._("Territory"),items:e.territorys,"background-color":"white","no-data-text":e.__("Territory not found"),"hide-details":""},model:{value:e.territory,callback:function(t){e.territory=t},expression:"territory"}})],1)],1)],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error",dark:""},on:{click:e.close_dialog}},[e._v(e._s(e.__("Close")))]),e._v(" "),n("v-btn",{attrs:{color:"primary",dark:""},on:{click:e.submit_dialog}},[e._v(e._s(e.__("Submit")))])],1)],1)],1)],1)};D._withStripped=!0;var R=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/NewCustomer.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:D,staticRenderFns:[]},0,E,void 0,!1),F={data:function(){return{customerDialog:!1,customer_info:""}},watch:{customer:function(){this.fetch_customer_details()}},methods:{close_dialog:function(){this.customerDialog=!1},set_customer_info:function(t,n){var i=this;frappe.call({method:"posawesome.posawesome.api.posapp.set_customer_info",args:{fieldname:t,customer:this.customer_info.customer,value:n},callback:function(o){o.exc||(i.customer_info[t]=n,e.$emit("show_mesage",{text:__("Customer contact updated successfully."),color:"success"}),frappe.utils.play_sound("submit"))}})}},created:function(){var t=this;e.$on("open_edit_customer",function(){t.customerDialog=!0}),e.$on("set_customer_info_to_edit",function(e){t.customer_info=e})}},N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"600px"},model:{value:e.customerDialog,callback:function(t){e.customerDialog=t},expression:"customerDialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v(e._s(e.__("Customer Info")))])]),e._v(" "),n("v-card-text",{staticClass:"pa-0"},[n("v-container",[n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Customer Name"),"background-color":"white","hide-details":"",readonly:""},model:{value:e.customer_info.name,callback:function(t){e.$set(e.customer_info,"name",t)},expression:"customer_info.name"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Email"),"background-color":"white","hide-details":""},on:{change:function(t){return e.set_customer_info("email_id",t)}},model:{value:e.customer_info.email_id,callback:function(t){e.$set(e.customer_info,"email_id",t)},expression:"customer_info.email_id"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Mobile No"),"background-color":"white","hide-details":""},on:{change:function(t){return e.set_customer_info("mobile_no",t)}},model:{value:e.customer_info.mobile_no,callback:function(t){e.$set(e.customer_info,"mobile_no",t)},expression:"customer_info.mobile_no"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{label:e.frappe._("Loyalty Program"),dense:"",readonly:"","hide-details":""},model:{value:e.customer_info.loyalty_program,callback:function(t){e.$set(e.customer_info,"loyalty_program",t)},expression:"customer_info.loyalty_program"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{label:e.frappe._("Loyalty Points"),dense:"",readonly:"","hide-details":""},model:{value:e.customer_info.loyalty_points,callback:function(t){e.$set(e.customer_info,"loyalty_points",t)},expression:"customer_info.loyalty_points"}})],1)],1)],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error",dark:""},on:{click:e.close_dialog}},[e._v("Close")])],1)],1)],1)],1)};N._withStripped=!0;var j=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/EditCustomer.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:N,staticRenderFns:[]},0,F,void 0,!1),L={data:function(){return{addressDialog:!1,address:{},customer:""}},methods:{close_dialog:function(){this.addressDialog=!1},submit_dialog:function(){var t=this;this.address.customer=this.customer,this.address.doctype="Customer",frappe.call({method:"posawesome.posawesome.api.posapp.make_address",args:{args:this.address},callback:function(n){n.exc||(e.$emit("add_the_new_address",n.message),e.$emit("show_mesage",{text:"Customer Address created successfully.",color:"success"}),t.addressDialog=!1,t.customer="",t.address={})}})}},created:function(){var t=this;e.$on("open_new_address",function(e){t.addressDialog=!0,t.customer=e})}},B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"600px"},model:{value:e.addressDialog,callback:function(t){e.addressDialog=t},expression:"addressDialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v(e._s(e.__("Add New Address")))])]),e._v(" "),n("v-card-text",{staticClass:"pa-0"},[n("v-container",[n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Address Name"),"background-color":"white","hide-details":""},model:{value:e.address.name,callback:function(t){e.$set(e.address,"name",t)},expression:"address.name"}})],1),e._v(" "),n("v-col",{attrs:{cols:"12"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Address Line 1"),"background-color":"white","hide-details":""},model:{value:e.address.address_line1,callback:function(t){e.$set(e.address,"address_line1",t)},expression:"address.address_line1"}})],1),e._v(" "),n("v-col",{attrs:{cols:"12"}},[n("v-text-field",{attrs:{dense:"",color:"indigo",label:e.frappe._("Address Line 2"),"background-color":"white","hide-details":""},model:{value:e.address.address_line2,callback:function(t){e.$set(e.address,"address_line2",t)},expression:"address.address_line2"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{label:"City",dense:"",color:"indigo","background-color":"white","hide-details":""},model:{value:e.address.city,callback:function(t){e.$set(e.address,"city",t)},expression:"address.city"}})],1),e._v(" "),n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{label:"State",dense:"","background-color":"white","hide-details":""},model:{value:e.address.state,callback:function(t){e.$set(e.address,"state",t)},expression:"address.state"}})],1)],1)],1)],1),e._v(" "),n("v-card-actions",[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error",dark:""},on:{click:e.close_dialog}},[e._v(e._s(e.__("Close")))]),e._v(" "),n("v-btn",{attrs:{color:"primary",dark:""},on:{click:e.submit_dialog}},[e._v(e._s(e.__("Submit")))])],1)],1)],1)],1)};B._withStripped=!0;var z=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/NewAddress.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:B,staticRenderFns:[]},0,L,void 0,!1),M={data:function(){return{varaintsDialog:!1,parentItem:null,items:null,filters:{},filterdItems:[]}},computed:{variantsItems:function(){var e=this;return this.parentItem?this.items.filter(function(t){return t.variant_of==e.parentItem.item_code}):[]}},methods:{close_dialog:function(){this.varaintsDialog=!1},formtCurrency:function(e){return(e=parseFloat(e)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")},updateFiltredItems:function(){this.$nextTick(function(){var e=this,t=[];if(Object.entries(this.filters).forEach(function(e){e[0];var n=e[1];n&&t.push(n)}),t.length){var n=[];this.filterdItems=[],this.variantsItems.forEach(function(t){var i=!0;t.item_attributes.forEach(function(t){e.filters[t.attribute]&&e.filters[t.attribute]!=t.attribute_value&&(i=!1)}),i&&!n.includes(t.item_code)&&(e.filterdItems.push(t),n.push(t.item_code))})}else this.filterdItems=this.variantsItems})},add_item:function(t){e.$emit("add_item",t),this.close_dialog()}},created:function(){var t=this;e.$on("open_variants_model",function(e,n){t.varaintsDialog=!0,t.parentItem=e||null,t.items=n,t.filters={},t.$nextTick(function(){this.filterdItems=this.variantsItems})})}},G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"600px"},model:{value:e.varaintsDialog,callback:function(t){e.varaintsDialog=t},expression:"varaintsDialog"}},[n("v-card",{attrs:{"min-height":"500px"}},[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v("Select Item")]),e._v(" "),n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error",dark:""},on:{click:e.close_dialog}},[e._v("Close")])],1),e._v(" "),n("v-card-text",{staticClass:"pa-0"},[e.parentItem?n("v-container",[e._l(e.parentItem.attributes,function(t){return n("div",{key:t.attribute},[n("v-chip-group",{attrs:{"active-class":"green--text text--accent-4",column:""},model:{value:e.filters[t.attribute],callback:function(n){e.$set(e.filters,t.attribute,n)},expression:"filters[attr.attribute]"}},e._l(t.values,function(t){return n("v-chip",{key:t.abbr,attrs:{value:t.attribute_value,outlined:"",label:""},on:{click:e.updateFiltredItems}},[e._v("\n                "+e._s(t.attribute_value)+"\n              ")])}),1)],1)}),e._v(" "),n("v-divider"),e._v(" "),n("div",[n("v-row",{staticClass:"overflow-y-auto",staticStyle:{"max-height":"500px"},attrs:{dense:""}},e._l(e.filterdItems,function(t,i){return n("v-col",{key:i,attrs:{xl:"2",lg:"3",md:"4",sm:"4",cols:"6","min-height":"50"}},[n("v-card",{attrs:{hover:"hover"},on:{click:function(n){return e.add_item(t)}}},[n("v-img",{staticClass:"white--text align-end",attrs:{src:t.image||"/assets/posawesome/js/posapp/components/pos/placeholder-image.png",gradient:"to bottom, rgba(0,0,0,.2), rgba(0,0,0,.7)",height:"100px"}},[n("v-card-text",{staticClass:"text-subtitle-2 px-1 pb-2",domProps:{textContent:e._s(t.item_name)}})],1),e._v(" "),n("v-card-text",{staticClass:"text--primary pa-1"},[n("div",{staticClass:"text-caption indigo--text accent-3"},[e._v("\n                      "+e._s(t.rate||0)+" "+e._s(t.currency||"")+"\n                    ")])])],1)],1)}),1)],1)],2):e._e()],1)],1)],1)],1)};G._withStripped=!0;var U=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/Variants.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:G,staticRenderFns:[]},0,M,void 0,!1),W={data:function(){return{invoicesDialog:!1,singleSelect:!0,selected:[],dialog_data:"",company:"",invoice_name:"",headers:[{text:__("Customer"),value:"customer",align:"start",sortable:!0},{text:__("Date"),align:"start",sortable:!0,value:"posting_date"},{text:__("Invoice"),value:"name",align:"start",sortable:!0},{text:__("Amount"),value:"grand_total",align:"start",sortable:!1}]}},watch:{},methods:{close_dialog:function(){this.invoicesDialog=!1},search_invoices_by_enter:function(e){13===e.keyCode&&this.search_invoices()},search_invoices:function(){var e=this;frappe.call({method:"posawesome.posawesome.api.posapp.search_invoices_for_return",args:{invoice_name:e.invoice_name,company:e.company},async:!1,callback:function(t){t.message&&(e.dialog_data=t.message)}})},submit_dialog:function(){if(this.selected.length>0){var t=this.selected[0],n={},i=[];t.items.forEach(function(e){var t=Object.assign({},e);t.qty=-1*e.qty,t.stock_qty=-1*e.stock_qty,t.amount=-1*e.amount,i.push(t)}),n.items=i,n.is_return=1,n.return_against=t.name,n.customer=t.customer;var o={invoice_doc:n,return_doc:t};e.$emit("load_return_invoice",o),this.invoicesDialog=!1}},formtCurrency:function(e){return(e=parseFloat(e)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}},created:function(){var t=this;e.$on("open_returns",function(e){t.invoicesDialog=!0,t.company=e,t.invoice_name="",t.dialog_data="",t.selected=[]})}},Q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"800px","min-width":"800px"},model:{value:e.invoicesDialog,callback:function(t){e.invoicesDialog=t},expression:"invoicesDialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v(e._s(e.__("Select Return Invoice")))])]),e._v(" "),n("v-container",[n("v-row",{staticClass:"mb-4"},[n("v-text-field",{staticClass:"mx-4",attrs:{color:"indigo",label:e.frappe._("Invoice ID"),"background-color":"white","hide-details":"",dense:"",clearable:""},model:{value:e.invoice_name,callback:function(t){e.invoice_name=t},expression:"invoice_name"}}),e._v(" "),n("v-btn",{staticClass:"ml-2",attrs:{text:"",color:"primary",dark:""},on:{click:e.search_invoices}},[e._v(e._s(e.__("Search")))])],1),e._v(" "),n("v-row",[e.dialog_data?n("v-col",{staticClass:"pa-1",attrs:{cols:"12"}},[[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.dialog_data,"item-key":"name","single-select":e.singleSelect,"show-select":""},scopedSlots:e._u([{key:"item.grand_total",fn:function(t){var n=t.item;return[e._v(e._s(e.formtCurrency(n.grand_total)))]}}],null,!1,710962859),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})]],2):e._e()],1)],1),e._v(" "),n("v-card-actions",{staticClass:"mt-4"},[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error mx-2",dark:""},on:{click:e.close_dialog}},[e._v("Close")]),e._v(" "),e.selected.length?n("v-btn",{attrs:{color:"primary",dark:""},on:{click:e.submit_dialog}},[e._v(e._s(e.__("Select")))]):e._e()],1)],1)],1)],1)};Q._withStripped=!0;var J=function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/Returns.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:Q,staticRenderFns:[]},0,W,void 0,!1),K={data:function(){return{dialog:!1,singleSelect:!0,selected:[],dialog_data:"",company:"",customer:"",mode_of_payment:"",full_name:"",mobile_no:"",headers:[{text:__("Full Name"),value:"full_name",align:"start",sortable:!0},{text:__("Mobile No"),value:"mobile_no",align:"start",sortable:!0},{text:__("Amount"),value:"amount",align:"start",sortable:!0},{text:__("Date"),align:"start",sortable:!0,value:"posting_date"}]}},watch:{},methods:{close_dialog:function(){this.dialog=!1},search_by_enter:function(e){13===e.keyCode&&this.search()},search:function(){var e=this;frappe.call({method:"posawesome.posawesome.api.m_pesa.get_mpesa_draft_payments",args:{company:this.company,mode_of_payment:this.mode_of_payment,mobile_no:this.mobile_no,full_name:this.full_name},async:!1,callback:function(t){t.exc||(e.dialog_data=t.message)}})},submit_dialog:function(){var t=this;if(this.selected.length>0){var n=this.selected[0].name;frappe.call({method:"posawesome.posawesome.api.m_pesa.submit_mpesa_payment",args:{mpesa_payment:n,customer:this.customer},async:!1,callback:function(n){n.exc||(e.$emit("set_mpesa_payment",n.message),t.dialog=!1)}})}},formtCurrency:function(e){return(e=parseFloat(e)).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}},created:function(){var t=this;e.$on("open_mpesa_payments",function(e){t.dialog=!0,t.full_name="",t.mobile_no="",t.company=e.company,t.customer=e.customer,t.mode_of_payment=e.mode_of_payment,t.dialog_data="",t.selected=[]})}},Y=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-row",{attrs:{justify:"center"}},[n("v-dialog",{attrs:{"max-width":"800px","min-width":"800px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-card",[n("v-card-title",[n("span",{staticClass:"headline indigo--text"},[e._v(e._s(e.__("Select Payment")))])]),e._v(" "),n("v-container",[n("v-row",{staticClass:"mb-4"},[n("v-text-field",{staticClass:"mx-4",attrs:{color:"indigo",label:e.frappe._("Full Name"),"background-color":"white","hide-details":"",dense:"",clearable:""},model:{value:e.full_name,callback:function(t){e.full_name=t},expression:"full_name"}}),e._v(" "),n("v-text-field",{staticClass:"mx-4",attrs:{color:"indigo",label:e.frappe._("Mobile No"),"background-color":"white","hide-details":"",dense:"",clearable:""},model:{value:e.mobile_no,callback:function(t){e.mobile_no=t},expression:"mobile_no"}}),e._v(" "),n("v-btn",{staticClass:"ml-2",attrs:{text:"",color:"primary",dark:""},on:{click:e.search}},[e._v(e._s(e.__("Search")))])],1),e._v(" "),n("v-row",[e.dialog_data?n("v-col",{staticClass:"pa-1",attrs:{cols:"12"}},[[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.dialog_data,"item-key":"name","single-select":e.singleSelect,"show-select":""},scopedSlots:e._u([{key:"item.amount",fn:function(t){var n=t.item;return[e._v(e._s(e.formtCurrency(n.amount)))]}},{key:"item.posting_date",fn:function(t){var n=t.item;return[e._v(e._s(n.posting_date.slice(0,16)))]}}],null,!1,3318502569),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})]],2):e._e()],1)],1),e._v(" "),n("v-card-actions",{staticClass:"mt-4"},[n("v-spacer"),e._v(" "),n("v-btn",{attrs:{color:"error mx-2",dark:""},on:{click:e.close_dialog}},[e._v("Close")]),e._v(" "),e.selected.length?n("v-btn",{attrs:{color:"primary",dark:""},on:{click:e.submit_dialog}},[e._v(e._s(e.__("Select")))]):e._e()],1)],1)],1)],1)};Y._withStripped=!0;var H={data:function(){return{dialog:!1,pos_profile:"",pos_opening_shift:"",payment:!1,offers:!1,coupons:!1}},components:{ItemsSelector:c,Invoice:p,OpeningDialog:v,Payments:y,Drafts:A,ClosingDialog:T,NewCustomer:R,Returns:J,PosOffers:x,PosCoupons:O,EditCustomer:j,NewAddress:z,Variants:U,MpesaPayments:function(e,t,n,i,o,r,s,a){var c=("function"==typeof n?n.options:n)||{};return c.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/Mpesa-Payments.vue",c.render||(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,o&&(c.functional=!0)),c._scopeId=i,c}({render:Y,staticRenderFns:[]},0,K,void 0,!1)},methods:{check_opening_entry:function(){var t=this;return frappe.call("posawesome.posawesome.api.posapp.check_opening_shift",{user:frappe.session.user}).then(function(n){n.message?(t.pos_profile=n.message.pos_profile,t.pos_opening_shift=n.message.pos_opening_shift,t.get_offers(t.pos_profile.name),e.$emit("register_pos_profile",n.message),e.$emit("set_company",n.message.company),console.info("LoadPosProfile")):t.create_opening_voucher()})},create_opening_voucher:function(){this.dialog=!0},get_closing_data:function(){return frappe.call("posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.make_closing_shift_from_opening",{opening_shift:this.pos_opening_shift}).then(function(t){t.message?e.$emit("open_ClosingDialog",t.message):console.log(t)})},submit_closing_pos:function(t){var n=this;frappe.call("posawesome.posawesome.doctype.pos_closing_shift.pos_closing_shift.submit_closing_shift",{closing_shift:t}).then(function(t){t.message?(e.$emit("show_mesage",{text:"POS Shift Closed",color:"success"}),n.check_opening_entry()):console.log(t)})},get_offers:function(t){return frappe.call("posawesome.posawesome.api.posapp.get_offers",{profile:t}).then(function(t){t.message&&(console.info("LoadOffers"),e.$emit("set_offers",t.message))})},get_pos_setting:function(){frappe.db.get_doc("POS Settings",void 0).then(function(t){e.$emit("set_pos_settings",t)})}},created:function(){this.$nextTick(function(){var t=this;this.check_opening_entry(),this.get_pos_setting(),e.$on("close_opening_dialog",function(){t.dialog=!1}),e.$on("register_pos_data",function(n){t.pos_profile=n.pos_profile,t.get_offers(t.pos_profile.name),t.pos_opening_shift=n.pos_opening_shift,e.$emit("register_pos_profile",n),console.info("LoadPosProfile")}),e.$on("show_payment",function(e){t.payment="true"===e,t.offers=!1,t.coupons=!1}),e.$on("show_offers",function(e){t.offers="true"===e,t.payment=!1,t.coupons=!1}),e.$on("show_coupons",function(e){t.coupons="true"===e,t.offers=!1,t.payment=!1}),e.$on("open_closing_dialog",function(){t.get_closing_data()}),e.$on("submit_closing_pos",function(e){t.submit_closing_pos(e)})})}},V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{fluid:""}},[n("ClosingDialog"),e._v(" "),n("Drafts"),e._v(" "),n("Returns"),e._v(" "),n("NewCustomer"),e._v(" "),n("EditCustomer"),e._v(" "),n("NewAddress"),e._v(" "),n("MpesaPayments"),e._v(" "),n("Variants"),e._v(" "),e.dialog?n("OpeningDialog",{attrs:{dialog:e.dialog}}):e._e(),e._v(" "),n("v-row",{directives:[{name:"show",rawName:"v-show",value:!e.dialog,expression:"!dialog"}]},[n("v-col",{directives:[{name:"show",rawName:"v-show",value:!e.payment&&!e.offers&&!e.coupons,expression:"!payment && !offers && !coupons"}],staticClass:"pos pr-0",attrs:{xl:"5",lg:"5",md:"5",sm:"5",cols:"12"}},[n("ItemsSelector")],1),e._v(" "),n("v-col",{directives:[{name:"show",rawName:"v-show",value:e.offers,expression:"offers"}],staticClass:"pos pr-0",attrs:{xl:"5",lg:"5",md:"5",sm:"5",cols:"12"}},[n("PosOffers")],1),e._v(" "),n("v-col",{directives:[{name:"show",rawName:"v-show",value:e.coupons,expression:"coupons"}],staticClass:"pos pr-0",attrs:{xl:"5",lg:"5",md:"5",sm:"5",cols:"12"}},[n("PosCoupons")],1),e._v(" "),n("v-col",{directives:[{name:"show",rawName:"v-show",value:e.payment,expression:"payment"}],staticClass:"pos pr-0",attrs:{xl:"5",lg:"5",md:"5",sm:"5",cols:"12"}},[n("Payments")],1),e._v(" "),n("v-col",{staticClass:"pos",attrs:{xl:"7",lg:"7",md:"7",sm:"7",cols:"12"}},[n("Invoice")],1)],1)],1)};V._withStripped=!0;var Z={data:function(){return{page:"POS"}},components:{Navbar:i,POS:function(e,t,n,i,o,r,s,a){var c,l=("function"==typeof n?n.options:n)||{};if(l.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/components/pos/Pos.vue",l.render||(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,o&&(l.functional=!0)),l._scopeId=i,t&&(c=function(e){t.call(this,s(e))}),void 0!==c)if(l.functional){var _=l.render;l.render=function(e,t){return c.call(t),_(e,t)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return l}({render:V,staticRenderFns:[]},function(e){e&&e("data-v-eb407c64_0",{source:"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",map:{version:3,sources:[],names:[],mappings:"",file:"Pos.vue"},media:void 0})},H,"data-v-eb407c64",!1,0,function e(){var t=document.head||document.getElementsByTagName("head")[0],n=e.styles||(e.styles={}),i="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(e,o){if(!document.querySelector('style[data-vue-ssr-id~="'+e+'"]')){var r=i?o.media||"default":e,s=n[r]||(n[r]={ids:[],parts:[],element:void 0});if(!s.ids.includes(e)){var a=o.source,c=s.ids.length;if(s.ids.push(e),i&&(s.element=s.element||document.querySelector("style[data-group="+r+"]")),!s.element){var l=s.element=document.createElement("style");l.type="text/css",o.media&&l.setAttribute("media",o.media),i&&(l.setAttribute("data-group",r),l.setAttribute("data-next-index","0")),t.appendChild(l)}if(i&&(c=parseInt(s.element.getAttribute("data-next-index")),s.element.setAttribute("data-next-index",c+1)),s.element.styleSheet)s.parts.push(a),s.element.styleSheet.cssText=s.parts.filter(Boolean).join("\n");else{var _=document.createTextNode(a),u=s.element.childNodes;u[c]&&s.element.removeChild(u[c]),u.length?s.element.insertBefore(_,u[c]):s.element.appendChild(_)}}}}})},methods:{setPage:function(e){this.page=e},remove_frappe_nav:function(){this.$nextTick(function(){$(".page-head").remove(),$(".navbar.navbar-default.navbar-fixed-top").remove()})}},mounted:function(){this.remove_frappe_nav()},updated:function(){},created:function(){var e=this;setTimeout(function(){e.remove_frappe_nav()},1e3)}},X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{staticClass:"container1"},[n("v-main",[n("Navbar",{on:{changePage:function(t){return e.setPage(t)}}}),e._v(" "),n("keep-alive",[n(e.page,{tag:"component",staticClass:"mx-4 md-4"})],1)],1)],1)};X._withStripped=!0;var ee=function(e,t,n,i,o,r,s,a){var c,l=("function"==typeof n?n.options:n)||{};if(l.__file="/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/Home.vue",l.render||(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,o&&(l.functional=!0)),l._scopeId=i,t&&(c=function(e){t.call(this,s(e))}),void 0!==c)if(l.functional){var _=l.render;l.render=function(e,t){return c.call(t),_(e,t)}}else{var u=l.beforeCreate;l.beforeCreate=u?[].concat(u,c):[c]}return l}({render:X,staticRenderFns:[]},function(e){e&&e("data-v-63b8f30f_0",{source:"\n.container1[data-v-63b8f30f] {\n  margin-top: 0px;\n}\n",map:{version:3,sources:["/home/tunatechserver/frappe-bench/apps/posawesome/posawesome/public/js/posapp/Home.vue"],names:[],mappings:";AAiDA;EACA,eAAA;AACA",file:"Home.vue",sourcesContent:["<template>\n  <v-app class=\"container1\">\n    <v-main>\n      <Navbar @changePage=\"setPage($event)\"></Navbar>\n      <keep-alive>\n        <component v-bind:is=\"page\" class=\"mx-4 md-4\"></component>\n      </keep-alive>\n    </v-main>\n  </v-app>\n</template>\n\n<script>\nimport Navbar from './components/Navbar.vue';\nimport POS from './components/pos/Pos.vue';\n\nexport default {\n  data: function () {\n    return {\n      page: 'POS',\n    };\n  },\n  components: {\n    Navbar,\n    POS,\n  },\n  methods: {\n    setPage(page) {\n      this.page = page;\n    },\n    remove_frappe_nav() {\n      this.$nextTick(function () {\n        $('.page-head').remove();\n        $('.navbar.navbar-default.navbar-fixed-top').remove();\n      });\n    },\n  },\n  mounted() {\n    this.remove_frappe_nav();\n  },\n  updated() {},\n  created: function () {\n    setTimeout(() => {\n      this.remove_frappe_nav();\n    }, 1000);\n  },\n};\n<\/script>\n\n<style scoped>\n.container1 {\n  margin-top: 0px;\n}\n</style>"]},media:void 0})},Z,"data-v-63b8f30f",!1,0,function e(){var t=document.head||document.getElementsByTagName("head")[0],n=e.styles||(e.styles={}),i="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());return function(e,o){if(!document.querySelector('style[data-vue-ssr-id~="'+e+'"]')){var r=i?o.media||"default":e,s=n[r]||(n[r]={ids:[],parts:[],element:void 0});if(!s.ids.includes(e)){var a=o.source,c=s.ids.length;if(s.ids.push(e),i&&(s.element=s.element||document.querySelector("style[data-group="+r+"]")),!s.element){var l=s.element=document.createElement("style");l.type="text/css",o.media&&l.setAttribute("media",o.media),i&&(l.setAttribute("data-group",r),l.setAttribute("data-next-index","0")),t.appendChild(l)}if(i&&(c=parseInt(s.element.getAttribute("data-next-index")),s.element.setAttribute("data-next-index",c+1)),s.element.styleSheet)s.parts.push(a),s.element.styleSheet.cssText=s.parts.filter(Boolean).join("\n");else{var _=document.createTextNode(a),u=s.element.childNodes;u[c]&&s.element.removeChild(u[c]),u.length?s.element.insertBefore(_,u[c]):s.element.appendChild(_)}}}}});frappe.provide("frappe.PosApp"),frappe.PosApp.posapp=class{constructor(e){var t=e.parent;this.$parent=$(document),this.page=t.page,this.make_body()}make_body(){this.$el=this.$parent.find(".main-section"),this.vue=new Vue({vuetify:new Vuetify,el:this.$el[0],data:{},render:function(e){return e(ee)}})}setup_header(){}}}();
//# sourceMappingURL=posapp.min.js.map
